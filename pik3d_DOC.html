<html>
<head><meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<title>pik3d_DOC</title>
<style><!--
body {background:white; color:Black; font-size:14px; line-height:13px; font-family:'Monospace'}
a:link, a:visited {color:blue; text-decoration:none;} a{font-weight:bold;}
o{font-weight:bold; Color:#8b218b; font-size:14px; font-style:italic;}
r{Color:RED;font-weight:bold;}
g{Color:#3db84e;font-weight:bold;}
n{Color:#0050ff;font-weight:bold;}
m{Color:#6b006b}
y{Color:#2e8b57}
f{font-weight:normal; Color:#0047b3; font-size:12px; font-style:italic;}
x{background:#333333; color:#00FF00; font-size:13px; line-height:13px; font-family:'Courier'; font-weight: normal;}
--></style></head><body>

<h5><pre><a name='s3d'><f>pik3d - framework for processing and 3d-display of matrices and their sequences
        in s3d Help supports HTML navigation:  <a href="#ins">links</a><f>, &lt;Home>, &lt;End>
</f><a name='ogl'></a>
<a href='#fwk'>OVERVIEW of pik3d v.23.6</a>
<a href="#ins">INSTALL pik3d </a>
<a href="#jfx">Build your own JDK+FX assembly</a>
<a href="#dat">###-format of the data: FRAME, STACK</a>
<a href="#cmd">COMMANDS</a>

jj preprocessor & executor:
  <a href="#jj"  >jj File[.jj] or File.java     [/s] [/c]  </a>    ! <r>"jj = java-JAVA = simple_JAVA"</r>
  <a href="#jjf" >Preprocessor & executor                  </a>    ! general description
  <a href="#jcc" >jj "jcmd1; jcmd2; jcmd3 ..."  [/s] [/c]  </a>    ! Execute several JAVA commands
  <a href="#jaf" >Argument File                            </a>    ! File.arg contains <r>List of Arguments</r>
  <a href="#jmm" >jj macro: #p[/default]#, #<r>?prompt</r>[/default]# </a>! Macro Substitution
  <a href="#jos" >jj script with Operating System commands </a>    ! <r>OS batch</r> script

System:
  <a href="#cex">crex   F.jj | F.java </a>                        ! <r>CR</r>eate <r>EX</r>ecutable Launcher
  <a href="#clg">Creating Launcher: general case</a>              ! Launcher for any java-code, <r>not pik3d</r>
  <a href="#zip">adzip  ZIP  F1  [ F2 F2 ... ] </a>               ! <r>AD</r>d Files to <r>ZIP</r>
  <a href="#eeh">ee  [text] </a>                                  ! print to std.<r>ERR</r> current time & text
  <a href="#pls">pl  L1  [ L2 ... ] </a>                          ! <r>P</r>rint <r>L</r>ines to std.OUT/ console

3d-graphics:
  <a href='#sss'>s3d -"Surface-3D" </a>                           ! <r>3d</r>-display of the Stack [+Additions]
  <a href='#b3d'>b3d -"Body-3D"    </a>                           ! <r>3d</r>-display of the Body or Figure

Stack: create, view, info:
  <a href='#40' >stk  ii  [ jj=1 [kk=1]]  [v=&lt;value>]  [D8]</a>   ! Create new <r>St</r>ac<r>k</r>
  <a href='#fmt'>fmt  Stk [ I2|F4|D8| n*w.dF ] [LE] [/h]</a>      ! Convert or Print Stack | Header
  <a href='#tt' >...| tt ...   or   tt&lt;  File ...</a>             ! Process <r>ALL Stacks</r> from pipe | File
  <a href='#ren'>renam  Stk  name   [N=1] </a>                    ! <r>Renam</r>e Frames: name_N, name_&lt;N+1> ...

Data Generation:
  <a href="#60" >gauss   [r=2 [ width=3 ]] </a>                   ! create normalized <r>Gauss</r>ian filter
  <a href="#bel">bell  K "x y h r"   ["x1 y1 h1 r1"] </a>         ! add Gaussian "<r>Bell</r>"
  <a href="#wav">wave  K "x y h r a" ["x1 y1 h1 r1 a1"] </a>      ! add Gaussian "<r>Wave</r>"
  <a href="#gel">gen3d   config </a>                              ! "<r>3d</r>-Stack <r>Gen</r>erator"
  <a href="#140">noise   Stk  [amp =.1] </a>                      ! add "Uniform <r>Noise</r>"
  <a href="#145">gnoise  Stk  [R=.1] </a>                         ! add "<r>G</r>aussian <r>Noise</r>", sigma=R/2

<a href='#djk'>STACK PART: Stk[ di,dj,dk ] </a>                   ! <r>"Slice"</r>, index subsets
  <a href='#get'>get       Stk[ di,dj,dk ] </a>                   ! <r>get</r> Part of the Stack
  <a href='#put'>put       Stk[ di,dj,dk ] Part [p=1 [s=0]]</a>   ! Stk[] = s*Stk[] + p*Part
  <a href='#dim'>dim32     Stk </a>                               ! convert <r>3d</r>-Stack --> <r>2d</r>-Matrix
  <a href='#csv'>csv  CSV-file [ di,dj ]   [D8] </a>              ! read <r>"Comma-Separated Values"</r> file

Element-wise Calculations:
  <a href="#120">sv  S  [+-x/p|exp|ln|db]  value </a>             ! <r>S</r>tack-<r>V</r>alue operations
  <a href="#row">sr  S  [+-x/p]            Row </a>               ! <r>S</r>tack-<r>R</r>ow   operations
  <a href="#130">ss  S  [+-x/p]            A </a>                 ! <r>S</r>tack-<r>S</r>tack operations
  <a href="#sks">sks S          k          A </a>                 ! "S + k*A"

Matrix Operations:
  <a href="#tra">tra   Stk </a>                                   ! Stack <r>Tra</r>nsposition
  <a href="#tra">rot90 Stk </a>                                   ! <r>Rot</r>ate Frames on <r>90</r> degrees
  <a href="#dia">diag  A  [Vector] </a>                           ! <r>Diag</r>onal put/get </a>
  <a href="#mul">mul   A  B  [C D ...]</a>                        ! Matrix <r>mul</r>tiplication
  <a href="#ata">ata   A</a>                                      ! (<r>A T</r>ransposed) * <r>A</r>
  <a href="#inv">inv   A </a>                                     ! <r>inv</r>ert Matrix
  <a href="#sys">sys   A  b </a>                                  ! Linear <r>sys</r>tem solver
  <a href="#eig">eig   A </a>                                     ! <r>Eig</r>en Values and Vectors
  <a href="#svd">svd   A </a>                                     ! <r>S</r>ingular <r>V</r>alues <r>D</r>ecomposition
  <a href="#dif">dif   A  0 | A  1 |  A  B </a>                   ! <r>dif</r>ference of the Matrix/ Stack

Data Processing:
  <a href="#180">blur   Stk  [R=2] </a>                           ! Smoothing, "Gaussian <r>Blur</r>"
  <a href="#190">filtr  Stk   Fltr </a>                           ! Filter
  <a href="#160">top    Stk   level </a>                          ! "Cut <r>Top</r>"
  <a href="#170">bot    Stk  [level=0] </a>                       ! "Cut <r>Bot</r>tom"
  <a href="#210">ma     Stk  [N=5 ] </a>                          ! <r>M</r>oving <r>A</r>verage
  <a href="#220">sma    Stk  [N=5  [level=0 ]] </a>               ! <r>S</r>ubtract <r>M</r>oving <r>A</r>verage

  <a href="#his">hist   Stk  [Fr=1 [Nint=100]] [/add=File]</a>    ! Frame <r>Hist</r>ogram
  <a href="#mea">meanc    A </a>                                  ! <r>Mean C</r>olumn Values
  <a href="#sme">submeanc A </a>                                  ! <r>Sub</r>tract <r>Mean C</r>olumn Values
  <a href="#cor">corr     A </a>                                  ! <r>Corr</r>erelation Matrix

<a href="#reg">Linear Regression:</a>
  <a href="#rej">jj reglin  XV  x.arg     [USE case] > Regr </a>  ! Regression <r>Lin</r>ear
  <a href="#rva">jj regval  X   x.arg  R  [USE case] > Values</a> ! Regression <r>Val</r>ues of X
  <a href="#tst">jj regtst  XV  x.arg  R  [USE case] > Delt </a>  ! Regression <r>T</r>e<r>st</r> on other data

  <a href="#uve">usevec   M  c1 p1 [c2 p2  c3 p3...] </a>         ! Create <r>USE-vec</r>tor for Matrix
  <a href="#uca">usecase  M  U  c </a>                            ! Get <r>USE case</r> from Matrix
  <a href="#sta">usestat     U [c] </a>                           ! <r>USE Stat</r>istics
  <a href="#uou">useout   R  s=dS | v=dV   > new USE_vect </a>    ! Mark <r>OUT</r>liers in the <r>USE</r>-vector

  <a href="#mnk">lss   XY   [N=3]  [/vis]  [/add=File]</a>        ! <r>L</r>east <r>S</r>quares <r>S</r>pline of N parts
  <a href="#spl">spl   SPL  X </a>                                ! get values of the <r>Spl</r>ine

2d-Graphics:
  <a href="#vis">vic(s) Stk  jX j1 j2 j3 ... [keys]</a>           ! <r>Vi</r>sualize <r>C</r>olumns (<r>S</r>pline)
  <a href="#vip">vimp   config  [keys]</a>                        ! --"---"---"---"-- <r>M</r>ultiple Stack <r>P</r>lots
  <a href="#gra">Use of 2d-graphics </a>
  <a href="#tif">tif  File.tif | Config  [Npro=99999] </a>        ! Show <r>.TIF</r>-files/clip

<a href="#pik">Most used pik.io methods </a>
<a name='fwk'></a>________________________________________________________________________________________

<o>   PROCESSING AND 3D DISPLAY OF MATRIXES/FRAMES AND THEIR SEQUENCES
</o>
When examining the properties of a time-varying surface, it is convenient to store,
process and display a set of images/ frames/ matrices as a whole.
Such an image sequence is often referred to as a STACK of images.
Displaying of the stack in the "frame by frame" mode is perceived as a video clip.

Framework <o>pik3d</o> offers a data storage/sharing standard and a basic set of commands for
processing and displaying stacks.The methods for reading and writing files in <a href="#dat">###-format</a>
implemented in JAVA are stored in the library: lib\pik.jar and described: <a href="#pik">pik.io methods</a>
Package: kadr.py is implemented for PYTHON language ( stored: ext\###_PYTHON.zip ).
To use the ###-format in the <r>ImageJ</r> graphical editor, a plugin is implemented
( ext\###_Reader_ImageJ.jar, copy to ImageJ\plugins\3D ).

Framework commands are executable(.exe) modules and their set is not fixed.
The launcher technology is used ("launch" - to launch, start). Launcher encapsulates
the starting configuration of the Virtual JAVA Machine (JVM).

The framework contains simple tool to extend <m>pik3d</m> on JAVA - <a href="#cex">command: crex</a>.
Additional commands can be implemented in any convenient algorithmic language.

From command to command, Stacks are transferred in the form of the <a href="#dat">###-format</a> files
or by means of <r>pipe-line</r>( it can reduce disk usage and increase performance ).

Most of the commands  output the result  to the standard output stream. If commands
chained in to the <r>pipe-line</r> the next command can get data from the <r>standard stream</r>.
To denote standard stream symbol <r>'-'</r> is used. In case of several Stacks in the output:
<r>-:2, -:3</r> ... Stacks are delimited by: <r>### &lt;eos></r> -"End Of Stack". It looks like:

  cmd1 a b <r>|</r> cmd2 c <r>-</r> <r>|</r> cmd3 d <r>-</r> d:3 <r>-:2</r> ... <r>|</r> cmdN <r>-</r> p <r>></r> File
<a name='jjscr'></a>
In a simple case, the processing program is a command/ batch script.
More complex program with loops and branching points( even dialogs ) can be implemented
using <a href="#jj">jj-preprocessor</a>. In jj-file OS-command/ pipe ( the same as in the batch file )
follows the symbol <m>'$'</m>, example of <n>batch-file</n> and <m>jj-file</m> with the same functioality:

  <y>rem file: eigenVV.bat</y>                 | <r>{</r> <y>//file: eigenVV.jj</y>
  <n>stk 77 9| noise -| ata - | eig - > V</n>  |   <m>$ stk 77 9| noise -| ata -| eig - > V</m>
  <n>fmt V    10*11.5g                   </n>  |   <m>$ fmt V    10*11.5g</m>
  <n>fmt V:2  10*11.5g                   </n>  |   <m>$ fmt V:2  10*11.5g</m>
                                        | <r>}</r>
  > eigenVV            !run <n>batch-file</n>  | > jj eigenVV             !run <m>jj-file</m>

Use of <m>jj-file</m> is more flexible as it can contain JAVA-code to control the processing.
Executable <a href="#cex">Launchers (.exe)</a> can be created for the established <m>jj-scripts</m>.

The framework can be installed on Windows 7, 10, Linux (tested in Mint 21).
Version 23.6 is compiled with <r>JAVA-21 using javaFX</r>. It can run on Java 21-27.
It was tested under JAVA 21,22,25,"Early-Access Release 27".
<a name='ins'></a>________________________________________________________________________________________

				<o>INSTALL pik3d
</o>
    <x> Linux specific steps will appear like this.</x>

 1. Download or  <a href="#jfx">*build your own</a>  <r>JDK+FX</r> assembly  for Windows or Linux.
    Recommended assembly:

       <a href="https://www.azul.com/downloads/?os=windows&architecture=x86-64-bit&package=jdk-fx#zulu">Azul  JDK FX </a>        ! Java <r>25 LTS</r>, x86 64-bit

    Since the framework does not require a full JAVA installation ( <r>only unzip</r> ),
    assemblies can be easily changed. If a different version of Java is installed on the
    system, the presence of the JDK+FX assembly will not affect the system in any way.

 2. Expand JAVA archive, for example to: D:\jdk <x> ~/jdk </x>. There should be a folder:
    D:\jdk\bin  <x> ~/jdk/bin </x>  with  <r>java.exe</r>.  It will be pointed in Launchers config.

 3. Expand the archive: <r>pik3d.zip</r> <x> pik3d_Linux.zip </x> in a folder, for example:
    E:\pik3d &nbsp;&nbsp; <x> ~/pik3d &nbsp; </x>

 4. Create Launchers:
    a. Go to the <r>pik3d\exe</r> <x> ~/pik3d/exe </x> folder ;
    b. Edit config <r>_Launch.cfg</r> :
       - set parameter: <r>jdk/bin:</r>,  in our example:  D:\jdk\bin     <x> ~/jdk/bin  </x>
       - set parameter: <r>lib/jar:</r>,  --:--:--:--:--:  E:\pik3d\lib\* <x> ~/pik3d/lib/* </x>

    c. run <r>_Launch.exe</r> <x> <b>./_Launch</b>  # ALL Launchers are copied to ~/bin !!!</x>

	               <x> in Linux  skip steps  5., 6.  and  go to 7. </x>

 5. If need to "introduce" all Launchers to the antivirus, use  pik3d\exe\<r>_antivir.bat</r>.

 6. Add  path to Launchers  to the  <r>Path</r>  environment variable,
    in our example:  ...;E:\pik3d\exe

 7. Check if the installation is correct:  console> <r>gauss| s3d -</r>
    The "Gauss Bell" should be displayed.
    In case of error:  check  <r>pik3d\exe\_Launch.cfg</r>,  check <r>Path</r>: > path
    Possibly, you may need to restart Windows.
    Also, the cause may be a conflict with the antivirus (it will pass after a while).

 8. Several demos are collected in the folder: <r>pik3d\demo</r>,  run:  > _run.cmd <x> ./run  </x>
    If stop viewing by &lt;space>, you can change view angles by moving the pressed Mouse.
    The lighting angles can be changed by: <r>&lt;Ctrl + arrows></r>: Left, Right, Up, Down .
    It is recommended to press in different sequences (again key press =enable/disable):
    <r>&lt;F1></r>,<r>^A</r>-Axes,<r>&lt;Alt+M></r>-Map Off,<r>^D</r>-Map Down,<r>^M</r>-only Map,<r>^2</r>-add.Obj (<r>^</r>=pressed<r>&lt;Ctrl></r>key)

<a name='jfx'></a>
<n>*Build your own <r>JDK+FX</r> assembly</n>,  example: OpenJDK + javaFX v.25 for Windows.

 1. Download from official site: <a href="https://jdk.java.net/java-se-ri/25"> <r>jdk</r>.java.net </a>  GA Releases:
    - <n>jdk-25_windows-x64_bin.zip</n>               - Windows/x64 JDK 25 (212 MB) ;
    - <n>openjfx-25.0.1_windows-x64_bin-jmods.zip</n> - Windows/x64 javaFX 25 (45 MB) .

 2. Copy zip-folder:  <n>jdk-25.0.1</n>  to the disk( for example we will use <n>d:\</n> ).

 3. Copy zip-folder:  <n>javafx-jmods-25.0.1</n>  to the disk ;

 4. Make sure the folder:  <n>d:\jdk</n>  is absent, our build will create it.

 5. Go to the folder:  <n>d:\jdk-25.0.1\bin</n> ;

 6. Run Console (e.g. cmd.exe)  and  execute command ( this is <m>one line</m> ):

<m>jlink  --module-path <n>d:\javafx-jmods-25.0.1</n>  --add-modules javafx.base,javafx.controls,
javafx.fxml,javafx.graphics,javafx.media,javafx.swing,javafx.web  --bind-services
--output</m>  <n>d:\jdk</n>

 7. Copy files:  <r>LICENSE, README, release</r>  from  <n>d:\jdk-25.0.1</n>  to  <n>d:\jdk</n> .

 <r>!!! After this, the d:\jdk folder contains an assembly (</r>~288 MB<r>), which is sufficient
     to run the framework, but not sufficient to compile Java files using javaFX !!!</r>

The following steps are required for the assembly with the javaFX Compilation option.

 8. Copy folder: <n>jmods</n>  from <n>d:\jdk-25.0.1</n>  to the  <n>d:\jdk</n> .

 9. Copy <n>all files</n> from the folder: <n>d:\javafx-jmods-25.0.1\jmods</n> to the <n>d:\jdk\jmods</n>
    If any file already exists while copying, select the <n>overwrite</n> option .

After all the steps  <n>d:\jdk</n>  contains  <r>JDK+FX</r>  assembly (~422 MB).
Folders:  <n>d:\jdk-25.0.1, d:\javafx-jmods-25.0.1</n>  can be removed.

    <r>!!! WHEN USING THIS ASSEMBLY, YOU MUST COMPLY WITH THE TERMS OF THE LICENSE !!!</r>

<a name='dat'></a>________________________________________________________________________________________

		<o>###-format of the data: FRAME, STACK
</o>
The file may contain one or more frames and stacks in text and/or in binary format.
Frame = Matrix in the mathematical sense: rows are counted down, columns - to the right.
Stack - a sequence of frames. Stack ends with the end of file or a line: <r>### &lt;eos></r> -
"End Of Stack". If file A.dat contains several stacks, then A.dat(2) - access to the 2nd
stack, A.dat(3) - to the 3rd, access to the 1st: A.dat or A.dat(1) .

The frame data is preceded by a header: <r>### frame_name [ Row_number, Column_number ]</r>.
The frame name can be any text( may be with spaces or even empty ).
Matrix size is specified in parentheses: [ ] or ( ).
If the number of columns = 1, it can be omitted.

If need to consider data as <n>Double Presion (8-byte)</n>, parameter <n>T8(d8 in  binary)</n> must be
used after<r>[]</r>. If <n>T8/d8</n> is absent,data are considered as <n>FLoating Point single precision</n>.

Text or binary data files may contain <y>comments</y>.
Comments start with <y>!</y>  or  a single <y>#</y>  and  continues to the end of the line.
An empty line is also considered a comment.

<r>Any text</r> (even without leading symbols: !|# ) <r>before 1st. ###-header is comment</r> too.
It is good practice to include data description in to the important files.
This can be done by means of text editor.

To see header with commemts  use commad: <a href="#tt">tt< Stk /h</a> .

In  <r>Text Format</r>, the header line is followed by data lines. The data is considered as
real numbers, even if they do not contain a decimal point.
<r>+-.0123456789eE</r>  are considered as Data Symbols. The rest can serve as delimiters.

A string can be divided into any number of substrings  with comments between them.
The only limitation is that you cannot break a numeric value.  Example( correct frame ):
<n>
 ### test [ 3, 5 ]    <y>! 3-rows, 5-columns</y>

   11.123, 12.34, 13  <y># comment</y>
                        -14, 15.56     <y>! integers can be used:</y>

   21.32 22.54 -23.33 24.765 -.25E+8   <y># real: with  decimal point</y>
   31 32 3.3e1 340e-7    9e9           <y>!             and/or exponent</y>
</n>
<r>Text format</r> may contain <r>repeaters and cycles</r>:
  - repeater: <r>n*v</r> ="n times repeat v", e.g. 99*-.01 -means 99 times repeat value=-.01;
  - cycle:  <r>( b, e [, s])</r> -values: b, b+s, b+2*s ... until b+k*s <=e or e<= b+k*s if s<0
    if s is omitted  s=+1 if b&lt;e  or  s=-1 if b>e .
  Examples: (-4,4,2) = {-4,-2,0,2,4};  (4,1) = {4,3,2,1};  (4,-4,-2) = {4,2,0,-2,-4}
> <m>echo <n>### V[200]/ <r>101*99 (98,0)</r> </n>> Vect  &  fmt Vect</m>    <y>!create V[200] and print it
                                                        !<n>"One Line Frame"</n> is used</y>

For text files, it is possible to use a <n>shortened header</n> without name: <n>### []  or  ###[]</n>
The number of columns is the number of values in the first row of data.
The number of rows is defined by the file length or the next header, e.g.

> <m>pl</m> <n>###[]</n> "1 2 3 4 5" "9 8 7 6 5" "-1 -2 -3 -4 -5"| <m>tt</m> <y>! create frame: 3x5 and print it</y>
<n>
### [] T8        ! shortened HEADER for frame[3,5] of text double precision data
  1.41673775804     2.16775769909     2.42139177571     1.85775663706     2.47759811625
  2.07666607657     1.7660799297      1.96489360786     2.27607551608     2.1607433131
  3.12731327412    -.273277055213     .0544477327523   -.396327103658    -.333276174596

### ...          ! next HEADER</n>

<r>Special types</r> of square matrices: <r>diagonal, symmetric, </r>triangular:<r> upper, lower</r> .
Currently, only <r>diagonal</r> is supported in binary format, the others only in text files.
In examples <n>"One Line Frame"</n> is used to create stack and then <m>"pipe" it to the console</m>:

> <m>echo</m> <n>### Dia [ 20, <r>diagonal</r> ] / (1, 20)</n> <m>| tt 20*4.0f</m>    <y>! diagonal: 1,2..., others=0</y>
> <m>echo</m> <n>### Sym [ 20, <r>symmetric</r>] / (1,210)</n> <m>| tt 20*4.0f</m>    <y>! set only upper triangl</y>
> <m>echo</m> <n>### Upp [ 20, <r>upper</r>    ] / (1,210)</n> <m>| tt 20*4.0f</m>    <y>!          upper triangl</y>
> <m>echo</m> <n>### Low [ 20, <r>lower</r>    ] / (1,210)</n> <m>| tt 20*4.0f</m>    <y>! lower triangl</y>
                 <n>!!! <r>Keywords</r> can be shortened to two characters: <r>di</r> | <r>sy</r> | <r>up</r> | <r>lo</r> !!!</n>
<a name='bin'></a>
<r>Binary Format</r> has an extended header. The matrix size is followed by the binary
data type: <r>I2 | F4 | D8</r> and possibly  a "Byte Order Indicator": <r> LE </r> .

    <r>I2</r> - 2-byte integers, value range from <r>-32768</r> to <r>+32767</r>

    <r>F4</r> - 4-byte real("Floating Point") single precision, <r>~ 7</r> significant digits:
                            <r>1.4e-45</r> < absolute value < <r>3.4e+38</r>

    <r>D8</r> - 8-byte real double precision, <r>~ 15</r> significant digits:
                            <r>4.9e-324</r> < absolute value < <r>1.8e+308</r>

    <r>LE</r> - "Little-Endian" - "LOW bytes first" like in memory.
          Default byte order is <n> "Big-Endian" - this is JAVA Standard !</n>

The binary block starts after byte=<r>0x10=#0A("Line Feed")</r> and does not contain comments!
Comments can be placed only before the header or after the binary block !

The data is output to the binary block sequentially by lines without separators !

Stack may contain both text and binary frames( even with different "Byte Order").

	<r>The amount of the Stack Data should not exceed 2 GB !</r>

In files with binary frames, you can add/ change comments and headers using editors
that support binary format ( Notepad++, SlickEdit ... )

The command:<a href="#fmt"> fmt </a>- "format" converts a file to the specified format.
To quickly view stacks in the "pipe", it is convenient to use the command: <a href="#tt">...| tt</a>

JAVA methods to work with data in  <r>###-format</r>  are given in  <a href="#pik">pik.io  methods</a> .
<a name='cmd'></a>________________________________________________________________________________________

					<o>COMMANDS:</o>
The command consists of two parts:
 - functional part, implemented and compiled with JAVA, are stored: pik3d\lib\*.jar;
 - launcher - exe module stored in pik3d\exe, that starts JVM and passes parameters.

Launcher actions:
 - starts the JVM in the required configuration:  paths, keys, options ...
 - passes to JVM a link to compiled code;
 - passes arguments to the command;
 - exits after starting the JVM and passing parameters.

All launchers have the same code. The difference is in the start parameters and the link
to the command class. How to create new command:  <a href="#cex">command: crex</a>.
<r>
   At the first call of the command, a conflict with the antivirus may occur.
   After checking the launcher with the antivirus, this passes.
   You can "introduce" all launchers to antivirus by executing: pik3d\exe\antivir.bat
</r>
Command name = launcher name and is not fixed. You can rename any launcher as you like.

The launcher receives information about the JAVA machine and the path to the libraries
at the time of creation, parameters: <r>jdk/bin, lib/jar</r> of the <r>_Launch.cfg</r> file.
This technology allows you to have several JVM and libraries in the system.

When called without parameters or with the key: <r>/?</r> most commands show their short
description. If the command does not show anything, it must be run with the key: <r>/dbg</r>
- debug mode. Also, some diagnostic messages are visible only in debug mode.
<x>If you need error info. from  <r>s3d</r>  or  <r>b3d</r>  in Linux,  you should run
<r>s3dx</r>  or  <r>b3dx</r>  Launcher.</x>

Most commands (with the exception of visual commands) send the result to the standard
input/ output stream. If you do not specify  <r>> File</r>  at the end of the command,
the output will be performed to the console/ screen.

The standard stream allows the use of the <r>"pipe-line"</r> technology.
If the intermediate data is not important, it can be passed from one command to the next
command directly, bypassing the disk file. The <r>"pipe-line"</r> provides this capability.
It can improve disk usage and performance.

You can save intermediate data of pipe for further processing. Most commands support
saving an intermediate file. The last command parameter must be:  <r>@file</r> .
<n>
   There may be problems when using a <r>saved</r> intermediate file <r>in the same pipe</r> !!!
   In this case, it is recommended to break the pipe at the point of the reuse.
</n><r>
   Experience shows that a pipe should not be used when processing large Stacks > 1 GB.
</r>
To use the pipe-line, the commands are written on one line and separated by <r>'|'</r>.

If the command receives a stack from the pipe, then this parameter is replaced by <r>-</r> .
A pipe as a file may contain several stacks. <r>N-th stack</r> will be called: <r>-:N</r> .

   stk 70 90 <r>|</r> noise <r>- @F.dat |</r> bell <r>-</r> "20 30 .3 10" <r>|</r> wave <r>-</r> "50 60 .2 15 45" <r>></r> Land

<r>   None of the input files must have a result name (in the example: Land )
   Commands: <o>s3d, hist, lss /vis, vi.., ee, tif</o>  STOP pipe-line
</r>

It makes sense to save the worked out command sequences as batch scripts.
Stack names and parameters can be considered as call arguments ( %1, %2 ...).

If you need to provide  loops  and  branch points  during processing, it is recommended
to use  <a href="#jj">jj-preprocessor</a>  with  <m>$ app1[ | app2 ] ...</m>  and control code on <n>JAVA</n>.
Example( <m>pik3d/usr/ijk.jj</m> ):<m>
{                  <y>//> jj ijk Stack      #get element: Stack[ i j k ]</y>
   while( true ){
      var i=intar( getPars( getKbd("input:  i j k  (0=exit)","1 1 1"), 1,1,1 ));
      if( i[0]==0 ) break;
      try{ ee( arg[0]+" [ "+i[0]+" "+i[1]+" "+i[2]+" ] = "+getSTi( arg[0], i));}
      catch( Exception q ){ ee("  ### error");
   }
}</m>
Useful methods for <m>jj-script</m> are described in the <a href="#pik"> Most used pik.io methods  </a>section.


An alternative is to use the command: <r>setvar</r> - "Set Variable".  It allows to read value
from the  <n>Stack element</n>  or  <n>keyboard</n>  and  set it to the system  <r>environment variable</r>.

   <r>setvar kbd</r>  prompt [ default value ]   <y>!print prompt and read value from Kayboard</y>
   <r>setvar stk</r>  Stack  [i=1 [j=1 [k=1]]]   <y>!get Stack[ i,j,k ] element</y>

<div style='background:#333333; color:#00FF00;'># Linux example(~/bin/stkelm): $ stkelm Stk&nbsp;
  s=$1
  if [ -z "$1" ];then
    s=`<r>setvar kbd</r> "input Stk.name" q`
  fi

  while [ true ];do
    i=`<r>setvar kbd</r> "input i" 3`
    j=`<r>setvar kbd</r> "input j" 7`
    k=`<r>setvar kbd</r> "input k(999=exit)" 999`

    if [ $k = 999 ];then
      exit; fi

    v=`<r>setvar stk</r> $s $i $j $k`
    echo $s[ $i, $j, $k ] = $v; echo
  done
</div>

In Windows, <r>setvar</r> is launched using sripts:

  <r>call varkbd VAR</r> prompt [default]       <y>!get value from the keyboard</y>
  <r>call varstk VAR</r> Stk [i=1 [j=1[ k=1]]]  <y>!get value of the Stk[ i,j,k ] element</y>

> <r>call varkbd VVV</r> "input value" -999     <y>!input var: <r>VVV</r> from the keyboard</y>
> echo %VVV%                             <y>!print var: <r>VVV</r></y>
> <r>call varstk VVV</r>  Stk  5 4              <y>!read value from Stack: <r>VVV</r> = Stk[5,4]</y>

Example( pik3d/exe/stkelm.cmd - get element: Stk[i,j,k] ):<n>
@echo OFF
::          get Stk Element, %1 = Stack Name
IF [%1]==[] goto end

:cycle
call varkbd <r>i</r> "input i" 3
call varkbd <r>j</r> "input j" 7
call varkbd <r>k</r> "input k(999=exit)" 999

<r>IF</r> %<r>k</r>% equ 999 goto end

call varstk <r>elm</r> %1 %<r>i</r>% %<r>j</r>% %<r>k</r>%
echo %1[ %<r>i</r>%, %<r>j</r>%, %<r>k</r>%] = %<r>elm</r>%
echo.
goto cycle

:end</n>
> stk 5 9 3| noise - 100 > dat  & fmt dat 9*6.0f   <y>!prepare  Stack: dat  for the test</y>
> stkelm dat                                       <y>!run script</y>

These scripts can be used for any Stack in text or binary format.
<a name='jj'></a>________________________________________________________________________________________

<f>jj = "java-JAVA" preprocessor & executor of simple_JAVA
      simple_JAVA = JAVA  without Header and main()  -  ONLY SUBJECT CODE</f><o>

  jj  <n>File.java</n>  [arg0 arg1...]      [/c] [> File]  #execute <n>JAVA-file</n>
  jj  File[.jj]  [arg0 arg1...] [/s] [/c] [> File]  #execute simple_JAVA
</o>
To execute JAVA file, you need to specify JVM parameters and class-path.
Since these parameters have been already set in the framework, no need to point them
when calling the command <o>jj</o>.

Small programs(<n>.java</n> or <m>.jj</m> ) may be used to generate data in the <a href="#dat">###-format</a>
or for the simple data processing.

Example 1, <n>pik3d/usr/minMAJ.java</n> ("minor vs MAJOR"):
  Chord  =  combination of three harmonics with frequencies:
    <n>minor</n> chord:  1, <n>6/5</n>, 3/2  - tonic, <n>minor third</n>, quint
    <r>MAJOR</r> chord:  1, <r>5/4</r>, 3/2  - tonic, <r>MAJOR third</r>, quint

<n>public class minMAJ
{
  static public void main( String[] arg )
  <r>{</r>
    System.out.println("### minMAJ [ 201, 3 ]");                 <y>// ### Stack Header</y>
    for(int i=0; i&lt;=200; i++) {
       var t = i*( 2*Math.PI/10 );                               <y>// 10 points/period</y>
       var k = Math.sin( t ) + Math.sin( t*3/2 );                <y>// tonic + quint</y>
       System.out.println( i/10.+"\t"+( k + Math.sin( t*6/5 ))   <y>// minor</y>
                                +"\t"+( k + Math.sin( t*5/4 ))); <y>// MAJOR</y>
    }
  <r>}</r>
}</n>
> <o>jj</o> <n>minMAJ.java</n>                                             <y># output to the console</y>
> <o>jj</o> <n>minMAJ.java</n> <m>/c</m>                                          <y># only compile</y>
> <o>jj</o> <n>minMAJ.java</n> | vics - 1 2 3,8                            <y># simple display</y>
> <o>jj</o> <n>minMAJ.java</n> | vics - 1 "2 1 0 minor_: 1, 6/5, 3/2" "3 8 0 MAJOR: 1, 5/4, 3/2"

By the way, pay attention to the failure of the frequency for the minor on 5th
and 15th periods - this is the reason why the minor sounds sad.

If you need to input and process <a href="#dat">###-files</a>, program must inherit the I/O library <r>pik.io</r>.
Example 2, <n>Reverse.java: "Stack with Frames in Reverse order"</n>:

<n>import java.util.*;
import <r>pik.*</r>;

public class Reverse <r>extends io</r> {
  public static void main( String[] arg ){
    try{ new Reverse(arg); clott();}
    catch( Exception e ){ e.printStackTrace();}
  }
  Reverse( String[] arg ) throws Exception
  <r>{</r>
    cmd("Reverse", arg, "Stk > ktS");                <y>// check input arg[]</y>
    var stk = inStk( arg[0] );                       <y>// stk[ kk ][ii][jj]</y>
    int k = stk.length;
    while(k-->0) ttFrame( stk[k], arg[0]+"_"+(k+1)); <y>// output in reverse</y>
  <r>}</r>
}</n>

To create a Stack for experiments( pik3d must be installed ):
  1. go to the folder:  pik3d/demo/bell2
  2. > gen3d bell2.gen > Stk                         <y># Stack generation</y>
  3. > s3d Stk                                       <y># view Stack in normal direction</y>

> <o>jj</o> <n>Reverse.java</n> Stk > ktS                          <y># save result to stack: ktS</y>
> <o>jj</o> <n>Reverse.java</n> Stk | s3d -                        <y># display in reverse</y>

A more advanced way is to use <o>jj-preprocessor & executor</o>.
File<o>.jj</o> contains only <n>subject part</n> of the program( delimited by <r>red curly braces</r> ).
Example 3, pik3d/usr/<m>Reverse.jj</m> (functionality is the same as previous <n>.java</n> example):<n>
<r>{</r>
    cmd("Reverse", arg, "Stk > ktS");                 <y>// check input arg[]</y>
    var stk = inStk( arg[0] );                        <y>// stk[ kk ][ii][jj]</y>
    int k = stk.length;
    while(k-->0) ttFrame( stk[k], arg[0]+"_"+(k+1));  <y>// output in reverse</y>
<r>}</r></n>
> <m>jj Reverse</m> Stk > ktS                                <y># save result</y>
> <m>jj Reverse</m> Stk | s3d -                              <y># display</y>
<r>
  ATTENTION: if file(<m>.jj/</m><n>.java</n>) contains NON-ENGLISH characters, <n>ENCODING must be UTF-8</n></r>
<a name='jjf'></a>________________________________________________________________________________________
<o>
	jj - preprocessor & executor :
</o>
  - import most of the required packages( can be added if need )

  - generate correct <n>JAVA file</n>, which can be saved(<r>/s</r>),e.g. <m>Reverse.jj</m> -> <n>Reverse.java</n>

  - run <n>JAVA</n> to execute <n>file.java</n> or generated from <m>file.jj</m> ( <n>jdk/javac</n> is required )

  - execute several <n>JAVA commands</n> directly from the command line

  - if you need <n>.class</n> files (result of compilation), use key: <r>/c</r>

  - support <m>macro substitution</m> - code modification during jj-call, e.g. <n>values</n> or even
    <n>code snippets</n> can be inserted into the generated java file just before compilation,
    see: <m>pik3d/usr/Fx|Fxy|Fxyt.jj</m> - symbolic function formula in the computational loop

  - argument list may be enclosed into the <m>Argument file</m>, which serves as configuration
    file with the ability to contain <n>a code fragments of several lines</n>

  - OS batch <m>script.jj</m>( OS-commands, pipes...) with control code on <n>JAVA</n>, see: <a href="#jjscr">example</a>
    <m>script.jj</m> can be compiled and saved as <n>.class</n> file with <n>.exe-Launcher</n> .


<o>jj supports Short Name Functions</o>,  arguments can be  <n>double, float, int</n>,
   fun(<r>...</r>) denotes use of <r>'varargs'</r>, i.e. possible: fun(a), fun(a,b), fun(a,b,c) ...

   <m>tt(String), tt(...)</m>  - output arguments  to std.OUT
   <m>ee(String), ee(...)</m>  - output arguments  to std.ERR
   <m>hh(), hh(i),hh(i,j)</m>  - output ###-header to std.OUT, i-number of rows, j-columns

   <m>min(...) , max(...)</m>  - minimum, maximum value
   <m>sqr( a )</m>             - square root of a = pow( a,.5 )
   <m>abs( a )</m>             - absolute value
   <m>erf( a )</m>             -"Error Function", sigmoid: -1 < erf() < 1
   <m>gau()</m>                - Gaussian random: mean=0, R=2*sigma = 1
   <m>rnd()/rn1()</m>          - uniform  random: [0,1] / [-1,1]
   <m>p( x,y )= pow( x,y )</m> - "x to the y power", e.g.  p(5,2)=25;  p(8,1/3.)=2

   <m>sin(a), cos(a), tg(a),   asin(a), acos(a) ,atg(a),   e(a)= exp(a), ln(a), lg(a)</m>
   constants:  <m>pi=3.1415..., rad=180/pi</m>

Folder: <o>pik3d/usr</o> is the default repository for <o>.jj</o> and <n>.java</n> files.
If path before file name is omitted, the search sequence: current folder, <o>pik3d/usr</o>.
By default, the file extension is assumed to be <o>.jj</o> ( can be omitted ).

The general form of <o>code.jj</o> is :
-------------------------------------------------------- <m>code.jj (more: pik3d/usr/*.jj):
[ <n>import pkg;</n> // special packages for this task ]
[ <y>comments:   /* text ... */   or   // text ...</y> ]
<r>{</r>
   <n>JAVA code uses <r>arguments</r> of function: main( String <r>arg[]</r> )</n>

   <n>MACRO Substitution</n> can be used: <n>#0#</n> &lt;-a0, <n>#1#</n> &lt;-a1... <n>#A#</n> &lt;-a10... <n>#F#</n> &lt;-a15 ...
   Up to 36 parameters will be replaced or removed( if NO arg.) before Compilation.
   see examples: pik3d/usr/Fx.jj| Fxy.jj| Fxyt.jj

 $ </m>app1 | app2 ...<m>  ! run </m>applications or pipe<m>.  Quotes use: $ </m>app1 "..\"...\".."...<m>
                    !  or <n>java:  var s="app1 \"..\"...\"..\"..."; sys( s );</n>
 $ <n>#cmd1</n> <r>&</r> </m>app1<m>...  ! shell( <n>#</n> ) <n>commands</n>  and  several( <r>&</r> ) </m>applications<m> without pipe
<r>}</r>
[ <n>methods,  classes( not public ),  static  ...</n> ]</m>
----------------------------------------------------------------------------------------
Examples:
<n>minMAJ.java</n> example (see above) in <m>jj-form( pik3d/usr/minMAJ.jj )</m> :
<r>{</r><m>
   hh();                                           <y>// ### Stack Header</y>
   for(int i=0; i&lt;=200; i++) {                     <y>// cycle</y>
      var t = i*( 2*pi/10 );                       <y>// 10 points/period</y>
      var k = sin( t ) + sin( t*3/2 );             <y>// tonic + quint</y>
      tt( i/10., k+sin( t*6/5 ), k+sin( t*5/4 ));  <y>// t  minor  MAJOR</y>
   }</m>
<r>}</r></m>
----------------------------------------------------------------------------------------
Programmable Text Processor( <m>pik3d/usr/txt2htm.jj</m> ):
If you need some text processing, you can use this template:
<r>{</r>
  <m>var s=""; if( opnStr( arg[0])) while(( s=getStr() )!=null)  <y>//read Line from file</y>
  {
    if( !s.isEmpty()) tt("&lt;DT>&lt;A HREF=\""+s+"\">"+s+"&lt;/A>");  <y>//text processing & print</y>
  }</m>
<r>}</r>
This example converts text list of Links to the html-list.
><m> jj  txt2htm  Links.txt  > Links.html</m>
<a name='jcc'></a>________________________________________________________________________________________
<o>
    Execute several <n>JAVA</n> commands from the command line:

    > jj "<n>jcmd1; jcmd2; jcmd3; ...</n>" [/s] [/c] [> File]
<x>    > jj <r>'jcmd1; jcmd2; jcmd3; ...'</r> [/s] [/c] [> File]  # <r>single</r> quotes</x>
</o>
Additional very handy feature of <o>jj-preprocessor</o> is to execute the sequence of <n>JAVA</n>
commands directly from the command line. In this case  file: <n>Noname.java</n>  is produced
and executed. To save it use <m>/s</m> or <m>/n=&lt;name></m>, e.g. <m>/n=p23</m> -> <n>p23.java</n> .
	 ____________________________________________________________
	|                                                            |
	|                      !!! ATTENTION !!!                     |
	|                                                            |
	|  Since the <r>double quotes "</r> is a special character for the  |
	|  command line, internal JAVA quotes must be escaped:  <r>\"</r>   |
	|  > jj "tt( <r>\"</r> Hello World <r>\"</r> )"                            |
	|____________^______________^________________________________|

<x>If <r>single</r> quotes are used in Linux, no need to escape <r>double</r> quotes !!!
e.g. > jj <r>'</r>for(int i=0;i<9;i++) tt(<r>"</r> i=<r>"</r>+i)<r>'</r>    # 2nd example below    </x>

<n>JAVA commands</n> are delimited by <r>';'</r> (last <r>';'</r> before closed <r>"</r> may be omitted ).
Examples( ^C/^V  to test jj and pik3d ):

> <m>jj "tt( max( .9, pi/2, pi-1), 4*pi, sin(-pi/4))"              </m><y>#use of<r>'varargs'</r> in tt()</y>
> <m>jj "for(int i=0;i<9;i++) tt(\" i=\"+i)"                       </m><y>#print i=0/i=1/i=2...i=8</y>
> <m>jj "hh(); for(var x=0.;x<=20;x+=.2) tt(x,e(-x/7)*sin(x))"|vic - 1 2,11 </m>       <y>#2d-plot</y>
> <m>jj Fx  "e(-x/7)*sin(x)" "0,20,.2"| vic - 1 2,11               </m><y>#same as previous line !</y>
> <m>jj Fxy "e(-(x*x+y*y)/9)*cos(x*x+y*y)" "-4,4,.1" "-4,4,.1"|s3d - Fxy.s3d </m>      <y>#3d-plot</y>
<a name='jaf'></a>________________________________________________________________________________________
<o>
	jj: Argument File
</o>
Any part of the argument list for the <m>jj-program</m> can be included into the <n>Argument File</n>,
which serves as a configuration file in accordance with the following rules:

1. File has extention <n>.arg</n> !

2. May contain emptyt lines  and  <y>Comments:
   - lines start with symbol: '!' or '#' or part of the line after these symbols ;
   - lines preceding the first argument definition  and  do not contain <r>':'</r>.</y>

3. Arguments are numbered sequentially. If arguments starting from m to n are selected
   to place into the <n>Argument File</n>, then numbering is from m untill n inclusive.
   Example:
   > jj pro.jj <m>a0 a1 a2 a3 a4 a5  ...</m>     <y>#suppose  <m>a2 a3 a4</m>  are placed to  <n>FF.arg</n></y>
   > jj pro.jj <m>a0 a1 <n>FF.arg</n>   a5  ...</m>     <y>#equivalent call of pro.jj, where: <n>FF.arg</n>
                                          defines:  <m>a2 a3 a4</m>  values</y>

               <r>!!! Attention:</r> this <n>FF.arg</n> defines:  <m>a0 a1 a2</m> in call> jj pr1 <n>FF.arg</n> <r>!!!</r>

4. Argument Value starts after <n>Label</n> - any text possibly with spaces ending with <r>':'</r>.
   <r>Label is not included</r> in the argument Value and serves only as indicator and comment.
   Argument Value  can be located  in the next line  after the Label.
   Spaces and  symbol 'new line'  before and after  the significant part of the argument
   are removed  from the argument Value.

5. Argument can consist only of a Label, in this case argument Value is empty.

6. The argument definition  is ended by  <n>empty line,  comment line,  next argument</n>.

7. Multi-line argument consists of a Label followed by  several lines  witout comments
   and  empty lines.  For example, it could be  several lines of code  or  data  for
   macro substitution.

Example:  <m>Argument File</m>  to call  <m>pik3d/usr/Fxyt.jj</m>  ( see Help > jj Fxyt ):
<n>---------------------------------------------------------------------------- ff.arg ---</n>
  arguments  to call Fxyt.jj   - this is comment
<y>
<n>    0_arg Functin( x, y, t )<r>:</r>
      exp( -(x*x+y*y)/9 ) * cos( x*x + y*y - t*.2*pi )  </n># function definition
<n>
    1_arg X0, X1, dx <r>:</r>  -4, 4, .1       </n># start_X, end_X, dX
<n>
    2_arg Y0, Y1, dy <r>:</r>  -4, 4, .1       </n># the same for Y: for( y=Y0; y<=Y1; y+=dY )
<n>
    3_arg t [ ]      <r>:</r>   0, 9,  1       </n># for( t=0; t<=9; t++)
---------------------------------------------------------------------------------------</y>
> jj Fxyt <n>ff.arg</n> | s3d - Fxyt.s3d , 0   <y>#the same result as 3d-call from Help(> jj Fxyt)</y>

Sometimes it is convenient to create  <n>Argument File</n>  directly from the command line.
This can be done using the OS-command: <r>echo</r>  or  with specially created <a href="#pls">command: pl </a>
e.g.
> <r>echo</r><n> fset: 1, x, x*x ...       </n>>  file.arg
> <r>echo</r><n> read: x=X[0], V=X[1] ...  </n>>> file.arg     <y># >> = add to the end of File</y>

<a href="#pls">Command: pl </a>simply prints all arguments( each on a new line ) to standard output,
e.g the same file.arg as above:

> <r>pl</r>  <n>"fset: 1, x, x*x ..."  "read: x=X[0], V=X[1] ..."</n>  > file.arg
<a name='jmm'></a>________________________________________________________________________________________
<o>
	jj: Macro Substitution:  #p[/default]#
	          <n>Request:</n> #<n>?prompt</n>[/default]#
</o>
Where: <o>p=<m>'0..9','A..Z'</o>(maximum 36 parameters), <m>default</m> is used if NO <o>p</o>-argument.
Replace macro-parameters <m>#p#</m> before converting:  <m>.jj --></m><n> .java</n>  and  compilation.
If <m>/default</m> is absent  and  <n>call argument</n> is empty,  <m>#p#</m>  will be removed.

<n>Request</n> prints to the console <n>prompt</n> and (<m>default</m> if exists) and  after  keyboard input
replaces <m>#<n>?prompt</n>/default#</m>  with entered text  in the same way as <m>macro</m>.

Consider jj-call: <m>> jj File.jj  </m><n>a0 a1 a2 ... a15 ...</n>
If any <n>argument</n> contains a symbol <space>, it must be enclosed in <r>double quotes "</r>.
<m>#0#</m> will be replaced in <m>jj-file</m> by the <n>text of a0</n>, <m>#1#<n> -a1 ... </n>#A#<n> -a10 ... </n>#F#<n> -a15 ...</n></m>
If there is no <n>argument</n>, but <m>default</m> is defined, parameter will be replaced by <m>default</m>.

	<m>default</m> value cannot contain character <r>" double quotes !</r>

Parameters(<n>a0,a1,a2...</n>) can contain several text lines or java-commands(delimited by <r>;</r>).
A multi-line parameter can be defined only in  <o>Argument File</o>.

Example: <n>pik3d/usr/Fx.jj| Fxy.jj| Fxy.jj</n> analytical expression of the Function &
parameters, <m>#0#,#1#,#2#</m> are inserted to the <n>.java</n> file in text form by means of <m>jj-macro</m>

><m>jj Fxy</m>    ! print Help of <n>Fxy.jj</n>, try to execute 3-d call and view result.

It is important to understand that arguments which are refered as:
  - <n>arg[i]</n> - only input <n>i-argument</n> at <n>"run time"</n>;
  - <m>#p#</m>    - make <r>"hard-code"</r> replace of the <m>#p#</m> parameter at <r>"compile time"</r>.

<n>Request:</n> <m>#<n>?prompt</n>/default#</m> works in the same way: entered text is set to the <r>java-code !</r>

Compare use of <n>arg[0]</n> in txt2htm.jj  and  <m>#0#,#1#,#2#</m> in Fxy.jj  (folder: <m>pik3d/usr</m>).
  - pik3d/usr/txt2htm.jj - <n>arg[0]</n> symply input file name of the file at <n>"run time"</n>;
  - pik3d/usr/Fxy.jj - <r>java code is changed</r> by text insert of the function expression
                       and calc.limits, you can see this to save(/s) .java file.

These capabilities can be used together. You can specify the processing code with
<m>Argument File</m>  and  current parameters with  <n>arg[i]</n>,  for example:
<m>F.arg( #0#, #1#, #2# )</m>  and  <n>arg[3], arg[4], arg[5] ...</n>   > <m>jj app F.arg</m>  <n>a3 a4 a5 ...</n>

Examples of using <m>macro</m> and <n>request</n>, look at <n>Noname.java</n> (<n>/s</n> is used) :

> jj dbg123 7 9 3 <r>@S</r>               <y># create test <R>S</r>tack: S[i,j,k] = i*100 + j*10 + k</y>

> jj "tt( getSTi( <n>arg[0]</n>, <m>#1/1#, #2/2#, #3/3#</m>))" <r>S</r> 5 7 2          <n>/s</n>   <y># S[5,7,2]</y>
> jj "tt( getSTi( <n>arg[0]</n>, <m>#1/1#, #2/2#, #3/3#</m>))" <r>S</r> 4              <n>/s</n>   <y># S[4,2,3]</y>

> jj "tt( getSTi(\"<m>#0#</m>\", <m>#<n>?inp.i</n>/5#, #<n>?inp.j</n>/4#, #<n>?inp.k</n>/1#</m>))" <r>S</r> <n>/s   # inp. i ... ???</n>
<a name='jos'></a>________________________________________________________________________________________
<o>
	jj  script  with  Operating System  commands
</o>
It is convenient to save the worked out sequence of commands in a batch script.
<m>jj</m> supports calling applications, shell-commands, pipes .

Since <m>jj</m> contains <n>JAVA</n> code, it can support complex control logic of the processing.
In addition, you can save <n>.java (/s)  or .class (/c)</n> files of the script  and  create
<a href="#cex">.exe Launcher</a>.

 <r><u>$</u></r><m> app1 <r>&</r> app2<r>|</r> app3... <r>></r> F1 <r>&</r> app4<r>|</r> app5... <r>></r> F2</m>   <y># run applications, pipes and output</y>

In <n>Java</n> it looks like:  <n>sys("""</n>
 <r><u>$</u></r><m> app1 <r>&</r> app2<r>|</r> app3... <r>></r> F1 <r>&</r> app4<r>|</r> app5... <r>></r> F2</m><n> """);</n> <x>//in Linux <r>&&</r> must be used</x>

A lot of OS-commands are implemented as <n>shell-commands</n>:
Windows cmd-shell:  <n>dir, cd, echo, md, rd, copy, del, ren, type ...</n>
<x>Linux Bash-shell: ls, cd, echo, cat, cp, mv, rm, mkdir, touch ...</x>

To use <n>shell-command</n> <r>'#'</r> must be used at the beginning of the command,e.g. <r>$ #</r><n>copy F1 F2</n>

Since <r>$ ...</r>  is considered as a <n>Text Block</n>, you can freely use <r>" -double quotes</r>
in <m>jj-files</m> without escaping, but <r>be careful</r>  when using it on the <r>command line</r>.

Command <r>$ ...</r> may be used in one line with other <n>JAVA commands</n>, e.g.
> jj "<n>ee(\"_______ *.jj _______\n\")<r>; $ #dir *.jj; </r>ee(\"__________________\")"</n>
<x>$ jj 'ee("------- *.jj -------")<r>; $ #ls *.jj;</r>ee("--------------------")'</x>
<a name='cex'></a>________________________________________________________________________________________
<o>
     command:  crex   F.jj | F.java     # <r>CR</r>eate <r>EX</r>ecutable Launcher
</o>
For any file that can be executed by the <a href="#jj">jj-processor</a>, you can create an executable
Launcher. Actions will be done by <m>crex</m> :
 - compile F
 - put  F, F.class  to the  pik3d/lib/usr.jar
 - create  F.exe    in the  current directory

	  <r>This is a way to extend the pik3d command set</r>
Steps:
 - Check that the file: <m>F.jj</m> or <n>F.java</n>  can be executed by the <a href="#jj">jj-processor</a>
 - Run <r>crex</r>:  > <r>crex</r>  <m>F (.jj is implied)</m> | <m>F.jj</m> | <n>F.java</n>
 - Check <r>F.exe</r>. If you don't like the name, you can rename it as you wish.
   <x>in Linux extension: .exe can be removed and Launcher moved to ~/bin/</x>

Example( <m>pik3d/usr/kbdstr.jj</m> ):
<y>// input String from the Keyboard and print it to the Console</y><m>
<r>{</r>     var s="";
  while( (s=getKbd("inp.String, exit=<space><Enter>","def_String")) !=null && !s.isBlank())
    ee(tab("length="+s.length(),52,1)+" | "+s);
<r>}</r></m>
> jj kbdstr          <y># check kbdstr.jj</y>
> <r>crex</r> kbdstr        <y># create Launcher: kbdstr.exe</y>
> kbdstr             <y># check Launcher</y>
<a name='clg'></a>________________________________________________________________________________________
<o>
     Creating a Launcher: general case.
</o>
Framework supports the creation of a Launcher for any java-program, not only for <m>pik3d</m>.
Below is an example of creating the Launcher: <r>scal.exe</r> for a <r>s</r>imple <r>cal</r>culator.
The source file can be taken from:  <n>pik3d\usr\</n><r>Scal.java</r>
<n>
package com.org.calc.aa.bb.cc;      // Strange package name only for demo. purposes

import java.io.BufferedReader;
import java.io.InputStreamReader;

public class Scal
{
  public static void main( String[] arg ){ new Scal( arg );}
  String gets(){
    try {
      return new BufferedReader( new InputStreamReader( System.in )).readLine().trim();
    } catch( Exception e){ q("\n"); return "";}
  }
  Scal( String[] arg ){
     while( true ){
        q("scal:  A (+-*/^) B,  if A|B=, -\"use last result\", (blank=exit): ");
        try {
           var s=gets();  int i=0;
           if( s.isBlank()) break;
           while( ++i < s.length()){
              var op=s.substring( i,i+1 );
              if("+-*/^".contains( op )){
                 double a = pars( s.substring( 0,i )), b = pars( s.substring( i+1 ));
                 switch ( op ) {
                   case "+" -> c=a+b;
                   case "-" -> c=a-b;
                   case "*" -> c=a*b;
                   case "/" -> c=a/b;
                   case "^" -> c=Math.pow( a,b );
                 }
                 q("\t\t\t\t\t\t\t\t"+c); break;
              }
           } q("\n");
        } catch( Exception e){ q("\n");}
     }
     q("__________________ end.\n");
  }
  double c=0;
  double pars( String s ){
     s=s.trim(); return s.startsWith(",")? c: Double.parseDouble( s );
  }
  void q( String s ){ System.err.print( s );}
}</n>
The difference between  Windows  and  Linux  is the use of path separators:
 - Windows: '\'  and  ';' in class-path ;
 - <x> Linux: '/' and ':' !!! </x>
The example below is for Windows.

Preliminary actions:
 - Choose folder for the project (will be refered to as root)  and  place
   <m>pik3d\exe\_Launch.exe</m>  there ;
 - Choose JAR-storage (e.g. <n>d:\usr\jars</n> ) for the Launcher  and  place
   <m>pik3d\lib\run.jar</m>  there ;
 - Create or copy source-code: <r>Scal.java</r> to the root .

1. Compile  <r>Scal.java</r>  without IDE :
   - run compiler( JDK must be installed ): > <r>javac Scal.java</r>
     <x> $ ~/jdk/bin/javac Scal.java </x>
   - create folder structure in the root:  <r>com\org\calc\aa\bb\cc</r> ,
     which  corresponts  to the   <n>package  com.org.calc.aa.bb.cc</n> ;
   - copy Scal-files there: > <r>copy Scal.*  com\org\calc\aa\bb\cc</r> .
     It is useful to have the source code along with the compiled one.

2. In the root folder try to run <n>Scal.class:</n> > <r>java com.org.calc.aa.bb.cc.Scal</r>
   <x> $ ~/jdk/bin/java com.org.calc.aa.bb.cc.Scal </x>
   In general case, a class-path option( -cp jar1;jar2;... ) may be required .
   Make sure the class-file works properly .

3. Create    <r>scal.jar</r> , which contains the structure:

                        <r>com\org\calc\aa\bb\cc\Scal.class</r>

 > <r>jar</r> -c -f <r>scal.jar</r>   com\org\calc\aa\bb\cc\<r>*</r>            <y># use java jar utility</y>

4. Copy  <r>scal.jar</r>  to the chosen JAR-storage (e.g. <n>d:\usr\jars\*</n>, <m>run.jar</m> is there ).
   This storage will be hard-coded into the Launcher:  lib/jar:  <n>d:\usr\jars\*</n> !

        <n>It is possible to collect class structures into a single JAR in the storage</n>

5. Create Launcher config.file:  <r>scal.cfg</r> :

   jdk/bin:  <n>d:\jdk\bin</n>                      <y># location of the java.exe</y>
   lib/jar:  <n>d:\usr\jars\*</n>                   <y># class-path to  <m>run.jar</m> and <r>scal.jar</r></y>
 <y># lib/jar:  JAR-storage\*;jar1;jar2;...     # general case</y>
   <r>scal</r>:  <n>java  com.org.Calc.aa.bb.cc.</n><r>Scal</r>   <y># exe-name, executor, reference to .class</y>
                                             <y># exe-name can be anything !</y>
6. Create Launcher: > <r>_Launch  scal.cfg</r>

7. Place <r>scal.exe</r> in any folder specified in the PATH environment variable or  <x> ~\bin </x>
<a name='zip'></a>________________________________________________________________________________________
<o>
     command:  adzip  ZIP  F1 [ F2 F2 ... ]    # <r>AD</r>d Files to <r>ZIP</r>
</o>
The added files may contain a  <n>PATH</n>,  e.g.
> adzip  q.zip  <n>com/org/test/ver_1/calc.jj</n><y>
#   Structure:  <n>com/org/test/ver_1/calc.jj</n>  will be created in</y>  q.zip !
<a name='eeh'></a>________________________________________________________________________________________
<o>
     command:  ee  [text]    # print to std.ERR current time & text
</o>
an be used to mark execution steps and timing of a script or pipe-line.
Since this command stop pipe-line, it is recommended to use it as 1st. or the last when
joining commands to a pipe-line. And use symbol <r>'&'</r> after and before it !
  e.g.
> ee _______start <r>&</r> get Stk[:3,:#5] <r>|</r> tt <r>&</r> ee _______ End.    <y>!looks like:</y>
<n>  02:44:12.715  _______start

  ### p1 [ 3, 5 ]
   337           326           310           294           283
   339           334           318           295           273
   336           321           328           312           292
  02:44:13.330  _______ End.</n>
<a name='pls'></a>________________________________________________________________________________________
<o>
     command:  pl  L1 [ L2 ... ]    # <r>P</r>rint <r>L</r>ines to std.OUT/ console
</o>
May be considered as multi-line extention of the system command "echo".
Lines are separated by the symbol <r>'space'</r>. If a string contains a space, it must be
enclosed in quotation marks. Single quotes can be used in Linux OS.
<r>! Attention, pl command  DOES NOT support  @File  in pipe-line !</r>

This command can be used to create  <a href='#jaf'>Argument File</a>  or  data File in <a href='#dat'>###-format</a>,
e.g.
> <r>pl</r> "fset: 1,x,x*x..." "read: x=X[0],V=X[1]..." >file.arg  <y>#Arg.File to find Regression</y>
> <r>pl</r> "###[]/ 1 2 3 4 5 6 7" > L7  &  tt< L7                 <y>#<n>"One Line Frame"</n> L7[ 7 ]</y>
> <r>pl</r>  ###[] "1 2 3 4 5" "11 22 33 44 55" "-9 -8 -7 -6 -5" > Frame_3x5  <y>#Data File[ 3,5 ]</y>
<a name='sss'></a>________________________________________________________________________________________

  <o>command: s3d -"Surface-3d" display Matrix/ Frame and their sequences
</o>
	 <a href='#bb' >Startup, initial parameters</a>
	 <a href='#st' >Stack, Details, +Lines, +Body</a>
	 <a href='#cli'>View  Stack/ Frame, Clip</a>
	 <a href='#lig'>Size,  Position,  Light</a>
	 <a href='#os' >Map,  Axes,  Blur</a>
	 <a href='#ss' >Cross Sections</a>
	 <a href='#pal'>Colors, Opacity</a>
	 <a href='#cf' >Configuration</a>
	 <a href='#defcfg'>Standard/ initial Config.</a>

    <o>Coordinate system  and  viewing / lighting  angles</o>

Let's represent the matrix as a rectangle (diagram below).
Axis OX - "Rows" - direction from top to bottom.
Axis OY - "Columns" - direction to the right.
The upward direction above the XOY plane corresponds to the axis: OZ.

Consider a matrix element that is in the <r>i</r>-row, <r>j</r>-column and has the value <r>m[i,j]</r>

	O_____<r>j</r>_______Y        |<r>Z</r>
	|     |     |          |
	|     |     | ---3d--> |  <r>z=m[i,j]</r>
	|     |     |          |   |
	<r>i</r>_____<r>m[i,j]</r>|         O|___|__<r>y=j</r>______
	|           |          /   |  /     / Y
	|           |         /    | /     /
	|___________|       <r>x=i</r>____|/     /
	|                   /            /
	X                  /____________/
	                 X/
The matrix element can be displayed as a point in 3d-space: X - matrix row,
Y - matrix column, Z - element value. The set of such points forms a 3d-surface.

On the XOY plane, the element m[i,j ] corresponds to the square:  i-1&lt; x &lt;i,  j-1&lt; y &lt;j
The system provides two modes of surface display( <r>&lt;F4></r> - switching of view type ):
 - <r>Bars</r>   - a set of vertical rectangular bars
 - <r>Smooth</r> - a surface element can be inclined, convex, concave ...

The <o>observation point</o> is specified by two angles (<r>"Astronomical equatorial system"</r>):
 -<r>"hour angle"</r> - in the plane of the matrix from the OX-axis to the right to the OY-axis
                 in the interval [-180, +180] degrees;
 -<r>"declination"</r>- angle above the plane of the matrix: [-90,90] degrees.

Viewing angles can be changed with the mouse while pressing the button( drag ) and
in the Configuration Editor( call: <r>&lt;Ctrl+C></r> will be referenced below as <r>^</r> ).

The <o>position of the light source</o> is set by lighting angles.
These angles can be changed with the keyboard: <r>&lt;Ctrl> + &lt;arrows></r> and in the
configuration: <r>^C</r>.

Angles are measured in degrees and displayed in the window title:  <r>v(a,b),  *(c,d)</r>
where:
       <r>v - "view"</r>  - <o>viewing  angles</o>:  "hour", "declination"
       <r>* - "Light"</r> - <o>lighting angles</o>:  "hour", "declination"

All angles are saved in configuration parameters and can be set at startup.

Lighting angles greatly affect the view of a 3d-scene when they are close to viewing
angles. It is convenient to first select the viewing angles and then set lighting close
to view for fine tuning. This can be done by calling the config: <o>^C</o> and explicitly set.
<a name='bb'></a>
	<o>Startup, initial parameters</o>

> s3d [ Stk [ config | , [ main [ delaySec ]]]]

> s3d                               <y># a prompt to select a stack will be displayed</y>
> s3d   Stk                         <y># display Stack: Stk</y>
> s3d   Stk   config                <y># display Stack: Stk with config. of the 3d-scene</y>
                                    <y># By default config. file has extention: .s3d,</y>
                                    <y># if config. is absent, default config. is used</y>
> s3d   Stk   config       <r>main</r>     <y># it is possible to run several <r>s3d</r>, all follow up</y>
                                    <y># windows will be synchronized with this,</y>
                                    <y># i.e.  will show  frame number  as main.</y>
> s3d   Stk            <r>,</r>   main     <y># <r>default config.</r> for main.</y>
> s3d   Stk   config       main   <r>delaySec</r>    <y># delayed start.</y>

Example( start 4 synchronized s3d-windows ):
  It is useful to start several windows with synchronization from <r>.bat</r> or <r>.cmd</r> script
<n>
  s3d  q      <r>1</r>   <r>main   3</r>          <y># Stack q    , config=<r>1.s3d, "main"</r> with delay=<r>3</r> sec</y>
  s3d  qAR2   <r>2</r>                     <y># Stack qAR2 , config=<r>2.s3d</r></y>
  s3d  qmd    <r>3</r>                     <y># Stack qmd  , config=<r>3.s3d</r></y>
  s3d  qmd15  <r>4</r>                     <y># Stack qmd15, config=<r>4.s3d</r></y>
</n>
	<o>Shortening and denotation used in Help:
</o>
<r>menu> - Context Menu</r> is calling in any place of the s3d-window by pressing <r>Right Mouse</r>
        Almost all commands of the Context Menu can be executed with a key combination
<r>^ey  = &lt;Ctrl + Key></r> - simultaneously pressed  &lt;Ctrl> and &lt;Key>

<r>&lt;F1></r>  - Help - show file: <n>pik3d/pik3d_DOC.html</n> in a separate window
<r>&lt;F4></r>  - switching of the surface view mode: <r>"Smooth"/ "Bar View"</r>  at any time
<r>^C    -"Config"</r> - call the Configuration Editor
<a name='st'></a>
	<o>menu>  Stack, Details, +Lines, +Body
</o>
<r>^F</r> - Load Stack - open select file dialog
<r>^7</r> - Load Details( text file with Frame descriptions ) - open select file dialog
<r>^N</r> - loading the next stack and config.file( must be config.param.: <r>Next: Stk Cfg</r> )
     It is useful when viewing multiple stacks sequentially  or  one stack in several
     configurations( palettes, angles, blur, additions ... ).
<a name='lin'></a> <a name='pp'></a>
<r>^2</r> - ON/ OFF <r>display Additions</r>, show menu to select: 1-Points, 2-Lines, 2-Body
<r>^1</r> - Load and display Additions: <r>"Points"/ "Lines"/ "Body"</r> - show menu to select: 1|2|3
     Default file extensions: <n>.pnt | .lin | .bdy</n>
     The text file contains descriptions of 2d and 3d-lines( can be mixed in one file ).

     The <r>2d-Line</r> is given by the coordinates of the points that lie on the "Map".
     Points allowed outside the "Map", but only fragments of lines that are on the "Map"
     will be displayed.

     The <r>3d-lines</r> contains 3 coordinates( X,Y,Z-Vertical). Only fragments of 3d-lines
     which are inside the axes box will be displayed.

     Line coordinates are specified in files with <a href='#dat'>###-format</a> ( see demo/lines/*.lin ).
     The number of columns = 2 or 3 corresponds to 2d or 3d-Line.
     The number of rows = the number of the Line points(may be =1 -sphere is displayed).

     The header contains <r>2 additional parameters</r>:
         <r>c=RRGGBB</r>[<r>_op</r>] - Color in hexadecimal format and may be <r>Opacity[%] in decimal!</r>
                         default for Points and Lines: c=0 -BLACK, Opacity=100% ;
         <r>w=N_pix </r>      - Line Width/ diameter/ size  in pixels, default: w=1 .
Examples:<n>
  ### 3d-Rect.Arc[ 4, 3 ] <r>w=17.5 c=99ffcc</r>  <y># Width=17.5p, Color=99ffcc, opacity=100%</y>
    40 100 180
    40 20  500
    20 20  500
    20 100 180

  ### 3d-Sphere[ <r>1,</r> 3 ] <r>C=ff9999_30 w=60</r>   <y># <r>Sphere:</r> diameter=60p, opacity=30%</y>
    27 57 430

  ### <r>2d</r>-Rectangle[ 5, <r>2</r> ]                 <y># default: c=0, w=1, opacity=100%</y>
    50   90
    50  107
    12  107
    12   90
    50   90</n>

<r>3d-Points</r> are described in the same way as <r>3d-Line</r>  and  may be loaded and displayed
in two ways: as 3d-Line or 3s-Points. Header parameter: <r>w=N_pix</r> defines the size
of the cube marker( default: w=3 ).

<r>Body</r> description is presented in <a href='#b3d'>b3d -"Body-3D"</a>.
<r>
  Important:  Additions  are displayed  in the  current  coordinate  scheme,  i.e.
              if <a href='#os'>Subject-XY</a> is active, then the coordinates must be appropriate !
</r>
With Additions you can make enhanced markup of the "Map" and 3d-space, for example:
trajectories, coordinate grids, define boundaries, zoning...
<a name='cli'></a>
	<o>menu>  View  Stack/ Frame, Clip
</o>
<r>&lt;Drag></r> - Mouse movement while any button is pressed - <r>rotate 3d-scene</r>
         Angles in degrees are displayed in the window title: <n>v("hour","declination")</n>
         <r>Horizontal</r> Mouse movement - rotation around a Vertical Axis - <n>changes "hour"</n>
         <r>Vertical</r> movement - rotation around a Horizontal Axis -<n>changes "declination"</n>

<r>&lt;Left> / &lt;Right></r> - &lt;arrow keys> Previous/ Next  Frame
<r>&lt;Home> / &lt;End></r>   - "initial(1-st)"/ "End" Stack Frame
<r>&lt;Mouse Wheel></r>    - Frame "paging":  "Down"- forward, "Up"- backward

<r>&lt;Space></r>- Start/ Stop of the clip( sequential show frame by frame )
<r>&lt;Alt+F></r>- dialog "<r>F</r>rames <r>P</r>er <r>S</r>econd" in clip - config.param. <r>FPS</r>
<a name='s3F2'></a><r>&lt;F2></r>   - save clip in the multipage .tif-file( select file dialog )
         Show clip - <a href='#tif'>command: tif </a>
To <n>"opy"</n> Window image  to clipboard  for subsequent <n>"Paste"</n>:  <r>&lt;Alt + PrtSc></r>
<a name='lig'>
	<o>menu>  Size,  Position,  Light
</o>
<r>^+ / ^-</r>       - increase / decrease  by ~10%  <n>Window  size</n>    - config.param. <r>K</r>
<r>&lt;Shift+ H/ L></r> - increase / decrease <n>Vertical size</n> of 3d-scene - config.param. <r>Kh</r>
<r>&lt;Shift+ Left| Right| Up| Dn ></r> - <n>Shift 3d-scene</n> in the Window  - config.param. <r>Shift</r>
<r>&lt;Ctrl + Left| Right| Up| Dn ></r> - <n>Adjust Light Source</n>           - config.param. <r>Light</r>
<a name='os'></a>
	<o>menu>  Map,  Axes,  Blur</o>

<r>&lt;Alt+M></r>   - ON/ OFF Map display.

<r>^M -"Map Only"</r>- ON/ OFF TOP view of the matrix/ frame, i.e. standard matrix view:
     rows to the Down, columns to the Right, value has color from "palette".

<r>^D -"Map Down"</r>- Lower/Raise "Map" half the height of the OZ axis.
     Standard Map position is on the minimum value of the OZ axis.

<r>^A -"Axes"</r>- ON/ OFF Axes display.
<a name='cob'></a>
<r>^X -"Z: MAX/min,  Subject X,Y"</r> - dialog to define parameters of the vertical Z-axis
     and  optionally  set  <n>"Subject" coordinates for X,Y</n>.
     If the checkbox: <r>"Automatic"</r> is checked - MAX/min are found from the Stack data.
     Clear it by pressing checkbox or <r>&lt;Tab></r> - transfer focus to the next component.
     Sliders can be moved by Mouse or Keyboard: <r>&lt;Left>,&lt;Right>, &lt;Home>,&lt;End></r>.
     While changing value by slider image changes immediately. It gives opportunity
     to do fine adjustment of MAX/min and surface colors.
     The value can be entered from the keyboard. To activate new value press &lt;Enter>.
     Image will be updated. If <r>&lt;Esc></r> is pressed, the dialog closes and the image
     is returned to its original state.

     To set <n>"Subject" coordinates for X,Y</n> select check box and enter <r>min/MAX</r> values.
     Values can be both positive and negative. The only requirement is <r>min < MAX</r>.
     These parameters affect only the marking of the axis in the plane XOY.
     All additions will be removed after changing them. After re-adding their
     X,Y coordinates will correspond to the new markup.

     <r>The measurements on the "Map"</r> also correspond to the selected <r>Subject Coordinates</r>.

     If check box <r>"Subject Axes"</r> is not selected - the XOY marking correspods
     to the Frame size:  Xmax=Row_Number, Ymax=Column_Number .

<r>^B - "Gaussian Blur"</r> - call Smoothing dialog.
     The parameter is <r>"RADIUS of Gaussian bell"= 2*sigma</r> - is the visual size and
     characteristic smoothing size( fragments > RADIUS remain after filtering ).
     Fine tuning can be done by pressing the &lt;arrow-keys>: <r>&lt;Left></r> or <r>&lt;Right></r>.
     At the end of the dialog, you need to click the button: <r>Save</r>. In case of <r>&lt;Esc></r>
     the dialog closes and the image is returned to its original state.

DURING DIALOGUES: <n>^X,^B,^O</n>  angles can be changed  and  <n>^A,^D,^M,&lt;F4></n>  can be used.

<r>&lt;Ctrl>+Mouse CLick</r>-"Read Value" pointed by cursor and Write it to the editable window.
         The cursor must point the "Map" while "Map Down" or "Map Only" view.
         Record contains:  <n>Frame number:  [ row, column ] = value</n>.
         To save text in the editable window: select text and click ^C (copy).
         Paste (^V) it in any convenient Text Editor.
         This functionality may be used to draw <a href="#lin">lines<a> on the "Map".

  Example (contains useful tricks for working with <r>^X, ^B, ^O</r> ):
  Go to folder: <n>pik3d\demo\bell2</n>, start: <n>_run.cmd</n>, stop at frame 10-14 &lt;space>.
  Press the buttons in sequence:
       <n>^B</n> &lt;Tab> <n>2</n> &lt;Enter> &lt;Enter>
       <n>^X</n> &lt;Tab> &lt;Tab> <n>12</n> &lt;Tab> &lt;Tab> <n>-6</n> &lt;Enter> &lt;Enter>

  From the slider to slider in <n>^X</n> dialog  you can navigate  using the arrows: <n>UP/DOWN</n>.
       <n>^B</n>                 <y>! <r>Blur</r> changing:</y>
          <n>&lt;arrow RIGHT></n>   <y>! press and hold until the picture stops.</y>
          <n>&lt;arrow LEFT ></n>   <y>! press and hold until you reach a convenient Blur.</y>
                &lt;Enter>
       <n>^O</n>                 <y>! <r>Opacity</r> changing:</y>
          <n>&lt;arrow LEFT ></n>   <y>! press and hold until Surface disappears.</y>
          <n>&lt;arrow RIGHT></n>   <y>! press and hold until you reach a convenient Opacity.</y>
                &lt;Enter>
<a name='ss'></a>
	<o>menu>  Cross Sections
</o>
View as 2d-graphs all values of <n>i-row</n>, <r>j-column</r> and <m>value[i,j]</m> through all Stack.
This mode can be enabled after <r>^D="Map Down"</r>, cursor must point ij-element on the "Map".
If  "[i,j]=value"  is displayed near the cursor, then mode can be activated.

<r>^V</r> -ON/ OFF <m>"Cross Sections"</m> mode.
    Two lines: <n>i-row</n>, <r>j-column</r> will be shown on the "Map" and  three new 2d-windows.
    Pressing <r>^V</r> again turns OFF Sections.

Moving Sections by &lt;arrow keys>:
<n>&lt;Alt + Dn>    = "Next      row"</n>
<n>&lt;Alt + Up>    = "Previous  row"</n>
<r>&lt;Alt + Right> = "Next     column"</r>
<r>&lt;Alt + Left>  = "Previous column"</r>
<a name='pal'></a>
	<o>menu>  Colors, Opacity
</o>
<r>^O -"Opacity of Surface"</r>, open the dialog to select Opacity[%] -"lack of transparency".
     If Opacity=  0, it means full transparency, i.e. surface and "map" is not visible.
     If Opacity=100, it means surface and "map" is not transparent.

<r>^P -"Load Palette"</r>, prompt to select a Palette file( default extention <r>.pal</r> ).

"Palette"- a Set of Colors which define the color of the element,depending on the value.
Specified by a file in the <a href='#dat'> ###-format </a> and  consists of strings that
associate  a value  and  a color. The minimum corresponds to 0, the maximum --> 1.
Can have any number of intermediate values.

Color of the element is calculated as a linear interpolation between neighboring
table values. Points below the minimum have the color of the minimum.
              Points above the maximum have the color of the maximum.

The color in the palette can be set in 2 ways::
  - <r>Red</r>  <g>Green</g>  <n>Blue</n>  ! three values:  0 <= <r>Red</r>, <g>Green</g>, <n>Blue</n> <=255;
  - <r>RR</r><g>GG</g><n>BB</n>            ! hexadecimal color representation.

Example:  Standard Palette   (definitions are equivalent):
<n>
  ### Stand.Palet [ 6, <r>4</r> ]  |   ### Stand.Palhex [ 6, <r>2</r> ]
  !Value   R     G     B    |   !Value  RRGGBB
    0     255   255   255   |     0     ffffff
    .2    166   255    77   |     .2    a6ff4d
    .35     0   255   255   |     .35   00ffff
    .57    79   134   236   |     .57   4f86ec
    .8    255     0     0   |     .8    ff0000
    1     255   217   102   |     1     ffd966
</n>
The user can create any number of palettes for different cases.
To get RGB colors, you can use the dialogs: <r>^8 or ^9</r> ( Custom Color.../ RGB| WEB ).

<r>^0 = &lt;Ctrl + Zero ></r> - Load "Standard Palette"

<r>^8 -"Details(text) Color"></r> - call the dialog to select: FontSize, Color[_Opacity].
     cfg_default:   Text:  12, 4d4d4d   # font=12, color=4d4d4d, opacity=100 %

     <r>!!! Attention:</r> Color definition has mix of formats <r>!!!</r>
     The Color: in  <r>Hexa</r></m>decimal <r>RR</r><g>GG</g><n>BB</n>, the Opacity: in <r>Decimal(%)</r>,  e.g.
                    <font color=008b8b>8b8b_70             # darkcyan, Opacity= 70 %</font>  (<r>RR</r> is absent!)
                    <font color=800080>800080              # purple  , Opacity=100 %</font>

<r>^9 -"Background Color"</r>- opens the dialog to select the color of the 3d-scene.
     cfg_default:   f2f2f2              # Opacity of the Background is always 100 %
     The Background Color can be associated with a specific stack type.

The Palette File, selected Colors, Opacity can be seen/edited/saved in CONFIGURATION: <r>^C</r>
and  <r>^S / ^R</r> - Save / Restore  config. in memory.

Examples can be viewed in  <n>demo/lines/*.pal</n> .
Good rviews of using Palettes and Colors:
<a href="https://eos.org/features/visualizing-science-how-color-determines-what-we-see">
   By S. Zeller and D. Rogers, 21 May 2020
   https://eos.org/features/visualizing-science-how-color-determines-what-we-see</a>
<a href="https://www.kennethmoreland.com/color-maps/ColorMapsExpanded.pdf">
   https://www.kennethmoreland.com/color-maps/ColorMapsExpanded.pdf </a>
<a name='cf'></a>
	<o>menu>  Configuration
</o>
All parameters: window position, dimensions, angles, colors, enabled functions ...
are stored in structure "CONFIGURATION". In the process of working with <o>s3d</o>, the user
sets these parameters, to get the desired display. A successful configuration can be
temporarily saved to memory <r>^S</r> and later restore - <r>^R</r>. Restore a saved configuration
or the configuration, that was at the moment of last stack load.

Viewing, editing and saving configuration in a file is possible after <r>^C</r> -"Config".
An editable text box displays ALL possible parameters. Parameters which have default
values are commented by <r>'#'</r>.  You can  edit, comment, uncomment  any parameter.

To simplify view before Saving, commented lines can be removed. While Loading Config.
the missing parameters  will receive default values  and  will be present  in Config.

The window can be closed without saving changes: <r>Cancel  or  &lt;Esc></r>.
When editing, you can change, remove or add  any  valid parameters.  After editing,
the configuration can be installed immediately or saved in a File. If some parameter is
removed from the config window, then  during  installation / loading  it will  receive
default value.  It is usful  to set in config. editor  angles of view/ lighting.

The new/edited configuration can be :
   button:  <r>Set</r>          - set immediately;
   button:  <r>Save in File</r> - save for later loading( <r>^L</r> ).

Config. file can be uploaded in 3 ways:
- <r>at the start of s3d</r> specify the name of the config. file after the stack name;
- <r>^L</r> - loading config file during operation (file selection dialog);
- <r>^N</r> - loading the next stack and config.file ( config.parameter: <r>Next: Stk Cfg</r> )
e.g. Next:  S2  cfg.s3d         <y># stk=S2, cfg=cfg.s3d</y>
     Next:  QQ                  <y># stk=QQ, cfg=current</y>
     Next:   ,  BW              <y># stk=current, cfg=BW.</y>
It is useful  when viewing multiple stacks  sequentially  or  one stack  in several
configurations( palettes, angles, blur ... ), see: demo/lines/*.s3d .
<a name='defcfg'></a>
<n>Standard/ initial Config.</n>       <r>Hot Keys to change</r> the parameter:
----------------------------------------------------------------------------------------
# Head:     null                <n>Text in the top-left corner can be set <r>only in Config</r></n>
# Details:  null                <r>^7</r> - dialog to select "Details" file<r>.txt</r>

# Text:     12, 4d4d4d          <r>^8</r> - dialog to set Font and Color of the Head & Details
# Back:     f2f2f2              <r>^9</r> - dialog to set Background Color
# Palette:  null                <r>^7</r> - dialog to select "Palette" file<r>.pal</r>

# Points:   null, <n>0</n>             <r>^1/1</r> - dialog to select file<r>.pnt</r>
# Lines:    null, <n>0</n>             <r>^1/2</r> - --:---:---:--:-- file<r>.lin</r>
# Body:     null, <n>0</n>             <r>^1/3</r> - --:---:---:--:-- file<r>.bdy</r>
                                <n>2nd param.= 1-display/ 0-no</n>  can be set:  <r>^2/ 1|2|3</r>

# Zmin,MAX: -.8362, 2.035       <r>^X</r> - dialog to set Z: min/MAX, <n>default: from the Stack</n>
# Subj.XY:  0,80,  0,120        <r>^X</r> - dialog to set Subject X,Y

View:       20, 25              <r>mouse Drag</r> of the Surface - adjust View Angles
Light:      -60, 30             <r>&lt;Ctrl+arrow></r> adjust Lighting Angles
x,y,W,H:    612,222, 640,520    <r>Mouse Drag Window, ^+/^- ></r> adjust Window location & size
Shift:      0, 0                <r>&lt;Shift+arrow></r> shift(px,py) the Scene in the Window

# K:        1                   <r>&lt; ^+ / ^- ></r>  - adjust Scale of the Scene
# Kh:       1                   <r>&lt;Shift+ H/L></r> - adjust Z-axis: <r>H</r>igher/<r>L</r>ower
# Bars:     1                   <r>&lt;F4></r> - switch View of the Surface: Bar/Smooth

# Axes:     0                   <r>^A</r> - ON/ OFF  display of the <r>A</r>xes
# MAP_Dn:   1                   <r>^D</r> - ON/ OFF  "Map <r>D</r>own"
# Only_MAP: 1                   <r>^M</r> - ON/ OFF  "Only <r>M</r>ap mode"
# NO_MAP:   1                   <r>&lt;Alt + M></r> - ON/ OFF "<r>M</r>ap display"

# Blur:     .5                  <r>^B</r> - Gaussian <r>Blur</r> of Surface
# Opac:     100                 <r>^O</r> - dialog to set Surface <r>O</r>pacity
# FPS:      10                  <r>&lt;Alt+F></r> - "<r>F</r>rames <r>P</r>er <r>S</r>econd" dialog

# Next:     null                <r>^N</r> - Load <r>N</r>ext Stack Config
----------------------------------------------------------------------------------------

The <r>Head</r> can contain multiple lines, this can be specified in two ways:<n>
    Head: Title ...<r>\n</r>    Line_1: ...<r>\n</r>  ...  <r>\n</r>    Line_k: ...</n>    <y># use of <r>"\n"</r></y>
or<n>
    Head: Title ... <r>^</r></n>    <y># symbol <r>'^' -"to be continued"</r><n></y>
    <r>.</r>   Line_1: ... <r>^</r>    </n><y># symbol <r>'.'</r> at the beginning of a line<r> -"if need indentation"</r></y>
     ...            <r>^</r>
    <r>.</r>   <n>Line_k: ...</n>      <y># Last line without <r>'^'</r></y>

e.g. pik3d/demo/*/*.s3d
<a name='b3d'></a>________________________________________________________________________________________

	<o>command: b3d -"Body-3d" display of the Body or Figure
</o>
Implementation is based on the<a href="#sss"> s3d command</a>.
Description of the body consists of 2 frames.  1-st:  <r>Vertices( 3d-points )</r>  and
2-nd:  <r>Faces/Facets</r>  in one stack.  Frame names don't matter.

Each vertex is described by row of <r>four values</r>:  id-number and 3d-coordinates: x, y, z .
id-number is any unique integer value,  may be < 0 !
Example of the Vertices header:  ### Verts[ 9, <r>4</r> ]    <y># 9 vertices</y>

A Face/Facet (one row in the frame) is a list of four vertex id's of a quadrilateral.
Usually the quadrilateral is irregular i.e. the sides and angles are different and
do not lie in the same plane.  If the face is a triangle, one vertex is repeated twice.

	<r>The vertices must be listed counterclockwise
	when looking at a face from outside the body !!!</r>

Face may contain additional value <r>"color"</r>, which is used to put color to the facet
in accordance with "Palette", <a href="#pal">see s3d.Colors</a>.
For example,  it could be  temperature, tension, distance to some point/axis ...
Header examples:  ### Faces[ 11, <r>4</r> ];  ### F_color[ 17, <r>5</r> ]  <y># with colors</y>

If colors are not used, the color of the whole body may be defined in the header:
### Faces[ 11, <r>4</r> ] <r>C=ff00_30</r>  !Green( RGB=00ff00 ) with opacity=30%

By default( no colors ) body is colored with <n>"DODGERBLUE"</n>=1e90ff_70, opacity=70% .
To change body color and opacity call dialog: <r>&lt;Ctrl+3></r>,  edge color - <r>&lt;Ctrl+4></r>.

<r>b3d functionality</r>  is  restricted functionality of the<a href="#sss"> s3d command</a>.
Press  <r>Right Mouse</r>  to get context menu  and see  available functions.

Configuration: <r>^C</r>  has additional parameters:

  <n>Body:   [ 1e90ff_70]</n>  - Color of Faces  - <r>^3</r>,  acts only for Faces without color;
  <n>Edge:   [      0_0 ]</n>  - Color of Edges  - <r>^4</r>   default: Edges are not visible !!!

If extended Faces( +color: ### [?,<r>5</r>]) are used, menu has <r>Palette and Opacity</r> functions.

Example( pik3d\demo\body\simple ):<n>
  ### Points[ 9, 4 ]     <y>!Vertices</y>
  ! id    x    y    z
    10  -200 -200  100
    11   200 -200  100
    12   200  300  100
    13  -200  300  100

   -24  -100 -100 -200   <y>!example with <r>id&lt;0</r></y>
   -25   100 -100 -200   <y>!on the bottom face</y>
   -26   100  100 -200
   -27  -100  100 -200

    99    50   50  200   <y>!top vertex</y>

  ### Faces[ 8, <r>5</r> ]      <r>!extended Faces</r>
    11  10 -24 -25  100
    12  11 -25 -26  200
    13  12 -26 -27  300
   -27 -24  10  13  400

    10  11  <r>99  99</r>  700  <r>!triangles</r>
    12  13  <r>99  99</r>  800

    10  11  12  13  500
   -27 -26 -25 -24  600  </n><r>!counterclockwise</r>

> b3d simple        !in the folder:  pik3d\demo\body , try to change Palette and Opacity

The following example uses <a href="#jj">jj-preprocessor</a> to generate vertices and faces of torus
Example( <n>pik3d\usr\torus.jj</n> ):<m>
{
  d = getPars( arg, 36,0 ); n=(int)min( 100, d[0]);
  vv[] b = new vv[ n ];
  int i,j; var df=2*pi/n;
  for(i=0;i&lt;n;i++) b[i] = new vv( 2+cos(i*df), 0, sin(i*df));          <y>//torus: 0-sect.</y>

  hh( n*n, 4 );
  for(j=0;j&lt;n;j++) for(i=0;i&lt;n;i++)                                    <y>//rotate section</y>
    tvv( fa(i,j), new vv( b[i].x*cos(j*df)+rn(), b[i].x*sin(j*df)+rn(), b[i].z+rn()));

  hh( n*n, 5 );
  for(j=0;j&lt;n;j++) for(i=0;i&lt;n;i++)
    tt( fa(i,j), fa(i,j+1), fa(i+1,j+1), fa(i+1,j), b[i].x );          <y>//face +"color"</y>
}
double[] d;  int n=20;  //the number of points to represent circle

double rn(){ return d[1]*(rnd()-.5);}                                  <y>// random noise</y>
int fa( int i, int j ){ if(i==n)i=0; if(j==n)j=0; return i*100 + j;}   <y>// face_id</y>
void  tvv( int n, vv p ){ tt( n, p.x, p.y, p.z );}                     <y>// print vertex</y>
record vv( double x, double y, double z ){}                            <y>// vertex</y>
</m>
Program  <n>torus.jj</n>  has 2 optional parameters:
  1. The number of circle points &lt;= 100, default: 36
  2. "Random Noise" of face coordinates, default: 0 - smooth surface

> jj torus        | b3d -         <y>!display torus with defaults: points=36, noise=0</y>
> jj torus  55    | b3d -         <y>!display torus: points=55, noise=0</y>
> jj torus  ,   .6| b3d -         <y>!display torus: points=36, noise=.6</y>
> jj torus  100 .7| b3d -         <y>!display torus: points=100( #faces=10000 ), noise=.7</y>
<a name='40'></a>________________________________________________________________________________________

	<o>stk ii [jj=1 [kk=1]] [v=&lt;value>] [D8]  > File
</o>
Create a new STACK in <a href='#dat'>###-format</a>, where:
    <r>ii</r> - number of rows;
    <r>jj</r> - number of columns;
    <r>kk</r> - number of frames;
    <r>v=&lt;value></r> - value to fill all stack elements (default 0), text: <r>"v="</r> is mandatory;
    <r>D8</r> - optional parameter if need a Stack of Double Precision, default: F4.

Examples:
> stk 22 33        > b2233     <y>!1 frame: 22 rows 33 columns  , F4, filled with 0</y>
> stk 25 46  v=-1  > b2233_1   <y>!1 frame: 25 rows 46 columns  , F4, filled -1</y>
> stk 22 33 50 d8  > d50       <y>!stack of 50 frames: [ 22,33 ], D8, filled 0</y>
> stk 42 65  v=.2  > s99_02    <y>!stack of 99 frames: [ 42,65 ], F4, filled 0.2</y>
> stk 999 v=-1 d8  > column    <y>!column[999,1] = column[999]  , D8, filled with -1</y>
<a name='fmt'></a>________________________________________________________________________________________
<o>
    fmt  Stk  [<r>I2| F4| D8</r>]    [LE]  > File  # convert Stack

    fmt  Stk  [<r>n*w.dF</r>]  [/r]  [/h]  > File  # print Stack or header
                         /r                 # print with <n>r</n>ow numbers
                               /h           # print <n>h</n>eader
</o>
Convert/print  Stack to another format: <r>I2|F4|D8</r>  or  custom text format: <r>n*w.dF</r>
A Stack can be a folder( arranging files alphabetically ).
If format and File are absent, Stack is printed to the console in standard text format.

     <o>fmt</o> <n>acts only on the specified Stack, e.g. Data:2. If the file contains
     several Stacks  and  need to process  ALL of them,  use the<a href="#tt"> tt&lt; command</a></n>.

Accepted formats:
     <r>I2 - binary</r>:  short integer    2 bytes
     <r>F4 - binary</r>:  floating point   4 bytes
     <r>D8 - binary</r>:  double precision 8 bytes

     <r>n*w.dF</r> - custom text format, where:
              <r>n</r>  - <r>number</r> of values in row
              <r>'*'</r>- mandatory symbol
              <r>w</r>  - <r>width</r> of one value
              <r>'.'</r>- mandatory symbol
              <r>d</r>  - number of <r>decimal</r> places, maybe 0
              <r>F  = f | e | g - Format</r>( 1 symbol )
                   <r>f</r> - floating point without exponent( if p=0 - integer )
                       <r>e</r> - exponent is present( scientific notation )
                           <r>g</r> - if possible - floating, if not - scientific
e.g.
     20*4.0f  - 20 integers, each has width=4
     10*11.6f - 10 floating, width=10, 6 decimals
     5*20.11g - 5 values, width=20, 11 decimals, e or f Format

     <r>/r</r> -  <n>Row number</n> will be printed before each row of the data in the form: <n>#nnn</n>

     <r>/h</r> - <n>"Header" - Comments before ###, Frame Name with size, first 7 values</n>.
           This will be done for all Frames of the specified Stack.

     <r>LE</r> - <n>"Little-Endian"="Low Bytes First"</n> - byte order for binary formats.

         <r>! Standard in JAVA  and  default in pik3d  is "Big-Endian"= BE !</r>

If text format of double precision has more then 7 significant digits,
it must be marked '<r>T8</r>' after [] -matrix size. This is done automatically by <o>fmt</o> .

Lower case may be used in the format specification:  <r>i2 | f4 | d8, le</r>.  Examples:

> fmt stk                     <y>#print   Stk to the screen in standard text format</y>
> fmt q d8           > qd8    <y>#convert Stk: q  to  qd8: D8</y>
> fmt IntVal i2 le   > qi2le  <y>#convert Stk: IntVal  to  qi2le I2 LE</y>
> fmt Dat:3 /h                <y>#print Frame Headers of the Stack: Dat:3</y>
> <r>...|</r> fmt <r>-</r> 10*11.5g  /r     <y>#print first <r>pipe</r> Stack to the console in custom format</y>

If pipe is printed to the screen, it is recommeded  to use  <r>...|tt</r>  (next command)
<a name='tt'></a>________________________________________________________________________________________
<o>
<r>  ...|</r> tt  [ <r>n*w.dF</r> ] [/r] [/h]   #print ALL Stacks or Headers from <r>pipe</r>
                       /r         #print with <n>r</n>ow numbers
  tt< <n>File</n> [ <r>n*w.dF</r> ] [/r] [/h]   #print ALL Stacks or <n>h</n>eaders from <n>File</n>

  tt< <n>File</n> [<r>i2|f4|d8</r>] [LE]  > Fc  #convert ALL Stacks from the <n>File</n>
</o>
  ...| tt                           <y># print  ALL pipe Stacks  in standard text format</y>
  ...| tt    [ <r>n*w.dF</r> ]  [/r]       <y># ---:---:---:---  <r>custom_format</r>, see help:<a href="#fmt"> > fmt</a></y>
  ...| tt                      /h   <y># print ONLY HEADERS of ALL pipe Stacks</y>

  tt&lt; File   [ <r>n*w.dF</r> ]  [/r]       <y># print            <r>ALL Stacks</r> of the File</y>
  tt&lt; File                     /h   <y># print <r>HEADERS of ALL Stacks</r> of the File</y>
                                    <y># Stacks are delimited by line: <r>### &lt;eos></r></y>
<o>tt command</o> is especially convenient when "pipe" contains several Stacks - they ALL
will be printed.  While the the <a href="#fmt">fmt command</a> shows  ONLY ONE Stack  from the pipe.

  > ...| tt  10*11.5g  /r           <y># print ALL Stacks from the pipe with <n>row numbers</n></y>
  > ...| tt  11*11.4g > F11         <y># save  ALL formatted Stacks to the file: F11</y>
  > stk 7 9| noise -| tt            <y># show random matrix [7,9] in standard format</y>
  > stk 7 9| noise -| tt 10*10.4g   <y># show random matrix [7,9] in  useful  format</y>

  > stk 8 8| noise -| eig -| tt 8*11.4g  <y># Eigen Values & Vectors of random matrix 8x8</y>

  > tt&lt;Data                         <y># print             <r>ALL Stacks</r> of the file: Data</y>
  > tt&lt;Data  10*9.4g  /r            <y># print with format <r>ALL Stacks</r> of the file: Data</y>
  > tt&lt;Data  /h                     <y># print <r>HEADERS  of ALL Stacks</r> of the file: Data</y>
  > tt&lt; Data /h                     <y># the same as previous line.</y>

<r>HEADER</r> includes <n>Comments before ###, Frame Name with size, first 7 values</n>.
It is useful to describe the data in comment before ###.  Examples:

  > gauss  @filter | tt /h          <y># header of filter</y>
  > gauss > filter & tt&lt; filter /h  <y># both lines give the same result:</y>
<n>--------------------------------------------------header:

! Gauss Blur Filter: radius=2*sigma=8.0, width=25, Normalized.

### Gauss_sigma_4 [ 25, 25 ]
 1.284e-6   2.625e-6   5.042e-6   9.103e-6   1.544e-5   2.462e-5   3.687e-5  ...</n>
<a name='ren'></a>________________________________________________________________________________________
<o>
	renam  Stk  name  [ N=1 ]  > File   # Rename Frames
</o>
Create new Stack which has old data Frames with new consecutive names:
name_&lt;N>, name_&lt;N+1>, name_&lt;N+2> ...

	<r>!!! INPUT STACK CANNOT BE A FOLDER !!!</r>

> renam  q  data    > qDAT    <y>!in qDAT frames: data_1 , data_2   ...</y>
> renam  q  neg -2  > q_50    <y>!in q_50 frames: neg_-2 , neg_-1 , neg_0 , neg_1 ...</y>
<a name='60'></a>________________________________________________________________________________________
<o>
	gauss  [ R=8 [ width=3 ]]  > File
</o>
Create the normalized Gaussian filter of the given  Radius  and  aperture( width ).
It can be considered as  example of a filter  for the command:<a href="#190"> filtr</a>,  but use of
the command:<a href="#180"> blur</a> is more convenient. This is the shortest way to create <a href="#dat">###-file</a>.

This filter performs <r>"BLUR / SMOOTHING"</r> image without displacement - "Gauss Blur".
Normalized means:  the sum of all filter values = 1.

For the Gaussian distribution, it is convenient to assume <r>Radius = 2*sigma</r>.
This is the visually perceived radius of the "Gaussian Bell" and  the characteristic
size of "SMOOTHING".

    <r>After smoothing, elements of size &lt; Radius  will be lost</r>

Filter aperture or width (2nd parameter) measured in Radii, default = 3*R = 6*sigma .
On "Center Point Demand" width rounds UP to nearest odd number: 3*8=24 --> 25 .

> gauss 3.5 2.8 > filtr    <y>!3.5*2.8 = 9.8 --> 11,   size:  11 x 11 points.</y>
<a name='bel'></a>________________________________________________________________________________________
<o>
    bell  S  "x y h r"  ["x1 y1 h1 r1"  ["x2 y2 h2 r2"]...]  > File
</o>
The command only affects the first frame of the stack and ouputs stack with one frame.
Add to specified location: <r>x, y</r> "Gaussian Bell" of given height and radius:  <r>h, r</r>
The x,y parameters can be &lt;=0, i.e. the central point is outside the frame.
If h&lt;0 - "hole", r>0 is always !

"Bells" parameters <r>specified in quotes!</r> No default values!
You can set <r>several</r> "Bells" in one command.
The radius of the "Bell" = 2*sigma ( in terms of the Gaussian function ).

> stk 17 33 | <r>bell - "9 11 9 9" "9 22 -9 9"</r> | s3d -
<a name='wav'></a>________________________________________________________________________________________
<o>
    wave  S  "x y h r a" ["x1 y1 h1 r1 a1" ["x2 y2 h2 r2 a2"]...]  > File
</o>
The command only affects the first frame of the stack and ouputs stack with one frame.
Add a straight "Wave" of Gauss to the frame:  width = 2*r = 4*sigma,  height = h.
Position of the "Wave": x,y - coordinates of the point through which the "Wave" passes.
a - the angle is measured in degrees from the vertical axis ANTI-CLOCKWISE, i.e.
if we look at the frame as a matrix, then the direction down ("at 6 o'clock")=0 degrees,
to the right ("at 3 o'clock")=90 degrees, to the right up ("at 1 o'clock")= 90+66 = 156.

The x,y parameters can be &lt;=0, i.e. the point is outside the frame,
h&lt;0 - "hole",  r>0 is always!  "Waves" parameters  <r>set in quotes!</r>  No default values!
You can specify <r>several</r> "Waves" in one command.

> stk 23 33 | <r>wave - "12 17 -9 7 60" "12 17 11 9 -45"</r> | s3d -
<a name='gel'></a>________________________________________________________________________________________
<o>
    gen3d  config  > File   !"<r>GEN</r>nerator <r>3D</r>-stack"
</o>
Often, for debugging and demonstration purposes, it is necessary to create test stacks.
This task is solved by the command:  <r>gen3d</r> - creat a stack with fixed and moving
figures. The <r>config</r> file defines stack parameters, shapes  and  their movement,
noise and smoothing.

Config file may contain:
  - empty lines and comments( line starts with # or ! );
  - section names;
  - names of figures and their parameters.

Each section, figure, parameter starts with a name that ends with <r>:</r>.

Config file Consists of 2 sections:  <r>base:</r> and <r>movi:</r>.

<r>base:</r> frame is generated once and is used in all <r>movi</r> frames as a base.
Can be empty, can contain  any number of fixed figures, noise, blur, offset

The <r>base:</r> section defines:
  - stack sizes: <r>ii jj [kk=1]</r>,  where: ii,jj,kk - number of lines/ columns/ frames.
      or
  - <r>@File</r> - reference to the existing stack.

If the base stack( <r>@File</r>) is specified, then for each frame of this stack
the <r>base:</r>  and  the <r>movi:</r>  frames  will be added.

Parameter value is a real number ( possibly &lt; 0 ).
If the parameter is not set, the default value is used.

		<o>Optional sections parameters:</o>

  <r>add: V</r>      <y>! V - offset is added to all matrix/frame elements;</y>
  <r>noise: A</r>    <y>! A - amplitude of UNIFORM noise: [-A, A ];</y>
  <r>gnoise: R</r>   <y>! Gaussian noise, R=2*sigma ;</y>
  <r>blur: R</r>     <y>! Gaussian blur(smoothing): R=2*sigma .</y>

The default value of this parameters = 0, this means: parameter is inactive.

Base frame  and  movie frame  can have different  noise and blur  parameters.
Movi parameters are applied  at the end  of the frame construction !


The section with <r>changing</r> parameters and shapes starts with the line: <r>movi:</r>
The value of  <r>any parameter</r> ( including: add, noise, blur ) can:

- <r>be a constant</r> ;
- <r>depend on time</r>( frame number k ). There are two ways to set this dependency:

  - Polynom <r>Pn(k)</r> of degree <r>n&lt;=3</r>, passes through the set of points:
    <r>param:  (k1,v1) (k2,v2) ...</r>,  where: <r>vi</r> - param.value in frame <r>ki, i=1,2...n+1</r>;

  - Parameter value for each frame from the file:  <r>param:  @File</r>
    If the number of lines &lt; kk, missing values = last available.
    Exception:  <r>dxy:</r> - there is a loop (repetition from the first values).

Examples:
  r:  7                                             <y>! Constant</y>
  y:  (1,2)          (25,76)          (50,10)       <y>! dependence on t as P2(k)</y>
! y in 1-frame =2, in 25-frame =76, in 50-frame =10

  x: (1 26) (17,6) (35 40) (50,34)                  <y>! change of x(k):    P3(k)</y>

  h: @Heights.dat                                   <y>! values in file: Heights.dat</y>
!     ### hhh[ N ]                                  <y>! header</y>
!       1  .95  .8  .6  ...                         <y>! N values</y>

In current version, 3 types/ names of figures are possible:

  - <r>bell:</r> - Bell / hill;
  - <r>poly:</r> - Closed Polygon( the last point connects to the first one);
  - <r>wave:</r> - Wave.

The figure is specified by the name and subsequent lines with parameters.
The order of the parameters is not fixed.

		<o>Standard Figure Paramaters:</o>

The position of the figures is set by the coordinates of the <r>"Figure CENTER"</r>( FC ): X, Y
  <r>x: X</r> - coordinate along the 0X-axis - "down the rows of matrix";
  <r>y: Y</r> - coordinate along the 0Y-axis - "to the right along the columns".

You can set the movement of the figure around the point (X,Y). Real coordinates:
x = X + <r>dxy[k,0]</r>
y = Y + <r>dxy[k,1]</r>  where: increments for k-frame are taken from the k-line of the File:

  <r>dxy: @File [Mx=1 [My=Mx]]</r> - <a href="#dat">###-format</a> File contains dx, dy for the frames
                              ### dxy[ N, 2 ] <y>! preferably N=kk - the number of frames</y>
                                dx1 dy1
                                dx2 dy2 ...

If the movement is cyclic, it is enough to specify only one cycle.
If parameters <r>Mx, My -"Multipliers"</r> are given, then real  dx = Mx*dx, dy = My*dy.
If <r>only Mx</r> is given, then <r>My = Mx</r> .

Example:
  dxy: @cir1 <r>7</r>  ! if file circ1 defines circle R=1, then movement will be with <r>R=7</r>

More complicated movement may be defined by time dependent  <r>X(k), Y(k)</r>  with  <r>dxy:</r>

The FC for the <r>"bell"</r> is the maximum/ minimum point - the center of symmetry.
For the <r>"poly:"</r>-closed polygon  and  the<r> "wave:"</r> - FC is the point, relative to which
polygon/ wave coordinates are set. It is convenient to set the line relative to the
point (0,0), which will have coordinates <r>x:X, y:Y</r> when displayed.
The coordinates of the FC  and  real figure coordinates  can go beyond the frame.

  <r>h: H</r> - the height of the shape.

  <r>r: R</r> - "apparent Radius/half-width" of figure, for Gaussian exponent R = 2*sigma.

  <r>form: exp</r> or <r>cos</r> - sets the shape in vertical section of the figure:
  - <r>exp</r> - H(r) = exp( -2*(r/R)^2 )     - calculated from 0 to R*2;
  - <r>cos</r> - H(r) = .5*( 1+cos( pi*r/R))  - calculated from 0 to R .
          The default: <r>form: exp</r> .
          If you set   <r>form: cos</r>  and  R = 1.25*Rexp, then the forms are pretty close.

  <r>a: A</r>  -"Angle"- rotation angle in degrees around the vertical axis through the FC
          A > 0 - counterclockwise, A &lt; 0 - clockwise.

  <r>m: M</r>  -"Multiplier", if set, then all <r>polygon/wave</r> coordinates are multiplied by <r>M</r> .
          The FC does not change. There is an increase / decrease of the figure.

  <r>k01: (k1,k2) ...</r> - "turn ON/ OFF" the figure. If parameter: k01 is not set -
                     figure is always visible.
Example:
  k01: (4,9) (12,19) (21,39)   <y>! figure is visible on the frames:  4..9, 12..19, 21..39</y>
                               <y>! on the rest frames it is absent.</y>

		<o>Nonstandard Figure Paramaters:</o>
<r>bell:</r>
  <r>ry: Ry</r> - radius in the Y direction. If specified, then the section is an ELLIPSE.
           When calculating  H(r) = H(x,y),  where: r = sqrt( (x/R)^2 + (y/Ry)^2 )
           If we specify  r != ry , we get a "flattened" Bell.

<r>poly:</r> - closed polygon, all points inside have height <r>h: H</r>
  <r>p[]: (x1,y1) (x2,y2)...</r> - array of polygon coordinates relative to FC,
                            possibly multiple text lines
        or
  <r>p[]: @File</r> - coordinates are stored in File <a href="#dat">###-format</a>:
               ### polygon[ N, <r>2</r> ]  <y>! N-point polygon</y>
                   x1 y1 x2 y2 ... xN yN

<r>wave:</r> - wave, if <r>xyh:</r> is not set - the wave line is straight along the OX axis.
        The section shape is given by: <r>h: H</r>, <r>r: R</r> and <r>form: exp/cos</r>.
        <r>a: A</r> - rotates the wave.

  <r>xyh: @File</r> - line and height coordinates in File <a href="#dat">###-format</a>:
               ### wave[ N, <r>3</r> ]    <y>! N-point line with <r>HEIGHTS !!!</r></y>
                   x1 y1 <r>h1</r> x2 y2 <r>h2</r> ... xN yN <r>hN</r>
               Wave section height = H * <r>hi</r> (possibly: <r>hi&lt;0</r> ).

The stack is generated in the format: <a href="#dat">F4 BE</a> .
Date and config.file  are placed  at the beginning of the stack as a comment.

Config.file  example:  <r>spiral2.cfg</r>  "Two rotating spirals":
<n>
base: 160 160,20       <y># it is enough 10 frames</y>
movi:
blur: 5

  wave:
    x: 79.5
    y: 79.5
    xyh: @<r>spiral</r>
    a: (1 0)(2 18)     <y># turning speed 18 degrees/ frame</y>
    r: 5
    h: 2
    form: cos

  wave:
    x: 79.5
    y: 79.5
    xyh: @<r>spiral</r>
    a: (1 180)(2 198)  <y># the second spiral is rotated 180 degrees</y>
    r: 5
    h: 2
    form: cos
</n>
File:  <r>spiral</r>  is received by the program:  pik3d\usr\Spiral.java
it can be run(<a href='#jj'> jj File.java</a>)> jj Spiral.java > <r>spiral</r>
<n>
public class Spiral {
  static public void main( String[] a ) {
    int i, n=20, nn=n*3;
    double f=0, df=-2*Math.PI/n, r=10, dr=2, h=1, dh=-.015;

    System.out.println("### xyh [ "+nn+", 3 ]");
    for(i=0; i&lt;nn; i++) {
      System.out.println( r*Math.cos( f )+" \t"+r*Math.sin( f )+" \t"+h );
      r+=dr; f+=df; h+=dh;
    }
  }
}</n>
To see result >  <r>gen3d spiral2.cfg | s3d -</r>  <y>!do not forget to press &lt;space> to run movi</y>
<a name='140'></a>________________________________________________________________________________________
<o>
	noise  Stk  [A=.1]  > File
</o>
Adds to Stack elements "Uniform Noise", it has a uniform distribution
function on the interval: [ -A, A ],  default A = 0.1
  e.g.
> stk 1000000 | noise - | hist -            <y>!get UNIFORM on [-.1,.1 ] NOISE histogram</y>
<a name='145'></a>________________________________________________________________________________________
<o>
	gnoise  Stk  [R=.1]  > File
</o>
Adds to Stack elements "Gaussian Noise":  mean=0,  R=2*sigma .
  e.g.
> stk 1000000| gnoise - 2| hist -           <y>!get G.noise histogram( R=2, sigma=1 )</y>
<a name='djk'></a>________________________________________________________________________________________

	<o>STACK PART:  Stk[ di, dj, dk ]  - "Slice",  index subsets
</o>
	<r>ATTENTION:  pik3d Slice  is different from  PYTHON Slice !!!</r>

Stack part description = description of subsets of indexes: di, dj, dk

Subset descriptions are separated by commas.
If the description contains a comma, it must be enclosed in parentheses.
If subset is <r>omitted</r> (examples: Stk[,dj,dk], Stk[di,,dk], Stk[,,dk] ) - <r>index = 1</r>.
Parentheses and spaces can be used to improve readability.

	<o>Rules for describing a subset of indices:</o>

onsider the rules on the example of columns(1,2,3...N), where: N-the last column.
Positive number p is used in description, i.e.  p=1,2,3...N   and  -p=-1,-2,-3 ...

1. Index counting <r>starts from 1</r> !!!  i.e. real indices are 1,2,3 ... N.

2. Index <r>0</r> denotes <r>Last index</r> ( in our case N ).

3. Index <r>-p</r> denotes <r>N-p</r> index.

4. Index subset can contain lists and cycles in any quantity (separated by commas).
   - <r>list</r> = sequence of indices: <r>(j1,j2 ...)</r>,  possibly one.
   - <r>cycle</r>  contains symbol <r>':'</r> or <r>'#'='q'</r> - in <r>q</r>uantity.

5. Cycle (general case):  <r>b: e: s</r>
   <r>b, e</r> - the beginning and the end of the cycle  <r>INCLUSIVE !!!</r>
   <r>s</r>    -"Step" - sequence and order of sampling.

   b &lt; e and s= p -->  for( j=b; j&lt;=e; j+=p )     <y>!from smallest to largest: <r>s>0</r></y>
   b > e and s= p -->  for( j=e; j&lt;=b; j+=p )     <y>! ---:---:---:---:---:---:---</y>
   b &lt; e and s=-p -->  for( j=e; j>=b; j-=p )     <y>!from largest to smallest: <r>s&lt;0</r></y>
   b > e and s=-p -->  for( j=b; j>=e; j-=p )     <y>! ---:---:---:---:---:---:---</y>

6. Cycle:  omitted/ default  values :

   b - value <r>to the left  of the first  ':'</r>  default = <r>1</r>
   e - value <r>to the right of the first  ':'</r>  ---:--- = <r>0 --> N !!!</r>
   s - value <r>to the right of the second ':'</r>  ---:--- = <r>1</r>, examples:

   :e - all columns from 1 to e inclusive;
   :e:s - from 1 to e , sequence and order are determined by step: s

   : =:: =1:N:1  --> for( j=1; j&lt;=N; j++ ) - ALL
   ::-1 = 1:N:-1 --> for( j=N; j>=1; j-- ) - ALL in reverse order

7. To describe the quantity of rows| columns| frames, the symbol <r>#</r> is used, which can be
   replaced with the symbol <r>q -"quantity"</r>.

   <r>b#p</r> = b:b+p-1, i.e. <r>p = quantity of elements from b to b+p-1 inclusive, p>0 !!!
<n>
       !!! The symbol <r>#</r> must always follow the starting index <r>without space</r>,
           otherwise it is treated as a comment sign !!!</n>
   </r>
8. <r>b =-p</r> - means: b = N-p,  e.g. -2: =( N-2, N-1, N ),  <r>b=0</r>  e.g. <r>0: = 0# = 0  = N</r>
   <r>e =-p</r> - means: e = N-p,  e.g. :-2 =( 1,2 ... N-2 ),  <r>e=0</r>  e.g. <r>:0 = :</r> =(1,2...N)

Examples:
  Stk[ :, :, <r>0</r> ]                         <y>!<r>Last</r> frame of the stack</y>
  Stk[ :, :, ::-1 ]                      <y>!stack  with reverse frame order</y>
                                         <y>!possible use: > get Stk[:,:,::-1] | s3d -</y>
  Stk[ ::-1, :, : ]                      <y>!frames with reverse order of rows</y>
  Stk[ :, <r>(2,3,(4:7:-1),9)</r>, : ]          <y>!ALL rows and frames, columns: <r>2,3,7,6,5,4,9</r></y>
  Stk[ :, :, -3:  ]                      <y>!frames: K-3, K-2, K-1, K  !K=number of frames</y>
  Stk[ :, :, 0:-3:-1 ]                   <y>!frames: K, K-1, K-2, K-3  =  [:,:,-3::-1]</y>
  Stk[ 2#3,4#3,:3] = Stk[2:4,4:6,1#3]    <y>!cube: 3x3x3 = Stk[ 2<r>q</r>3,4<r>q</r>3,<r>q</r>3 ]</y>
<a name='get'></a>________________________________________________________________________________________

	<o>get  Stk[ di,dj,dk ]  > File
</o>
Get the Stk part according to <a href="#djk">index subsets</a>.
Examples:
> get Stk[:,<r>2#3</r>, 7]      <y>! matrix consisting of 3 columns( <r>2,3,4</r> ) of the 7-frame</y>
> get Stk[:,:,::-1]      <y>! frames in reverse order</y>
> get Stk[:,:,:: 3]      <y>! every 3rd frame</y>

obtaining sections:
> get Stk[2#9, 7, 1#5]   <y>! 9x5 section on 7-column</y>
> get Stk  [3, :, :  ]   <y>! full section on 3-line = sec Stk i=3 (see below: <a href="#sec">sec</a>)</y>

In case of sections: Stk[ i, dj,dk], Stk[di, j, dk] - <a href="#dim">dim32</a> command is useful to convert
several frames( dk ) to 2d-matrix( [dj,dk], [di,dk] ).
<a name='put'></a>________________________________________________________________________________________

<o>    put  Stk[ di,dj,dk ]  Part  [<r>s</r>=0 [<r>p</r>=1]]  > File  !put Part of Stack
</o>
This is a group of commands to change part: Stk[di,dj,dk] and output the whole changed
Stack.  Action  depends  on  the  <r>s, p    #       S[] = s*S[] + p*P</r>
  default:  s=0, p=1  > put S[] P         <y># put:  S[] =           P</y>
            s=1, p=1  > put S[] P 1       <y># add:  S[] =   S[] +   P</y>
            s=1, p=-1 > put S[] P 1 -1    <y># sub:  S[] =   S[] -1* P</y>
                                           ...
Command:  <r>put S[] P</r>  is reverse to command:  <r>get  S[] > P</r>, check this:

> stk 6 9 3 | noise - 1000 <r>@A</r>| tt 9*5.0f  <y># creat stack A[6,9,3] with random numbers</y>
> get  A[::2, 2#7, 2:]     <r>@P</r>| tt 9*5.0f  <y># get  part A[::2, 2#7, 2:] --> P[3,7,2]</y>
> stk  3 7 2| put A[::2,2#7,2:] - > A0    <y># fill part A[::2, 2#7, 2:] with 0 from pipe</y>
> fmt  A0  9*5.0f                         <y># view A0</y>
> put  A0[::2, 2#7, 2:]   P  | dif - A    <y># put saved "Part" P to A0  --> dif: 0,0,0</y>
<a name='dim'></a>________________________________________________________________________________________

	<o>dim32  Stk  > File   !"<r>DIM</r>ension: <r>3d -> 2d</r>"
</o>
If one of the 3d-Stack sizes = <r>1</r>, the stack is converted to a 2d-matrix.
This situation occurs when getting a section of the stack with the command <a href="#get">get </a>:

  section along <r>i-row   </r>:   > get Stk [ <r>i</r>, dj, dk ]
  section along <r>j-column</r>:   > get Stk [ di, <r>j</r>, dk ],  e.g.

> stk 8 9 7 | noise - > A   # prepare stack: A
> get A[ <r>3</r>,  :, : ] | tt    <y># section consists of <r>7</r> frames[ <r>1</r>, 9 ]</y>
> get A[ :,  <r>5</r>, : ] | tt    <y># section consists of <r>7</r> frames[ 8, <r>1</r> ]</y>
> get A[ :5, <r>3</r>, :4] | tt    <y># section consists of <r>4</r> frames[ 5, <r>1</r> ]</y>

The same using <r>dim32</r>:
> get A[ 3,  :, : ] | dim32 - | tt    <y># <r>one</r> frame [ 9, 7 ]</y>
> get A[ :,  5, : ] | dim32 - | tt    <y># <r>one</r> frame [ 8, 7 ]</y>
> get A[ :5, 3, :4] | dim32 - | tt    <y># <r>one</r> frame [ 5, 4 ]</y>
<a name='csv'></a>________________________________________________________________________________________

      <o>csv  CSV-file  [di,dj]  [D8]  > ###-file
</o>
Read  <r>"Comma-Separated Values"-file</r>  and  convert to the  <a href="#dat">binary ###-file</a>

  [di,dj] - <a href="#djk">index subsets</a>  of Lines and Columns
            if absent, it means the entire CVS-file

  D8      - output file as Double(D8), default: Float(F4)

  <r>ATTENTION:  ONLY INCREASING  index sequences  are  ALLOWED
              Literal and Error Values are replaced with <n>4e-44</n> !!!</r>
Examples:
  csv  float.csv        >  flodat        <y>!float.csv --> flodat  (entire file)</y>
  csv  data.csv  D8     >  dat8          <y>!data.csv  --> dat8( Double,8-bytes real)</y>
  csv  big.csv [3:,:]   >  big4          <y>!big.csv from 3-line to the end, all col.</y>
  csv  big.csv [500#200, (2,3,5,7)] d8 > d501     <y>!lin.: 500-699, col.: 2,3,5,7</y>

  csv  graph.csv [:,:4] | vic - 1 2 3 4  <y>!read and display col.: 2,3,4 as function of 1</y>

Input file can be taken <r>from the WEB</r>:
  csv https://perso.telecom-paristech.fr/eagan/class/igr204/data/cereal.csv [3:,4:] |tt

It is also possible to read a <r>compressed(.zip ) CSV-file</r> (locally, not WEB):
  csv cereal.zip [3:,4:] | tt
<a name='120'></a>________________________________________________________________________________________

    <o>sv  Stk  [+-x/p|exp|ln|db]  Value  > File   !"<r>S</r>tack-<r>V</r>alue" operations
</o>
One of the operations[] is applied to <r>each stack element</r> and <r>value</r>.

  Arithmetic operations:
    +, -, <r>x-multiply(Latin:x)</r>, /-divide, <r>p-raise to a Power</r>

    sv  Stk  + 200  >  F       <y>! add 200 to all elements</y>
    sv  Stk  - 100  >  F       <y>! subtract from all elements value 100</y>
    sv  Stk  x -1   >  F       <y>! x - multiply by -1 == change the sign of all elements</y>
    sv  Stk  / 4    >  F       <y>! divide all elements by 4</y>
    sv  Stk  p 2    >  F       <y>! raise to a power 2   = square all elements</y>
    sv  Stk  p .5   >  F       <y>! raise to a power 1/2 = square root of all elements</y>

  Functions &lt;Stack element> / value:
    exp = exp  ( stk/ value )  <y>! "e" to the power ratio: &lt;Stack element>/value</y>
    ln  = ln   ( stk/ value )  <y>! natural logarithm( base "e" )</y>
    db  = 10*lg( stk/ value )  <y>!- decibel, lg - decimal logarithm( base=10 )</y>

*you can omit the space before value:
    sv Stk +1; sv Stk /2; sv Stk -3;
    sv Stk - -3  ==  sv Stk --3  ==  sv Stk + 3  ==  sv Stk +3 !!!

*function name can be abbreviated to ONE letter( e, l, d ):
    sv Stk e -2 == sv Stk exp -2   <y>! exp( -stk/2 )</y>
<a name='row'></a>________________________________________________________________________________________

    <o>sr  S [+-x/p]  Row  > File  !"<r>S</r>tack-<r>R</r>ow", Row is one row Stack
</o>
The operation is applied to the elements of the Stack and Row in the same column:

  sr  S + R  > F    <y>! ADDITION:          Fij = Sij + Rj</y>
  sr  S - R  > F    <y>! SUBTRACT:          Fij = Sij - Rj</y>
  sr  S x R  > F    <y>! MULTIPLY(<r>Latin x</r>): Fij = Sij x Rj</y>
  sr  S / R  > F    <y>! DIVISION:          Fij = Sij / Rj</y>
  sr  S p R  > F    <y>! RAISE TO A POWER:  Fij = Sij p Rj</y>

<r>*</r> (NUMBER of COLUMNS <r>S</r>) = (NUMBER of ELEMENTS <r>Row</r>), e.g. S[99,<r>7</r>] <--> Row[<r>7</r>] or Row[1,<r>7</r>]
<a name='130'></a>________________________________________________________________________________________

    <o>ss  S  [+-x/p]  T  > File   !"<r>S</r>tack-<r>S</r>tack" operations
</o>
The operation is applied to the correspondent elements of stacks;
Element-by-element stack operations:

  ss  S + T  > F    <y>! element-wise ADDITION:          Fij = Sij + Tij</y>
  ss  S - T  > F    <y>! --:--:--:--  SUBTRACT:          Fij = Sij - Tij</y>
  ss  S x T  > F    <y>! --:--:--:--  MULTIPLY(<r>Latin x</r>): Fij = Sij x Tij</y>
  ss  S / T  > F    <y>! --:--:--:--  DIVISION:          Fij = Sij / Tij</y>
  ss  S p T  > F    <y>! --:--:--:--  RAISE TO A POWER:  Fij = Sij p Tij</y>

* STACKS MUST HAVE FRAMES OF THE SAME SIZE !
* Number of frames of the result = number of frames of the <r>shorter</r> stack.
<a name='sks'></a>________________________________________________________________________________________

    <o>sks  A  k  B  > File    !<r>S</r>tack-<r>S</r>tack" operation: "A + k*B"
</o>
Element-wise addition with multiplication by k:  Fij = Aij + k*Bij .

* STACKS MUST HAVE FRAMES OF THE SAME SIZE !
* Number of frames of the result = number of frames of the shorter stack
<a name='tra'></a>________________________________________________________________________________________

    <o>tra    Stk  > File
</o>
<r>TRA</r>nsposing ALL FRAMES OF THE STACK. The frame columns become the rows in the new Stack.
It can be considered as frame  <r>turn over the diagonal</r>:  upper left - lower right.

    <o>rot90  Stk  > File
</o>
Rotation STACK FRAME 90 degrees can be considered as a <r>rotation about the center</r> of the
frame at 90 degrees COUNTERCLOCK-WISE.
Example for frame[ m, n ] - m-rows, n-columns:  *-------> n                  _________
                                                |  _____________            |D       C|
    frame[ m, n ]   result[ n, m ]              | |A           D|         n |         |
                                                | |             | rot90   ^ |         |
      A: ( 1, 1 )   --->  ( n, 1 )              V |      *      | ----->  | |    *    |
      B: ( m, 1 )   --->  ( n, m )              m |             |         | |         |
      C: ( m, n )   --->  ( 1, m )                |B___________C|         | |         |
      D: ( 1, n )   --->  ( 1, 1 )                                        | |A_______B|
                                                                          *-----> m
<a name='dia'></a>________________________________________________________________________________________

    <o>diag  A  [Vector]  > D   ! get/set <r>DIAG</r>onal values of Matrix
</o>
If Vector is absent , vector D will contain diagonal of the matrix A.

If Vector is present, it will be set as diagonal in to the A matrix and output.
The number of inserted values = min( A_Diagonal.Length, Vector.Length )
  e.g.
> diag  A      > d      <y># get:  d is vector and contains Diagonal of A</y>
> diag  A  dd  > Anew   <y># set:  Anew == A with new diagonal = dd</y>
<a name='mul'></a>________________________________________________________________________________________

    <o>mul  A B [ C D ...]  > File   ! Matrix <r>Mul</r>tiplication
</o>
    <r>!!!  Only 1st frames of the Stacks are used  !!!</r>

The number of columns A must be equal to the number of rows B,
the number of columns B must be equal to the number of rows C ...
Result dimensions: <Number of Rows A> x <Columns Number of the Last Matrix>

It is possible to use Part of Matrix according to <a href="#djk">index subsets</a>, e.g.
> mul  A[#5,2:9]  B[3:#8,4#6]  C[2:7,:3]       <y>! result 5x3.</y>

In addition, transposition of Matrix or Part may be done directly in the command.
To do this, the <r>#</r> sign must be put after the Matrix or Part,
  e.g.
> stk  33 33 | noise - 10       > A            <y>! prepare matrix A with random values</y>
> mul  <r>A#</r>  A                    > AtA          <y>! <r>At</r> * A - used in decomposition</y>
> mul  A[#5,2:9]  <r>A[4q6,3:q8]#</r>  A[2:7,q3] |tt  <y>! transpose part, print result 5x3</y>
<a name='ata'></a>________________________________________________________________________________________

    <o> ata  A   ! (<r>A T</r>ransposed) * <r>A</a>
</o>
    <r>!!!  Only 1st frames of the Stacks are used  !!!</r>

As a result, we obtain a square symmetric matrix with the namber or rows equal to the
number of columns of the original matrix. Symmetric matrix always has real eigen values.
  e.g.
> stk  999 30 d8 | noise - 10 > A              <y>! prepare matrix A with random values</y>
> ata A > Ata   &  mul  <r>A#</r>  A | dif - Ata      <y>! the same result( <r>A# = A transposed</r> )</y>
<a name='inv'></a>________________________________________________________________________________________

    <o>inv  A  >  File        ! <r>Inv</r>ert Matrix
</o>
Matrix A must be square( number of rows = number of columns ).
The result, when multiplied by A, gives the Identity Matrix.

> stk 400 400 | noise - > A     <y>! create and fill by random values</y>
> inv A | mul - A | dif - 1     <y>! invert, multiply by original, difference from I</y>
 <n>### MAX         Average        Root_Mean_Square [3]
  3.752553e-14   2.902646e-15   4.163867e-15</n>
<a name='sys'></a>________________________________________________________________________________________

    <o>sys  A  b  > File    ! Solve a System of Linear Equations: [A]*x = b
</o>
Matrix A must be square( number of rows = number of columns ).
The result( x ), when multiplied from the left by A, gives the b vector.

> stk 400 400 | noise - > A         <y>! create A and fill by random values</y>
> stk 400     | noise - 5     > b   <y>! create and fill vector b[400]</y>
> sys A b     | mul A - | dif - b   <y>! solve, [A]*x, difference from b</y>
 <n>### MAX         Average        Root_Mean_Square [3]
  4.423128e-13   1.251711e-13   1.549051e-13</n>
<a name='eig'></a>________________________________________________________________________________________

    <o>eig  A  > V   !"<r>Eig</r>en Values and Vectors  of  Square Matrix"
</o>
  Based on "The Apache Commons Mathematics Library"
  <a href='https://commons.apache.org/proper/commons-math'>https://archive.apache.org/dist/commons/math/binaries/commons-math3-3.6.1-bin.zip</a>

If you plan to use <o>eig</o> or <o>svd</o> commands, you need to download the library  and  place
jar-files in the  <r>pik3d/lib</r>  folder.  Without sources and java-docs  only file:
<m>commons-math3-3.6.1.jar  (~2.2 MB)</m>  is enough.

Result: 2 stacks separated by "<r>### &lt;eos></r>":
 - Diagonal Matrix of Eigen Values - V:1 or V ;
 - Matrix of normalized( length=1 ) Eigen Vectors - V:2 .

Matrix A must be square( number of rows = number of columns ).
if A is symmetric, then  Eigen Vectors are Orthogonal, i.e.
V * V# = I,  where: V# - transp.V --> V# - inverse of V .

> stk 77 9| noise - | mul -# - > A  <y>! M# * M = A - symmetric 9x9</y>
> eig A  > V                        <y>! V - Eig.Values & Vectors</y>
> fmt V    10*11.5g                 <y>! view Eigen Values</y>
> fmt V:2  10*11.5g                 <y>! view Eigen Vectors(columns)</y>

> mul V:2  V:2# | dif - 1           <y>! V:2 * V:2# = I</y>
 <n>### MAX         Average        Root_Mean_Square [3]
  5.828671e-16   2.111598e-16   2.491707e-16</n>

> mul V:2  V  V:2# | dif - A        <y>! V:2 * V * V:2#  =  A</y>
 <n>### MAX         Average        Root_Mean_Square [ 3 ]
  1.94289e-16    6.120254e-17   7.585892e-17</n>

> diag V | vic -   <y>! plot Eigen Values as function of number</y>.
<a name='svd'></a>________________________________________________________________________________________

    <o>svd  A  > D   !"<r>S</r>ingular <r>V</r>alues <r>D</r>ecomposition  of  Matrix"
</o>
  Based on "The Apache Commons Mathematics Library"
  <a href='https://commons.apache.org/proper/commons-math'>https://archive.apache.org/dist/commons/math/binaries/commons-math3-3.6.1-bin.zip</a>

Result: 3 stacks separated by "<f>### &lt;eos></f>":
 - Diagonal Matrix of Singular Values  - D   , below S ;
 - Matrix of  <r>"Left"</r>  Singular Vectors - D:2 , --:-- L ;
 - Matrix of  <r>"Right"</r> Singular Vectors - D:3 , --:-- R ;
	 ___n___                    ___n___
	|       |                  |       |    ___n___     ___n___
	|       |                  |       |   |       |   |       |
	m       |                  m       |   n       |   n       |
	|   <r>A</r>   |  = <r>L * S * Rt</r> =  |   <r>L</r>   | * |   <r>S</r>   | * |   <r>Rt</r>  |
	|       |                  |       |   |_______|   |_______| ,  where:
	|_______|                  |_______|

  <r>A</r> [m,n] - matrix to be decomposed
  <r>L</r> [m,n] - Orthogonal matrix of <r>"Left"</r> Singular Vectors of <r>A</r>
  <r>S</r> [n,n] - Diagonal matrix of Singular Values of <r>A</r>, sorted in descend order
  <r>Rt</r>[n,n] - TRANSPOSED Orthogonal matrix of <r>"Right"</r> Singular Vectors of <r>A</r>

Useful info: <r>Rj</r>-column is Eigen Vector with Eig.Value <r>Ej</r> of <r>At*A</r>, <r>Sj</r>=sqrt(<r>Ej</r>)
             <r>Lj = A*Rj/Sj</r> ,  where:  <r>Lj</r>-Left,  <r>Rj</r>-Right,  <r>Sj</r>-Singular Value
             SVD works even if m &lt; n !

We can neglect small and zeros Singular Values/Vectors and use r &lt; n :
	 ___n___                     __r__
	|       |                   |     |      __r__      ___n___
	|       |                   |     |     |     |    |       |
	m       |                   m     |     r  <r>S'</r> |    r  <r>R't</r>  |
	|   <r>A</r>   | ~ <r>L' * S' * R't</r> = |  <r>L'</r> |  *  |_____|  * |_______| ,  where:
	|       |                   |     |
	|_______|                   |_____|

  <r>L'</r> [m,r] - reduced Orthogonal matrix of <r>"Left"</r> Singular Vectors <r>A</r>
  <r>S'</r> [r,r] - reduced Diagonal matrix of Singular Values of <r>A</r>
  <r>R't</r>[r,n] - reduced Transposed Orthogonal matrix of <r>"Right"</r> Singular Vectors

> stk 99 7 | noise -  >  A      <y>! A-random matrix 99x7</y>
> svd A <r>@D</r> | tt 10*11.4g        <y>! <r>Save</r> and print Singular Values and Vectors</y>
> mul D:2 D D:3# | dif A -      <y>! Difference A from L*S*Rt</y>
 <n>### MAX         Average        Root_Mean_Square [ 3 ]
  1.665334e-16   4.135816e-17   5.1797643e-17</n>

> mul D:2# D:2 | dif - 1        <y>! L# * L = I</y>
 <n>### MAX         Average        Root_Mean_Square [ 3 ]
  1.776356e-15   2.970216e-16   4.27931803e-16</n>

> mul D:3# D:3 | dif - 1        <y>! R# * R = I</y>
 <n>### MAX         Average        Root_Mean_Square [ 3 ]
  5.551115e-16   1.525140e-16   1.937281e-16</n>

> mul A# A > AtA  &  <r>mul D:3  D D  D:3#</r> | dif - AtA    ! <r>R * S*S * Rt</r> = AtA
 <n>### MAX         Average        Root_Mean_Square [ 3 ]
  5.551115e-16   1.159963e-16   1.481203e-16</n>

> diag D | vic -   <y>! plot Singular Values as function of number.</y>
<a name='dif'></a>________________________________________________________________________________________

    <o>dif  A 0 |  A 1 |  A B    !"<r>dif</r>ference" of the Stacks
</o>
Two stacks are compared: maximum, average and root_mean_square deviations are searched.
There are three options for comparison:

   - <r>dif A</r> or <r>dif A 0</r>   - compare with zero matrix/ stack ;
   - <r>dif A 1</r>            - compare with the Identity matrix( all 0, diagonal 1 );
   - <r>dif A B</r>            - difference between A and B .

> stk 99 99| noise - > A        <y>! create A[99,99] and fill by random values</y>
> inv A| mul A - | dif - 1      <y>! A * invA = I, difference from Identity</y>
 <n>### MAX         Average        Root_Mean_Square [3]
  1.998401e-14   1.944781e-15   2.900034e-15</n>
<a name='180'></a>________________________________________________________________________________________

	<o>blur  Stk  [R=2]   > File
</o>
Apply <r>"Gaussian Blur"</r> smooth filter of given Radius R=2*sigma to all frames.
Radius - characteristic size of the blur (smaller elements will be lost after blurring).
Radius is the characteristic size of the blur ( smaller elements will be lost ).
By default R=2, but can be for example: 1.2, 1.75, 3.5 ...
Filter width (aperture) = 3*R = 6*sigma, i.e. at R=2 summation for each point
will be done on a 7x7 square( 3*R=3*2, +1 - "Center Point Requirement").
<a name='190'></a>________________________________________________________________________________________

	<o>filtr  Stk  Fltr   > File
</o>
Apply <r>Digital Filter</r> to all Stk frames. Fltr - <a href="#dat">###-matrix</a> with filter coefficients.
For example, the filter can be obtained like this: > <a href="#60">gauss</a> 3.5 2.8 > Fltr  <y>#size: 11x11</y>
The filter may be NOT normalized( the sum of the coefficients != 1 ).
Filter normalization is done automatically by the command.
<a name='160'></a>________________________________________________________________________________________

	<o>top  Stk  level   > File   !2 required parameters!
</o>
<r>"Cut TOP"</r> - replace with level  all <r>values > level</r>.
<a name='170'></a>________________________________________________________________________________________

	<o>bot  Stk  [level=0]  > File
</o>
<r>"Cut Bottom"</r>  - replace with level  all <r>values &lt; level</r>.
<a name='210'></a>________________________________________________________________________________________
<f>Simple time smoothing (through the frames):</f>

	<o>ma  Stk  [ N=5 ]   > File   !"<r>M</r>oving <r>A</r>verage"- over N frames</o>

<r>WARNING!</r> Usually, a moving average means the SUM of N-1 previous values and the current
value  divided by N. This leads to  lag = N/2  of filtered values.
In <o>ma, sma :</o> commands

  <r>&lt;MOVING AVERAGE> = ( &lt;sum of PREV N/2> + current + &lt;sum of NEXT N/2> ) / N</r>
  If N=2*k is given - commands use the value 2*k+1 !!!
  At the beginning and the end of the stack, the division is made by the real number
  of summed values.

The MOVING AVERAGE is calculated for each frame point.
<a name='220'></a>________________________________________________________________________________________
<f>Removing Slowly Changing Variations - "Detrending":</f>

	<o>sma  Stk  [ N=5 [ level=0 ]]  > File
</o>
"<r>S</r>ubtract the <r>M</r>oving <r>A</r>verage" - over N frames.
level specifies the "cutoff" in output stack ( values below are replaced by level ).
<a name='his'></a>________________________________________________________________________________________
<o>
  hist Stk [Fr=1 [Nint=100]] [/add=File]   ! Histogram of the frame data
</o>
where:  <r>Nint</r> - the Number of Intervals in the range [min,max], default: 100.
	Don't make it too big - the spread of the histogram values increases.
	Valid range for Nint is from 4 to 2000 .

if key <r>/add=File</r> is present, <a href='#addgra'>Additional Graphics</a> from File[.add] is added
to the chart( see <a href='#gra'>Use of 2d-graphics</a> ).

In the opened Histogram window, you can change the Number of Intervals:
in the upper right corner <r>enter a new value and press &lt;Enter></r>.

<r>&lt;F3>    </r> - Save the Histogram to a file.
<r>&lt;Ctrl+G></r> - ON/ OFF an estimate of the Normal/ Gaussian distribution:

  1. Find min, max values in the frame.
  2. The width of the interval = ( max-min )/Nint .
  3. All frame values are sorted by intervals.
     The number of values that fell into the interval = the value of the Histogram.
  4. "Coordinate descent" is used to find an estimate of the Gaussian distribution.
  5. Display: estimation, Number of intervals, mean, +/-sigma, 3*sigma .

Narrow distribution peaks can be conveniently examined using<a href="#gra"> ZOOM </a>.

Example: get histogram of the GAUSSIAN NOISE [R=2*sigma=2, sigma=1]
> stk 1000000 | gnoise - 2 | hist -    <y>! do not forget to press <r>^G</r></y>
<a name='mea'></a>________________________________________________________________________________________

    <o>meanc  A  > M   ! <r>Mean C</r>olumn Values (only 1st Frame)</o>

Calculation steps ( i-row, j-column, <n>sum()</n> -summation by i=1...N ):
  1. Mean values for j-column:  <n>Mj = sum( Aij )/ N</n> ;
  2. Standard Deviation for j-column:  <n>SDj = sqrt( sum( ( Aij-Mj )^2 )/ N )</n> ;

The result file contains two stacks:
    M:1  <y>! Vector of Column Mean Values( <n>Mj</n> )</y>
    M:2  <y>! Vector of Column Standard Deviations( <n>SDj</n> )</y>
e.g.
> stk 99 5| noise - 3| meanc - | tt
<a name='sme'></a>________________________________________________________________________________________

    <o>submeanc  A  > A_m   ! <r>Sub</r>tract <r>Mean C</r>olumn Values (only 1st Frame)</o>

For all columns:
  1. Mean Column Values:  <n>Mj = sum( Aij )/ N</n> ;
  2. Deviations from Mean Column Value:  <n>Dij = Aij - Mj</n> ;

The result file contains two stacks:
  A_m:1    <y>! Deviations from Mean Column Values( <n>Dij</n> ) - matrix the same size as A</y>
  A_m:2    <y>! Mean Column Values( <n>Mj</n> ) - vector</y>
e.g.
> stk 999 9 d8| noise - 10 @A| submeanc -| sr - + -:2| dif - A   <y>!deviations + means = A</y><n>
 ### MAX        Average       Root_Mean_Square [3]
  8.881784e-16  2.422135e-17  1.244592e-16</n>
<a name='cor'></a>________________________________________________________________________________________

    <o>corr  A  > C   ! <r>Corr</r>erelation Matrix (only 1st Frame)</o>

Calculation steps ( i-row, j-column, <n>sum()</n> -summation by i=1...N ):
  1. Mean values for j-column:  <n>Mj = sum( Aij )/ N</n> ;
  2. Deviation for all elements of j-column:  <n>Dij = Aij - Mj</n> ;
  3. Standard Deviation for j-column:  <n>SDj = sqrt( sum( Dij^2 )/ N )</n> ;
  4. Correlation coefficient:  <n>Cmn = sum( Dim * Din )/ ( SDm * SDn * N )</n> .

The correlation matrix is always symmetrical, there are  1, 1, 1 ...  on the diagonal
To view corr.matrix <a href="#sss">command: s3d </a>can be used > <n>corr A| s3d -    </n><y>!set "Bar-view"=&lt;F4></y>

The result file contains three stacks:
    C:1  <y>! Correlation Matrix( <n>Cmn</n> ) - symmetric matrix</y>
    C:2  <y>! Column Mean Values( <n>Mj</n> ) - vector</y>
    C:3  <y>! Column Standard Deviations( <n>SDj</n> ) - vector</y>
e.g.
> stk 99 8| noise - 2 <r>@A</r>| corr - <r>@C</r>| s3d -  &  tt&lt; <r>C</r> 8*10.3g    <y>!press &lt;F4> in 3d-view</y>
<a name='reg'></a>________________________________________________________________________________________

    <o>Linear Regression</o>

In many cases, the problem of finding Linear Regression is formulated as follows:

  - there is V - Scalar value dependent on vector X ;
  - X = ( x, y, z ... ) - vector of independent variables ;
  - the set of measurements: <r>[V]</r> ={ V1,V2...Vm } and correspondent <r>[X]</r> ={ X1,X2...Xm }.

Need to find the analytical expression: <r>V = F(X) -"Regression"</r> as a <r>linear</r> combination
of  a  given  set of functions  <r>{f} = { f1, f2 ... fn }</r>  defined by  the subject area.
For example we can use  {f} = { 1, x, y, x*x, y*y, x*y ... pow( x+y, 3/2.) ... }

    <r>Linear Regression</r> assumes form:  <r>F(X) = k1*f1(X) + k2*f2(X) ... + kn*fn(X)</r>

To find regression means to find the set  <r>{k} = { k1, k2 ... kn }</r>  on the given  <r>{f}</r>.
It often sought in the sense of <r>"Least Squares"</r> - minimum sum  of squared deviations
of calculated F( Xi )  and  measured  Vi .

In terms of matrices we have:
	 ____             ____     ____________
	|    |           |    |   |            |                    ____
	| V1 |           | X1 |   | x1, y1 ... |                   |    |
	| V2 |           | X2 |   | x2, y2 ... |                   | k1 |
	| V3 |           | X3 |   | x3, y3 ... |                   | k2 |
  <r>[V]</r> = |  . | ,   <r>[X]</r> = |  . | = |  .         |   to find:  <r>[K]</r> = |  . |
	|  . |           |  . |   |  .         |                   |  . |
	|  . |           |  . |   |  .         |                   |  . |
	| Vm |           | Xm |   | xm, ym ... |                   | kn |
	|____|           |____|   |____________|                   |____|

To find solution we must create  <r>[F]</r>-matrix  of <r>"Function Values"</r> based on our <r>{f}</r> :
	 ___________________________
	|                           |
	| f1(X1), f2(X1) ... fn(X1) |
	| f1(X2), f2(X2) ... fn(X2) |
	| f1(X3), f2(X3) ... fn(X3) |
  <r>[F]</r> = |          .                | ,    <r>[F] * [K]  ~  [V]</r>
	|          .                |
	|          .                |
	| f1(Xm), f1(Xm) ... fn(Xm) |
	|___________________________|

Solution: "Least Squares" assumes equality:  F*K = V -->  Ft*F*K = Ft*V,  Ft - transp.F
<r>K</r> - solution of the system of linear equations:  <r>[A]*K = b</r>,  where: <r>[A]</r> = Ft*F, <r>b</r>= Ft*V
This task is performed by the command:  <m>jj reglin</m> .
<a name='rej'></a>________________________________________________________________________________________

    <o>jj  reglin  XV  x.arg  [USE case]  > Regr     ! <r>REG</r>ression <r>LIN</r>near
</o>
<m>Framework pik3d</m> proposes to use  <a href="#jj">pik3d jj-preprocessor</a>  to solve this problem.
It allows to define a set of regression functions: <r>{f}</r> and <r>"how to read"</r>
data from the matrix <r>XV</r>  as  <r>lines of Java code</r>  directly in the command line.
Three commands are implemented as  <m>jj-programs</m>  and must be launched using <n>jj-launcher</n>:
<m>
 > <n>jj</n>  reglin  XV  x.arg        [USE case]  > Regr    <y># 3 vectors    </y></m>  _______________<m>
 > <n>jj</n>  regtst  XV  x.arg  Regr  [USE case]  > Diff    <y># MAX,mean,RMS </y></m> |               |<m>
 > <n>jj</n>  regval  X   x.arg  Regr  [USE case]  > Values  <y># vector       </y></m> | x1, y1 ... V1 |
                                                                      | x2, y2 ... V2 |
where:                                                                | x3, y3 ... V3 |
 <m>XV,X</m> - matrix of experimental data(see above), usually: <m>[XV]=[X][V]</m>= |  .         .  |
                                                                      |  .         .  |
                                                                      |  .         .  |
                                                                      | xm, ym ... Vm |
                                                                      |_______________|
 <m>x.arg</m> - file contains <r>2 java lines</r> with <n>labeles</n> and possibly <y>comments(start with: #,!)</y>:
   <y># comments...</y>
   <n>fset:</n> <r>1, x,y, x*x, x*y ...</r>        <y># {f} - set of regression functions</y>
   <n>read:</n> <r>x=X[0], y=X[1], V=X[2]</r>      <y># "how to read data"- columns of x,y,V...</y>
   More information: <a href="#jaf">Argument Files, command: pl</a>

<m>[USE case]</m> - option <a href="#uve">"Use-Vector"</a> controls what case of [XV] will be processed.
             If option <m>[USE case]</m> is absent, ALL rows of [XV] will be processed.
 <m>USE</m>  - vector of length = the number of rows [XV], contains integer case numbers
        Only rows of [X] with selected case  will be processed
 <m>case</m> - integer >= 0 - selected case

 <m>Regr</m> - result file of the <m>jj reglin</m>, contains 3 stack-vectors:
      - Regr=Regr:1 - vector of the Regression Coefficients <r>Regr.{k}</r>
      - Regr:2 - statistics of Di = |Reg(Xi) - Vi| :  Max,  Average,  Root_Mean_Square
      - Regr:3 - vector: Di = Reg(Xi)-Vi,  in binary format,  for later use

There are three ways to transfer parametrs of Regressin to these commands:
 - <r>command line parameters</r>
 - <n>argument file</n>
 - <m>environment variable</m>      (this way has some problems in Linux)

Consider them using the example of the <m>reglin.jj</m> :
 > jj <m>reglin</m>  XV <r>"1, x, x*x ..." "x=X[0], <u>V</u>=X[1] ..."</r> [USE case] > R  <y>#</y> <r>cmd. params.</r>

 > echo  <n>fset:<r>  1, x, x*x ...</r>       >  fx.arg</n>                         </n><y># use echo</y>
 > echo  <n>read:<r>  x=X[0], <u>V</u>=X[1] ...</r>  >> fx.arg</n>                         <y># to create</y> <n>fx.arg</n>
or
 > <a href="#jaf">pl  </a> <n>"fset:<r>  1, x, x*x ...</r>" "read:<r>  x=X[0], <u>V</u>=X[1] ...</r>" > f.arg</n>    <y># recommended</y>

 > jj <m>reglin</m>  XV                       <n>fx.arg</n>         [USE case] > R  <y>#</y> <n>arg.file</n>

          <y>!!! There should be NO COMMENT after variable definition !!!</y>
 > set        <m>fx</m>=<r>"1, x, x*x ..." "x=X[0], <u>V</u>=X[1]..."</r>
 > jj <m>reglin</m>  XV                       <m>%fx%</m>           [USE case] > R  <y>#</y> <m>env.var. fx</m>

   <r>!!! The name <u>V</u> (capital V-"Value") is fixed, other parameters can be anything.
       The column of V is not fixed in [XV]  and can be any !!!</r>

The Regression can be defined in other variables, e.g:  x1, x2, V ... :
         <n>fset:</n>    <r>1, x1, x2, x1*x1, x2*x2, x1*x2 ...</r>
         <n>read:</n>    <r><u>V</u>=X[0], x1=X[1], x2=X[2]       ...</r>            <y># V is 0-column in [XV]</y>

Example: ( copy 5 lines below to the console )

 <m>jj Fx</m>  <r>"3-x-3*x*x+x*x*x"  "-1.3,3.41,.05"</r>| join - -[:,2] >R    <y>#prepare data</y>
 stk 95| gnoise - 3| put R[:,2] - 1 1 > XV                      <y>#Gaussian noise sigm=1.5</y>
 pl <r>"fset: 1, x, x*x, x*x*x"  "read: x=X[0],V=X[1]"</r>  > <n>f.arg</n>    <y>#create arg.File</y>
 <m>jj reglin</m> XV <n>f.arg</n> >R  &  fmt R  &  fmt R:2                    <y>#print {k} and Di stat.</y>
 <m>jj regval</m> XV <n>f.arg</n>  R| join XV -| vic - 1 2,-1 "3,0 F(x)" "4,0 Regr"  <y>#R.values, view</y>

> <m>jj reglin</m>   <y>#print reglin Help</y>

> useout      <y>#print useout Help, look at regr.bat, run it</y>

<n>Regression of two variables</n>  is presented  in the demo-example: <n>pik3d/demo/regression</n>
<a name='rva'></a>________________________________________________________________________________________

    <o>jj  regval  X  fx.arg  Regr  [USE case]  >  Rv   #<r>REG</r>ression <r>VAL</r>ues
</o>
Calculates the Regression Values based on the experimental data <m>[X]</m> and coefficients <n>{k}</n>
from the file: <m>Regr</m> ( obtained in  <m>>jj reglin ... > Regr</m> ), where:

 <m>X</m> - matrix of the experimental data:  Xi = { xi, yi ... }

 <m>fx.arg</m> - argument file (can be replaced by command line params. or env.variable):
   <n>fset:</n> <r>1, x,y, x*x, x*y ...</r>     <y># {f} - set of regression functions</y>
   <n>read:</n> <r>x=X[0], y=X[1],  ...</r>     <y># "how to read data"- columns of x,y</y>

   <n>!!! It is possible to use the same file  <m>fx.arg</m>  as in <m>> jj reglin ...</m> !!!
   In this case experimetal Values(Vi) <r>must be present</r> in <m>[X]</m> and in read: <r>parameter</r>
   They will not be used( can be any ). They are only <r>needed  when reading  X-line </r>.</n>

  <m>Regr</m> - Regression obtained in  <m>> jj reglin ... > Regr</m>, contains <n>{k}</n>.

 <m>[USE case]</m> - option "Use-Vector", see next section.
  <m>USE</m>  - vector of length = the number of rows <m>[X]</m>, contains integer case numbers
         Only rows of <m>[X]</m> with selected <m>case</m>  will be processed
  <m>case</m> - <r>integer >= 0</r> - selected case
         if option <m>[USE case]</m> is absent, <r>ALL rows of [X]</r> will be processed

  <m>Rv</m> - result file (console if absent), contains <n>vector of the Regression Values</n>

  See example:  <y>regr.bat</y>  in > useout
<a name='tst'></a>________________________________________________________________________________________

    <o>jj  regtst  XV  fx.arg  Regr  [USE case]  > Diff
</o>
<r>REG</r>ression <r>T</r>e<r>ST</r> = get Deviation( <r>Reg(Xi)-Vi</r> ) statistics on other data (e.g. other case)

Usually files:  <m>XV, fx.arg, R, USE</m>  are the same as in  <m>> jj reglin ... >R</m>
                But the case must be different to compare statistics !!!

<m>XV</m> - matrix of experimental data:  Xi = { xi, yi ... Vi ... }
<m>fx.arg</m> - argument file usually the same as in  <m>> jj reglin ... >R</m> , e.g.
   <n>fset:</n> <r>1, x,y, x*x, x*y       ...</r>     <y># {f} - set of regression functions</y>
   <n>read:</n> <r>x=X[0], y=X[1], V=X[2] ...</r>     <y># "how to read data"- columns of x,y</y>

<m>Regr</m> - Regression from <m>> jj reglin... > Regr</m>,  contains <n>coefficients {k}</n>

<m>[USE case]</m> - option "Use-Vector", see below
<m>USE</m>  - vector of length = the number of rows <m>[X]</m>, contains  case numbers
       Only rows of <m>[X]</m> with selected case  will be processed
<m>case</m> - integer >= 0 - selected case
       if option <m>[USE case]</m> is absent, <r>ALL rows of [X]</r> will be processed

<m>Diff</m> - result file (console if absent) is statistics of <r>|Reg(Xi) - Vi|</r>
       values[3]:   <n>Max,   Average,   Root_Mean_Square</n>

Example: ( copy 5 lines below to the console )

 <m>jj Fx</m> <r>"3-x-3*x*x+x*x*x +(rnd()-.5)" "-1.3,3.41,.05"</r> >XV  <y>#data with noise</y>
 usevec XV  1 80  <n>@use</n>| tt 40*2.0f  &  usestat use        <y>#print use, usestat</y>
 pl <r>"fset: 1, x, x*x, x*x*x" "read: x=X[0],V=X[1]"</r> ><n>f.arg</n> <y>#create arg.File</y>
 <m>jj reglin</m> XV  <n>f.arg</n>     use <r>1</r> >R & fmt R & fmt R:2       <y>#print: {k} and R.Diff, case=1</y>
 <r>jj regtst</r> XV  <n>f.arg</n>  R  use <r>0</r>                            <y>#print:    regtst.Diff, case=0</y>

result:<n>
 . . .
<m>> jj reglin XV</m> %fx%     <r>use 1</r> ...
 . . .
### MAX        Average       Root_Mean_Square [ 3 ]
 .5548023      .2444596      .2871637                     <y>#R.Diff <> regtst.Diff</y>
 . . .
<m>> jj regtst XV</m> %fx%  <r>R  use 0</r></m>
### MAX        Average       Root_Mean_Square [ 3 ]
 .4371455      .1949338      .2269329</n>                     <y>#regtst.Diff</y>
<a name='uve'></a>________________________________________________________________________________________

    <o>usevec  Stk  c1 p1 [c2 p2  c3 p3...]  > Use  !Create "<r>Use</r>-<r>Vec</r>tor"
</o>
Often the data is divided randomly into several parts. Some are used to build model,
others for verification. To use this technique, <m>pik3d framework</m> offers a <r>Use-Vector</r>,
which has the length = the number of rows of the data matrix and the i-element of the
Vector stores <r>integer "case"</r> of the i-row of the matrix.

Command: <r>usevec</r> performs random generation of the "cases" for the Stack-matrix.
Creates <n>### Use-Vector[ <r>Stk</r>_length ]</n>, set value <r>c1</r> in <r>p1</r>% of all positions in random
order  and  repeats this  for all pairs:  ( <r>ck, pk</r> ).
<n>
   if <r>c1</r> is absent, then all positions( 100% ) will be set to <r>0 (0-case )</r>.
   If <r>p1+p2+...pk &lt; 100</r> (%), then remaining positions will be set to <r>0 (0-case )</r>.
   If the last number <r>pk</r> is omitted, then remaining positions will be set to <r>ck</r> .</n>

Cases ci &lt; 0 are used  to mark  dropped outliers ( -9 for c=0 ).

Example: ( copy 3 lines below to the console )

 stk 100 5 @Stk| usevec - 1 <n>@u1</n>| tt 50*2.0f <n>&</n> usestat u1     <y># u1: 1 in 100% positions</y>
 <r>usevec</r> Stk  2 20        <n>@u2_20</n>| tt 50*2.0f <n>&</n> usestat u2_20  <y># u2_20: 2 20%, 0 80%</y>
 <r>usevec</r> Stk  1 30  3 45  5  <n>@u5</n>| tt 50*2.0f <n>&</n> usestat u5     <y># u5: 1 30%, 3 45%, 5 25% !</y>
<a name='sta'></a>________________________________________________________________________________________

    <o>usestat   UseVector  [case]   !<r>Stat</r>istics of Use-Vector or case
</o>
Analyzes the vector and displays Statistics:  case, number, dropped outliers.  Examples:
e.g. ( copy 3 lines below to the console )

 stk 100| usevec - 1 11  2 22  3 33  4 19 5 @U|tt 20*3.0f <n>&</n> <r>usestat</r> U   <y>#create and show</y>
 <m>jj "var u=inVect2(arg[0]); for(int i=0;i<100;i+=2)u[i]*=-1; ttVect2(u)" U > U_</m>
 fmt U_ 20*3.0f  <n>&</n>  <r>usestat</r> U_                                <y>#"drop" odd elements, show</y>
<n>. . .
! USE vector: U_[ 95 ]
### case    number    dropped  [ 5, 3 ]
     1           9          2
     2          12         10
     3          16         17
     4           4         15
     5           9          6</n>
<a name='uca'></a>________________________________________________________________________________________

    <o>usecase  M  U  c  > Mc   ! get <r>"Use Case"</r> from  Matrix
</o>
Select from the matrix M the rows for which Use-Vector U has value c.
<r>All parameters are mandatory !</r>

Example: ( copy 2 lines below to the console )

 stk 100 3| noise - 1 <n>@d</n>| usevec - 1 37 2 <n>@u12</n>| tt 20*3.0f     <y>#stack: d, use: u12, view</y>
 usestat u12 <n>&</n> <r>usecase</r> d u12 <r>1</r>| tt /h <n>&</n> <r>usecase</r> d u12 <r>2</r>| tt /h <y>#view headers of usecases</y>
<a name='uou'></a>________________________________________________________________________________________

    <o>useout  R  s=dV | v=dS  > new_USE  !Remove <r>OUT</r>liers in new <r>USE</r>-Vector
                                      !outliers are marked as -case &lt;0</o>
where:
  R    - result of > jj reglin ...  contains: USE, case, R.M.S., Reg(Xi)-Vi ;
  v=dV - permissible deviation( tolerance ) as "subject Value" ;
  s=dS - tolerance in "Sigma"~ Root Mean Square deviation( R:2[3] ) ;
  new_USE - modified Use-Vector from R (if it is absent in R, create new with case=1 ),
            rows with deviation > tolerance are outliers: case=-case &lt;0, -9 for case=0.

      <r>!!! Experience shows that removing outliers  RARELY  improves Regression !!!</r>

Example:  <r>F(x)=3-x-3*x*x+x*x*x</r>,  Gaussian noise with sigma=1.5
Copy lines below to the console or create a batch file  and  run it several times.
<y>------------------------------------------- regr.bat:</y>

 <m>jj Fx</m>  <r>"3-x-3*x*x+x*x*x"  "-1.3,3.41,.05"</r>| join - -[:,2] >XF
 stk 95| gnoise - 3| put XF[:,2] - 1 1 @XV| vic - 1 2,-1 "3,0 F(x)"  <y>#initial chart</y>

 pl <r>"fset: 1, x, x*x, x*x*x" "read: x=X[0],V=X[1]"</r> > <n>f.arg           <y>#create arg.File</y>
</n>
 <m>jj reglin</m> XV <n>f.arg</n>      >R   &  fmt R   &  fmt R:2    <y>#R-Regression:  {k},  R_sigma</y>
 <m>jj regval</m> XV <n>f.arg</n>       R   |  join XV -  >V1        <y># V1 = chart data   + R</y>

           <r>useout   R s=1.8</r>  @u1 |  tt  20*3.0f        <y>#tolerance=1.8*R_sigma, tt u1</y>

 <m>jj reglin</m> XV <n>f.arg</n> u1 1 >R1  &  fmt R1  &  fmt R1:2   <y>#R1-Regression: {k}, R1_sigma</y>
 <m>jj regval</m> XV <n>f.arg</n>       R1  |  join V1 -  >V2        <y># V2 = chart data   + R + R1</y>

 vic V2 1 2,-1 "3,0 F(x)" "4,0 R" "5,0 R1"  /y=400     <y>#show initial chart + R + R1</y>

<y>------------------------------------------- &lt;eof></y>
To close ALL Charts: <n>> kk</n>                         <y># TASKKILL /FI "IMAGENAME eq java*" /f</y>
<a name='mnk'></a>________________________________________________________________________________________

  <o>lss XY [N=3] [/vis] [/add=File] > SPL  !<r>L</r>east <r>S</r>quares <r>S</r>pline of N parts
</o>
XY [N=3] [/vis] [/add=File.add] > SPL  !Least Squares Spline of N parts

The XY stack must contain at least 2 columns: arguments and function values.
It may use slice description, like: XY[:,(2,5)], see: pik3d_DOC.html.
only the first two columns of XY or slice are used!  The data can be not ordered.
The command will order them in ascending of the argument( 1st column ) if necessary.

If the key: <r>/vis</r> is present,  XY points,  Spline  and  intervals  are displayed.
If <r>/add=File</r>[.add] is present, <a href='#addgra'>Additional Graphics</a> is displayed, see: pik3d_DOC.html

If the  <n>command: lss</n>  does not output data,  run it with the key: <r>/dbg</r> !
Result File contains 3 Stacks/matrices delimited by "### <eos>":

The 1st Stack:  SPL:1 contains the Spline Coefficients [ N, 5 ], N rows of 5 values:
  - 1st value: xi - the beginning of the interval of i-part;
  - s0, s1, s2, s3 :  S(x) = s0 + s1*t + s2*t*t + s3*t*t*t,   where: t = x-xi .
Spline coefficients SPL can be used in the  command: spl  to calculate spline values
for a given set of arguments.

The 2nd Stack:  SPL:2  contains matrix of 3 columns:  X[], Y[], Spline[] .
It may be viewed in simple way: > vics  SPL:2 1  2,-1  3,0

The 3rd stack:  SPL:3 -"difference":  MAX,  Average,  Root_Mean_Square
R.m.s. is indicated on the title of the chart  if key /vis is used.  Examples:
<a href="#jj">jj-program</a> to generate data: pik3d/usr/TestLSS.jj :
<m>{
  int i, n=30, nn=n*3;
  double dx=2*pi/n, x=.6, Fun;
  tt("### XYF [ "+nn+", 3 ]");  // XY + Function
  for(i=0; i&lt;nn; i++) {
    Fun = 3*sin( x )*exp( -x/7 );
    tt( x, (Fun+(rnd()-.5)), Fun);
    x+=dx;
  }
}</m>
- see: pik3d/demo/2d-graph/_run.cmd (line:13)

> jj TestLSS @XYF | lss - 7 /vis @SPL | spl - XYF > XYFS       <y>#XYFS[90,4]=XYF[90,3]+Spl</y>
> vics XYFS 1 "2,-1 Data" "3,0 Function" "4 8 0 Spline" /y=400 <y>#plot:  Data, Fun, Spline</y>
<a name='spl'></a>________________________________________________________________________________________

    <o>spl  SPL  X  > File   ! Getting Spline Values
</o>
Arranges X rows if necessary, computes spline values( with SPL from <a href='#mnk'>command: lss </a>),
<r>appends!</r> to X a new column with them  and  outputs to the File.

> jj  TestLSS @XYF  |  lss - 7 /vis  > SPL               <y># XYF[90,3] & save Spline =>SPL</y>
> spl   SPL    XYF  >  XYFS                              <y># XYF[90,3]+Spl => XYFS[90,4]</y>
> vics XYFS 1 "2,-1 Data" "3,0 Function" "4 8 0 Spline"  <y># plot: Data, Fun, Spline</y>
<a name='vis'></a>________________________________________________________________________________________

  <o>vic[s] - <r><u>VI</u></r>sualize <r><u>C</u></r>olumn [with akima-<r><u>S</u></r>pline</o><m>( Hiroshi Akima, Spline, 1970 )</m><o>]</o>

  <n>!!! IT IS NOT RECOMMENDED TO DISPLAY COLUMNS LONGER<r> > 100,000</r> elements !!!</n>

The parameters for the <o>vic</o> and <o>vics</o> commands are the same.
Sign <r>,</r> in the command means default value.

<r>Only the columns of the first frame are displayed</r>
To display columns of the 7-frame:  <a href="#sec">sec</a> Stk k=7 | <o>vic - ...</o>
In case of lines   of the 9-frame:  <a href="#sec">sec</a> Stk k=9 | <a href="#tra">tra</a> - | <o>vic - ...</o>
If you need to display Stk[3,5,:]:  <a href="#sec">sec</a> Stk i=3 | <a href="#tra">tra</a> - | <o>vic - , 5 ...</o>

<r>vic Stk  jX  j1 j2 ...  [keys]</r> , where:
     Stk - stack name, ONLY 1-frame is always used
          jX - column X[] -"argument values":
                  0: X[] = 1, 2, 3, 4 ... - default, "scan by numbers";
                  N: X[] = N-column values;
             (V dV): X[] = V, V+dV, V+2*dV, V+3*dV ... ;

              j1 j2 j3... - columns( no more than 12 ) will be shown as functions of X[]
                            default j1=1, if jK<0 - only markers without a line
keys:
     <r>/lgx, /lgy, /lgxy</r> - Logarithmic Scale of the correspondent axis
     <r>/x=px, /y=py</r> - position in pixels of the up left window corner, defaults: 0,0
     <r>/w=pw, /h=ph</r> - width and height in pixels of the window, defaults: 640, 400
     <r>/add=file[.add]</r> - add to chart previously saved <Alt+A> Add.graphics: Texts,Lines,Figs
     <r>/dbg</r> - allows you to see error messages

     <r>/blank</r> - mode to prepare chart without data-curves and axes.
     Only  Figures, Texts, Lines  will be saved by ^S in WMF-file.
     This mode can be used to create illustrations, flowcharts, <a href='#addgra'>additional Graphics</a>.
     Aspect ratio of the chart  <r>is fixed</r>.  For the convenience  of  drawing,
     an additional grid is displayed. It can be considered as a centimeter markup.
     The final drawing  can be limited by  <a href="#pad">OFFSET from the window border</a>.

examples:
  vic                            !get HELP or > vic /?
  vic q                          !stack q: "by numbers" 1-column == q,, == q,1 == q 1 1
  vic q,4                        !---:---:---:---:---   4-column
  vic q (2 .5) 6 7 /w=999 /h=555 !---:---: X=2,2.5,3... 6,7-columns, window[0,0,999,555]
  vic q 1 2 /lgy                 !chart with Log.Scale Y-axis
  vic /blank /add=AddGraph.add   !blank with add.graphics( it can be loaded later ^A ).

default <r>"Legend"</r> contains:  colored line with marker,  stack name  and  column number.
"Legend" can be dragged. Before saving, you can add Texts(^T), Lines(^L), Figures(^F).
&lt;F1> -"Help": Add.graphics, options: ^T, ^L, ^F, ZOOM ...  <a href="#gra">more abour 2d-graphics</a>.

         c = Colors[ 11 ]:     m = Markers[ 10 ]:
         <b>0 - black             </b>0 - LINE WITHOUT MARKER
         <font color=0000d8><b>1 - blue</font>              </b>1 - small filled square
         <font color=228b22><b>2 - green</font>             </b>2 - diamond
         <font color=ff8c00><b>3 - orange</font>            </b>3 - triangle
         <font color=04b4ff><b>4 - cyan</font>              </b>4 - square
         <font color=d500d5><b>5 - lilac</font>             </b>5 - pentagon
         <font color=00de00><b>6 - light green</font>       </b>6 - inverted triangle
         <font color=777777><b>7 - gray</font>              </b>7 - "butterfly"
         <font color=eb0000><b>8 - red</font>               </b>8 - +
         <font color=005c81><b>9 - gray-green</font>        </b>9 - x
        <font color=753838><b>10 - brown</font>            </b>10 - O or circle

	     special markers: 11 - marker[1] + line down to X-Axis
	                      12 - marker[1] + line left to Y-Axis

With a large number of graphs, colors repeat in a cycle: 0-10 (from 1), markers: <r><u>1</u></r>-10

<r>"DETAILS"</r> is required to set color, line without marker and/or text in <r>"Legend"</r>:
<r>"j c [ m [ text ]]"</r> !!! QUOTATION MARKS ARE OBLIGATORY if there is a SPACE in <r>"DETAILS"</r>
 <r>j</r> - column number if j &lt; 0 - only markers without a line
   <r>c</r> - color or ',' or hexadecimal value( <u>6 digits:</u> <r>RR</r><g>GG</g><n>BB </n>, example: <font color=4b0082>4b0082 - Indigo</font> )
       <r>m</r> - marker or ',' - if m &lt; 0 - only markers without a line
           <r>text</r> - if set - "Legend" will contain this text
examples:
  vic q,,2 -3 5,0 7,-1      !col.: 1,2,3,5,7: 3-markers only, 5-line only, 7-squares
  vic q (2 .1) 2,0 3,0 4,0  !X[]: 2, 2.1, 2.2, 2.3... columns: 2,3,4 - lines only

  vic q,  3,,Blue  5,,Green  7,,Orange   !"by numbers", columns: 3, 5, 7

  vic q,,2 8,,dt,ms -7 "4 4b0082, Delay" 15.0 "9 7, Limit [ms]"
      q-stack( 1st frame ), "scan by numbers"(1st comma) of the following columns:
        1: (2nd comma - default) blue line, square, no text;
         2: green line, diamond, no text;
           8: (details without spaces) orange line, triangle, text="dt,ms";
                     7: blue square, no line, no text;
                        4: Indigo( 4b0082 ) line, 5-gon, text="Delay";
                                         15: purple line, no markers, no text;
                                               9: gray line, inv.triangle,"Limit [ms]"
<a name='vip'></a>________________________________________________________________________________________

  <o>vimp  config  [keys]  - "<r><u>VI</u></r>sualize <r><u>M</u></r>ultiple stacks <r><u>P</u></r>lots" in one chart
</o>
where: <r>config</r> is a text file, may contain empty lines and comments(start with # or ! ).
       <r>keys</r>   are the same as <a href="#vis">vic-command</a>.

Column display parameters :  <r>vic Stk ...  and  vics Stk ...</r>
exactly match the commands:  <a href="#vis">vic Stk ...  and  vics Stk ...</a>   Example config file:
<n>
  # this is a comment
    <r>vic </r> p5
    <r>vic </r> q,,2 3
    <r>vics</r> q25, -3 "4 4b0082, Delay" "9 7, Limit [ms]"
  ! config END.</n>

We can create the config dynamically on the fly while executing the <n>batch file</n>, e.g.

  rem  cretae config  &  execute it  with Spline data:</n><n>
  jj   TestLSS  @XYF  | lss  XYF  7  > SPL
  spl  SPL       XYF  >      XYFS
  echo vics XYFS 1 "2,-1 Data" "3,0 Function" "4 8 0 Spline" > <r>config</r>
  echo vic  SPL  1 "2 9 -11 begin interval"                 >> <r>config</r>
  <r>vimp config</r></n>
<a name='gra'></a>________________________________________________________________________________________

	<o> Use of 2d-graphics</o>

  <n>&lt;F1></n>      - quick help.
  <n>&lt;^S></n>      - save image in .WMF format
  <n>&lt;^+/ ^-></n>  - quick increase/ decrease of the window by ~10%.
              Size of the window can be changed using standard Windows tools.

          <n>!!! TO CLOSE ALL OPENED 2d-CHARTS  run  script: kk !!!</n>

Subject coordinates( SC ) of the cursor are displayed in the window title.
<r>When CLICKING with any mouse button, SC are copied to the CLIPBOARD.</r>
This allows you to build a table of measurements: after clicking go to the text editor
and <r>"Paste"</r> the values from the clipboard( <r>&lt;Ctrl+V> or &lt;Shift+Ins></r> ).

You can select and enlarge a fragment of the chart - <r>ZOOM</r>:
1. Press Left Mouse button and <r>"Drag" Down-Right</r> .
2. Without releasing the mouse button, select the size of the rectangle.
3. Release the mouse and <r>click inside the rectangle</r> - a new ZOOM window will open.
4. Select the size and aspect ratio of the new ZOOM window.
5. Select the position of ZOOM in the main window - <r>"Drag" rectangle</r>.
6. The size of the rectangle can be changed: <r>"Drag" ANY corner of the rectangle</r>.
7. The rectangle in the main window exists as long as ZOOM window is not closed.

You can add <r>TEXT, LINE or FIGURE( box, oval, romb )</r> anywhere in the window:

  - <r>&lt;Ctrl+T></r> - add  <r>TEXT</r> :
      - in the dialog that appears, select Color, Size, enter text;
      - <r>&#8593;/&#8595;</r>  - increase/ decrease  FONT Size;
      - <r>drag</r> text to the desired location, press OK or &lt;Enter>.

  - <r>&lt;Ctrl+L></r> - add  <r>LINE</r>
        A line can consist of several fragments: Bezier curves and/or straight lines.
        Form is controled by Hotspots( HS ). <r>YELLOW HS</r> are used in Bezier curves
        to control the shape. They are arranged symmetrically for continuity of the
        first derivative. You can OFF them (X-function) to get fragment of straight line

        The <r>RED HS</r> define the start and end of the fragment.
        When the cursor is hovered over a HS, it is activated - the cursor changes
        shape to a "hand". When RED HS is activated, you can execute the functions by
        pressing the keyboard: <r>A/D, X, &#8592;/&#8594;</r>.
        If no one HS is active - the function is applied to the Last Line Fragment.

      - <r>A/D</r>  -"Add" new RED HS after this/ "Delete" HS or Last Fragment;
      - <r> X</r>   - ON/ OFF  YELLOW HS for this HS  - Shape Controls for Besier curve;
      - <r>&#8592;/&#8594;</r>  - ON/ OFF  <r>ARROW</r>  at the Hotspot or at the start/end of the Last Fragment.

      - <r>+/-</r>  - increase/ decrease  the <r>Line Width</r>
      - <r>&#8593;/&#8595;</r>  - increase/ decrease  <r>ARROW Size</r>.
      - <r>Right Mouse Drag  any  Red Hotspot  moves  the whole  LINE !</r>

  - <r>&lt;Ctrl+F></r> - add standard  <r>FIGURE </r>: Rectangle, Oval, Romb - select by Radio Button.
        The size and position are adjusted by Red Hotspots. You can Fill the Figure
        by selecting check box and color. To redefine Fill Color click color once more.
      - <r>+/-</r>  - increase/ decrease Line Width/ thickness of the Figure Border;
      - <r>Right Mouse Drag  any  Red Hotspot  moves  the whole  FIGURE !</r>

  - <r>&lt;Ctrl+Z></r> - Delete Last Added: Text, Line, Add.Graphics. May be done several times.

<n>!!! After Drag Text/ Hotspot, Fine Tuning of the Position can be done by ARROW Keys !!!
    Hotspot must be Active("hand"). ARROW Keys reproduce LAST Move/Drag Mouse Function.
    Standard use:  Drag Text/ Hotspot  by Mouse,  Fine Tuning  by ARROW Keys .</n>
<a name='addgra'></a>
  - <r>&lt;Alt +A></r> - Save to File <r>Additional Graphics</r>: Texts,Lines,Figures,previous Add.Graph.
               Add.Graphics is not tied to the subject coordinates. It exists in the
               window coordinates !  One Graph  can be used  in  different charts.
  - <r>&lt;Ctrl+A></r> - Add to chart Add.Graphics from File[.add]( saved by &lt;Alt+A>).
               May be done several times  with  different addons.

  - <r>&lt;Ctrl+B></r> - ON/ OFF  <r>Background</r> Color  of the chart.

  - <r>&lt;Ctrl+C></r> - ON/ OFF  Cursor Lines."+

  - <r>&lt;Ctrl+S></r> - Save chart in <r>"Windows Meta File"</r> - vector graphics, that Scales well
               and is supported by MS Word, ACDSee, Total Commander &lt;F3> ...
               If the chart uses characters  of a code page  other  than cp1252,
               this code page  must be specified  after  the file name  with comma,
               for example (Cyrillic):  chart.wmf<r>, cp1251</r>

<a name='pad'></a>
             <r>Setting graphics indents( PADDING )</r> from window borders:

  - <r>&lt;Ctrl></r> + move the cursor to the window border.  The cursor should change shape.
  While holding down  <r>&lt;Ctrl> and &lt;Left Mouse Button></r>  drag  the window border  to
  a new position.  You can add  lines and text  to the freed space.
  It is convenient  to adjust the corners  of the window  standing  diagonally.
  If <r>Set Padding mode</r> is in effect after release buttons - press <r>&lt;Ctrl></r> once more.

<o>
       Graphics Features:
</o>
- THE SIZE OF THE AXES SIGNATURES IS FIXED ( does not increase with an increase of the
  window).If the document needs large axes labels, select a small window size before ^S.

- When resizing the window, the position( in subject coordinates ) of the lower left
  corner of the texts remains unchanged. "Legend" base point - its upper right corner.

- The aspect ratio of the image can only be changed until is saved: ^S  .

- <r>WMF</r> is a vector format( LINES, NO pixels ), so it Scales well.
  In the  MS Word document  you can stretch the image  to the desired size.

- When manipulating a <r>WMF</r> image, the font will resize according to the image size.
<a name='tif'></a>________________________________________________________________________________________
<o>
     command:  tif  File.tif  [Npro=99999]   #Show   one    tif file
               tif  Config    [Npro=99999]   #Show multiple tif files
</o>
You can save a clip as a multi-pages tif-file by the command <a href="#s3F2"> s3d: &lt;F2> </a>.
You can use multi-pages tif-files created in other programs ( ImageJ ...)

All pages are displayed sequentially. The cycle is repeated <n>Npro</n> times.
This parameter should not be specified unless required fixed number of views.

To display multiple tif files synchronously, <n>Config file is required:
       ___________Config__________
      |                           |
      | dt[ms] = &lt;frame interval> |
      |                           |
      | File1.tif, x1, y1, w1, h1 |
      | File2.tif, x2, y2, w2, h2 |
      |       ...                 |
      | FileN.tif, xN, yN, wN, hN |
      |___________________________|
</n>
where:  <n>dt[ms]</n> - time interval in milliseconds between frames, default=200 ;
        <n>xk, yk</n> - coordinates of the upper left corner of the k-image ;
        <n>wk, hk</n> - width, height of the k-image,  k=1,2,3...N .

Show can be:
  - stop/continue: <r>&lt;Mouse Right click>  or  &lt;space></r>;
  - speed up/ slow down: <r>&lt;Ctrl+Right>/ &lt;Ctrl+Left></r>,  default: 5 frames/sec.

Frames can be scrolled by rotating the <r>Mouse Wheel</r> or keys: <r>&lt;Left>/&lt;Right>, &lt;Home>/&lt;End></r>
<a name='pik'></a>________________________________________________________________________________________
<o>
		Most used pik.io methods

<u>static methods:</u>
</o><n>
  int cmd( String cmd, String[] arg, String help ) </n>//checking arg[] parameters
    // If arg is empty or arg[0]=<r>"/?"</r>, then help is displayed and program stop
    // supports <m>@file</m> service - duplicating pipe-output to the file
    // returns <r>real length of arg[]</r>, it does not count: <m>@file</m> and <y>comments after #,!</y>
<n>
  double[] getPars( String[] arg, d0,d1,d2 ...)    </n>//get values from command line args.
    // if i-value is absent or replaced by <r>','</r> default: <n>di</n> is used<n>
  double[] getPars( String   str, d0,d1,d2 ...)    </n>//the same, but all args in one str.
<n>
  String getKbd( String prompt, String default )   </n>//print <n>prompt</n> on the console and
    // input string from the Keyboard. If <n>&lt;Enter></n> is pressed without any text, <n>default</n>
    // string is returned, see: pik3d/usr/ijk.jj
<n>
  double getSTi( String stk, int... ijk )</n>   //get Stack element with [ i,j,k ] indexes
<n>
  double getdbl( String s )</n>                 //get double value from the String.
</n>
<o>Read/Write to the standard streams: <r>System.in / System.out</r></o>

  <n>void tt( String s )  </n> //output string to stream: System.out
  <n>void <r>ee</r>( String s )  </n> //output string to stream: <r>System.err</r>
  <n>void tt( double... x)</n> //output to System.out double[](may be float): tt(1,.2f,9e9,-1)
  <n>void <r>ee</r>( double... x)</n> //output to <r>System.err</r> ---:---:---:---:---:---

  <n>String stdin()</n>                    //input String from the <r>System.in</r> ("ASCII" charset)
  <n>String stdin( String charset )</n>    //use <n>charset</n> to decode input.

  <n>float [][][] inStack ( String file ) </n>//read stack into <r>float [][][]</r>
  <n>double[][][] inStack8( String file ) </n>//read stack into <r>double[][][]</r>

  <n>float [][] inFrame ( String file ) </n>//read the <r>1st frame</r> of the stack into <r>float [][]</r>
  <n>double[][] inFrame8( String file ) </n>//read the <r>1st frame</r> of the stack into <r>double[][]</r>

  <n>void ttFrame( Object <r>F</r> ) </n>//<r>F</r>rame out: <r>float[][]   or double[][]</r>,   <a href="#bin">bin.format F4|D8</a>
  <n>void ttFrame( Object <r>F</r>, String name )  </n>//the same as previous with <n>Frame_Name</n>
  <n>void ttStack( Object <r>S</r> )</n> //<r>S</r>tack out: <r>float[][][] or double[][][]</r>, <a href="#bin">bin.format F4|D8</a>
    // output format( F4 or D8 ) depends on Object: float[]... or double[]...

  <n>void clott()</n> // close/clean up pik.io resources, should <r>ALWAYS</r> be called at the end !
  If you use <a href="#jj">jj-preprocessor</a>, this call is already present !

Frame is 2-dimensional array <r>frame    [ ii ][ jj ]</r>, e.g. 3-row  : <n>var s3 = frame[ 2 ];</n>
Stack is 3-dimensional array <r>stk[ <u>kk</u> ][ ii ][ jj ]</r>, e.g. 5-frame: <n>var k5 = stk  [ 4 ];</n>
You can use file names with stack number (see below): "A.dat:3", "-:4"

If the stacks are small and there is enough memory to accommodate them entirely,
it is recommended to use these  <o><u>static methods</u></o>.

<o>Read Frame, <u>instance methods:</u></o>

  <n>io reader = new io( String file )</n> // constructor: create a reader of the File,
                                    // if <r>file ="-","-:N"</r>,  then reading from <r>System.in</r>
If the file/stream contains multiple stacks separated by lines <r>### &lt;eos></r> (<r>E</r>nd <r>O</r>f <r>S</r>tack),
then the filename might look like this: <r>Stk:3, -:4</r>. Last means: 4th stack in  <r>System.in</r>

  <n>float [][]   reader.inFrame () </n>   // read frame into <r>float [][]</r>    - 2d-array ;
  <n>double[][]   reader.inFrame8() </n>   // read frame into <r>double[][]</r>    - 2d-array ;
                                    // Frame can be in any format:<a href="#dat"> Text,I2,F4,D8<a>
  <n>float [][][] reader.inStack () </n>   // read stack into <r>float [][][]</r>  - 3d-array ;
  <n>double[][][] reader.inStack8() </n>   // read stack into <r>double[][][]</r>  - 3d-array ;

The reader reads frame by frame sequentially. If it encounters end of file or
<r>### &lt;eos></r> (End Of Stack), then the methods <n>inFrame(), inFrame8()</n> return null
and <n>inStack(), inStack8()</n> ends reading and returns a 3d array. In the case of several
stacks in the file/stream, the reader is ready to read the next stack.

  <n>void reader.skipStk( int n ) </n>     // Skip n stacks.
  <n>void reader.reset()          </n>     //"rewind" file/ input stream to the beginning.

reader does not need to be closed, readers are closed at the end by the method: <n>clott()</n>.
A package to read/write  ###-files  in  <r>PYTHON</r>:  <r>kadr.py</r>  - pik3d\ext\###_PYTHON.zip .
<o>
Simple 2d-graphics ( can be used with <a href="#jj">jj-preprocessor</a> ):</o>

Universal pik3d window <r>gra</r> is used. It supports all services <a href="#gra">"Use of 2d-graphics"</a>.
static methods:<n>
  <r>gra</r> simple( String title, double[] xx, double[] yy, int mark )  </n>// one plot: y(x)<n>
  <r>gra</r> simple( String title, double[] yy )                         </n>// xx[]={1,2,3...}<n>
  <r>gra</r> simple( String title, double[] xx, double[]... yy )         </n>// several plots

if you have <r>gra w</r> created by <n>simple()</n>, you can :<n>
  <r>w</r>.setLocation( xpix, ypix )         </n>// set window location on the screen<n>
  <r>w</r>.pen( n );  <r>w</r>.pen( rgb )           </n>// set color(<a href="#vis"> 0&lt= n &lt;=10 </a>or rgb ~ 0x04b4ff )<n>
  <r>w</r>.bold( npix )                      </n>// set line-width in pixels<n>
  <r>w</r>.fun    ( xx, yy, mark )           </n>// add plot:   y(x)  to <r>w</r><n>
  <r>w</r>.aspline( xx, yy, mark )           </n>// add spline: y(x), if <a href="#vis">mark</a>=0  - only line<n>
  <r>w</r>.font(size); <r>w</r>.txt( text, x, y )   </n>// in <r>w</r>-subject coord.: x,y add String text<n>
  <r>w</r>.repaint();                        </n>// is required! after manipulation with <r>gra</r>
________________________________________________________________________________________
<f>
                              author: K.A. Ilyashenko, e-mail: kilyashenko@gmail.com
                              Error messages, comments, suggestions  are  welcome .
</f></pre></h5></body></html>
