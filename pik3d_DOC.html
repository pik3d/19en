<html>
<head><meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<title>pik3d_DOC</title>
<style><!--
body {background:white; color:Black; font-size:14px; line-height:13px; font-family:'Monospace'}
a:link, a:visited {color:blue; text-decoration:none;} a{font-weight:bold;}
o{font-weight:bold; Color:#a300a3; font-size:14px; font-style:italic;}
r{Color:RED;font-weight:bold;}
g{Color:#3db84e;font-weight:bold;}
n{Color:#0050ff;font-weight:bold;}
m{Color:#777777}
f{font-weight:normal; Color:#0047b3; font-size:12px; font-style:italic;}
x{background:#333333; color:#00FF00; font-size:13px; line-height:13px; font-family:'Courier'; font-weight: normal;}
--></style></head><body>

<h5><pre><a name='s3d'><f>pik3d - framework for processing and 3d-display of matrices and their sequences
        Help has standard HTML navigation: &lt;Home>, &lt;End>, &lt;Alt+Left>, <a href="#ins">links</a> ...
</f><a name='ogl'></a>
<a href='#fwk'>DESCRIPTION of&nbsp; pik3d &nbsp;v.20.0</a>
<a href="#ins">INSTALL pik3d </a>
<a href="#dat">###-format of the data: FRAME, STACK</a>
<a href="#cmd">COMMANDS</a>

  <a href='#sss'>s3d -"Surface-3D" </a>                           ! <r>3D</r>-display of the Stack

Stack: create, view, info:
  <a href='#40' >stk  ii  [ jj=1 [kk=1]]  [v=&lt;value>]  [D8]</a>   ! Create new <r>St</r>ac<r>k</r>
  <a href='#fmt'>fmt  Stk [ I2|F4|D8| n*w.pS ]  [LE]</a>          ! Convert <r>f</r>or<r>m</r>a<r>t</r> or Print Stack
  <a href='#tt' >...| tt            [ n*w.pS ] </a>               ! Print ALL Stacks from <r>"pipe" as Text</r>
  <a href='#ren'>renam  Stk  name   [N=1] </a>                    ! <r>Renam</r>e Frames: name_N, name_&lt;N+1> ...
  <a href="#hhh">hhh  Stk </a>                                    ! print to std.<r>ERR</r> Stk-<r>H</r>eader & comments
  <a href="#eeh">ee  [text] </a>                                  ! print to std.<r>ERR</r> current time & text

Data Generation:
  <a href="#60" >gauss   [r=2 [ width=3 ]] </a>                   ! create normalized Gaussian filter
  <a href="#bel">bell  K "x y h r"   ["x1 y1 h1 r1"] </a>         ! add Gaussian "Bell"
  <a href="#wav">wave  K "x y h r a" ["x1 y1 h1 r1 a1"] </a>      ! add Gaussian "Wave"
  <a href="#gel">gen3d   config </a>                              ! "3d-Stack Generator"
  <a href="#140">noise   Stk  [amp =.1] </a>                      ! add "Uniform <r>Noise</r>"
  <a href="#145">gnoise  Stk  [R=.1] </a>                         ! add "<r>G</r>aussian <r>Noise</r>", sigma=R/2
  <a href="#his">hist    Stk  [Fr=1 [Nint=100]] [/add=File]</a>   ! Frame <r>Hist</r>ogram

<a href='#djk'>STACK PART: Stk[ di,dj,dk ] </a>                   ! <r>"Slice"</r>, index subsets
  <a href='#get'>get       Stk[ di,dj,dk ] </a>                   ! <r>get</r> Part of the Stack
  <a href='#put'>put       Stk[ di,dj,dk ] Part [p=1 [s=0]]</a>   ! Stk[] = s*Stk[] + p*Part
  <a href='#dim'>dim32     Stk </a>                               ! convert <r>3d</r>-Stack --> <r>2d</r>-Matrix
  <a href='#csv'>csv  CSV-file [ di,dj ]   [D8] </a>              ! read <r>"Comma-Separated Values"</r> file

Matrix Operations:
  <a href="#mul">mul   A  B  [C D ...]</a>                        ! Matrix <r>mul</r>tiplication
  <a href="#dif">dif   A  0 | A  1 |  A  B </a>                   ! <r>dif</r>ference of the Matrix/ Stack
  <a href="#inv">inv   A </a>                                     ! <r>inv</r>ert Matrix
  <a href="#sys">sys   A  b </a>                                  ! Linear <r>sys</r>tem solver
  <a href="#eig">eig   A </a>                                     ! <r>Eig</r>en Values and Vectors
  <a href="#svd">svd   A </a>                                     ! <r>S</r>ingular <r>V</r>alues <r>D</r>ecomposition
  <a href="#dia">diag  A  [Vector] </a>                           ! <r>Diag</r>onal put/get </a>
  <a href="#tra">tra   Stk </a>                                   ! Stack <r>Tra</r>nsposition
  <a href="#tra">rot90 Stk </a>                                   ! <r>Rot</r>ate Frames on <r>90</r> degrees

Linear Regression:
  <a href="#reg">linreg  VF  Y </a>                               ! <r>Lin</r>ear Least Squares <r>Reg</r>ression
  <a href="#tst">tstreg  VF  K </a>                               ! <r>Test Reg</r>ression on another use case
  <a href="#uve">usevec   m  c1 p1 [ c2 p2 [c3 p3]] </a>          ! Create and Fill Randomly <r>Use-Vec</r>tor
  <a href="#sta">usestat     U [c] </a>                           ! Use <r>Stat</r>istics
  <a href="#uca">usecase  M  U  c </a>                            ! Get Use <r>"case"</r> from Matrix
  <a href="#uou">useout   K  s=dS | v=dV </a>                     ! Remove from use case dropped points
  <a href="#mnk">lss   XY   [N=3]  [/vis]  [/add=File]</a>        ! <r>L</r>east <r>S</r>quares <r>S</r>pline of N parts
  <a href="#spl">spl   SPL  X </a>                                ! get values of the <r>Spl</r>ine

Data Processing:
  <a href="#180">blur   Stk  [R=2] </a>                           ! Smoothing, "Gaussian <r>Blur</r>"
  <a href="#190">filtr  Stk   Fltr </a>                           ! Filter
  <a href="#160">top    Stk   level </a>                          ! "Cut <r>Top</r>"
  <a href="#170">bot    Stk  [level=0] </a>                       ! "Cut <r>Bot</r>tom"
  <a href="#210">ma     Stk  [N=5 ] </a>                          ! <r>M</r>oving <r>A</r>verage
  <a href="#220">sma    Stk  [N=5  [level=0 ]] </a>               ! <r>S</r>ubtract <r>M</r>oving <r>A</r>verage

Element-wise Calculations:
  <a href="#120">sv  S  [+-x/^|exp|ln|db]  value </a>             ! <r>S</r>tack-<r>V</r>alue operations
  <a href="#130">ss  A  [+-x/^]            B </a>                 ! <r>S</r>tack-<r>S</r>tack operations

2D-Graphics:
  <a href="#vis">vic(s) Stk  jX j1 j2 j3 ... [keys]</a>           ! <r>Vi</r>sualize <r>C</r>olumns (<r>S</r>pline)
  <a href="#vip">vimp   config  [keys]</a>                        ! --"---"---"---"-- <r>M</r>ultiple Stack <r>P</r>lots
  <a href="#gra">Use of 2D-graphics </a>
  <a href="#tif">tif  File.tif | Config  [Npro=99999] </a>        ! Show <r>.TIF</r>-files/clip

<a href="#jj" >jj  File[.jj] or FIle.java     [/s] [/c] </a>      ! "<r>j</r>ava-<r>J</r>AVA" or <r>simple JAVA</r> Technology
<a href="#jc" >jj "jcmd1; jcmd2; jcmd3 ... "  [/s] [/c] </a>      ! Execute several JAVA commands

<a href="#pik">Most used pik.io methods </a>
<a href="#jc" >Create New pik3d Command, prepare Launcher </a>
________________________________________________________________________________________
<a name='sss'></a>
  <o>command: s3d -"Surface-3D" display Matrix/ Frame and their sequences
</o>
	 <a href='#bb'>Startup, initial parameters</a>
	 <a href='#st'>Stack viewing</a>
	 <a href='#os'>Map,  Axes,  smooth/ blur</a>
	 <a href='#cf'>Configuration</a>
	 <a href='#pp'>Load Stack, Details, Lines</a>
	 <a href='#ss'>Cross Sections</a>
	 <a href='#pal'>Colors</a>

    <o>Coordinate system  and  viewing / lighting  angles</o>

Let's represent the matrix as a rectangle (diagram below).
Axis OX - "Rows" - direction from top to bottom.
Axis OY - "Columns" - direction to the right.
The upward direction above the XOY plane corresponds to the axis: OZ.

Consider a matrix element that is in the <r>i</r>-row, <r>j</r>-column and has the value <r>m[i,j]</r>

	O_____<r>j</r>_______Y        |<r>Z</r>
	|     |     |          |
	|     |     | ---3D--> |  <r>z=m[i,j]</r>
	|     |     |          |   |
	<r>i</r>_____<r>m[i,j]</r>|         O|___|__<r>y=j</r>______
	|           |          /   |  /     / Y
	|           |         /    | /     /
	|___________|       <r>x=i</r>____|/     /
	|                   /            /
	X                  /____________/
	                 X/
The matrix element can be displayed as a point in 3D-space: X - matrix row,
Y - matrix column, Z - element value. The set of such points forms a 3D-surface.

A strict mapping would consist of a set of vertical rectangular bars.
To simplify perception, the surface is smoothed.

On the XOY plane, the element m[i,j ] corresponds to the square:  i-1&lt; x &lt;i,  j-1&lt; y &lt;j
The corresponding surface element can be inclined, convex, concave ...
The display is not entirely accurate, in other words - <r>illustrative</r>.

The <o>observation point</o> is specified by two angles ("Astronomical equatorial system"):
 -"hour angle" - in the plane of the matrix from the OX-axis to the right to the OY-axis
                 in the interval [-180, +180] degrees;
 -"declination"- angle above the plane of the matrix: [-90,90] degrees.

Viewing angles can be changed with the mouse while pressing the button and
in the &lt;Ctrl+C> configuration( will be referenced as <o>^Ñ</o> below ).

The <o>position of the light source</o> is set by lighting angles.
These angles can be changed with the keyboard: &lt;Ctrl> + &lt;arrows> and in the
configuration: ^C.

Angles are measured in degrees and displayed in the window title:  v(a,b),  *(c,d)
where:
       v - "view"  - <o>viewing  angles</o>: a - "hour", b - "declination"
       * - "Light" - <o>lighting angles</o>: c - "hour", d - "declination"

All angles are saved in configuration parameters and can be set at startup.

Lighting angles greatly affect the view of a 3D-scene when they are close to viewing
angles. It is convenient to first select the viewing angles and then set lighting close
to view for fine tuning. This can be done by calling the config: <o>^C</o> and explicitly set.
<a name='bb'></a>
	<o>Startup, initial parameters</o>

> s3d [ Stk [ config | , [ main [ delaySec ]]]]

> s3d                              # a prompt to select a stack will be displayed
> s3d   Stk                        # display Stack: Stk
> s3d   Stk   config               # display Stack: Stk with config. of the 3D-scene
                                     By default config. file has extention: .s3d,
                                     if config. is absent, default config. is used
> s3d   Stk   config       <r>main</r>    # it is possible to run several <r>s3d</r>, all follow up
                                     windows will be synchronized with this,
                                     i.e.  will show  frame number  as main.
> s3d   Stk            <r>,</r>   main    # <r>default config.</r> for main.
> s3d   Stk   config       main   <r>delaySec</r>    # delayed start.

Example( start 4 synchronized s3d-windows ):
  It is useful to start several windows with synchronization from <r>.bat</r> or <r>.cmd</r> script
<f>
  s3d  q      1  <r>main</r>   3    # Stack q    , config=1.s3d, "main" with delay = 3 sec.
  s3d  qAR2   2              # Stack qAR2 , config=2.s3d
  s3d  qmd    3              # Stack qmd  , config=3.s3d
  s3d  qmd15  4              # Stack qmd15, config=4.s3d
</f>
	<o>Shortening and denotation used in Help:
</o>
<r>^Êey  = &lt;Ctrl + Key></r> - simultaneously pressed &lt;Ctrl> and  &lt;Key>
<r>menu> - Context Menu</r> is calling in any place of the s3d-window by pressing <r>Right Mouse</r>
        Almost all commands of the Context Menu can be executed with a key combination
<r>^C    -"Config"</r> - call the Configuration Editor
<a name='st'></a>
	<o>menu>  Stack View</o>

<r>&lt;Left> / &lt;Right></r> - (arrow keys) previous / next  frame;
<r>&lt;Home> / &lt;End></r>   - "initial( 1-st )"/ "End( Last )" stack frame;
<r>&lt;Mouse Wheel></r>    - frame "paging":  "Down"- forward, "Up"- backward;

<r>&lt;Space></r>- Start/ Stop of the Clip( sequential show frame by frame );
<r>^K</r>     - call dialog to define a frame number per second for clip;
<a name='s3F2'></a><r>&lt;F2></r>   - save clip in the multipage .tif-file( prompt to select file );
         Show clip - <a href='#tif'>command: tif </a>.
         To copy window image to clipboard: <r>&lt;Alt + PrtSc></r>.

<r>&lt;Drag></r> - Mouse movement while any button is pressed - rotate 3D-scene :
         angles are showing in the window title: a-"alpha" and b-"beta".
         Right/Left - rotation around a Vertical   Axis - config.param. <r>a</r>[deg.]
         Up / Down  - rotation around a Horizontal Axis - config.param. <r>b</r>[deg.]
<r>^+ / ^-</r>   - increase / decrease by ~10%  3D-scene image - config.param. <r>K</r>
<r>&lt;Shift + H/L></r> - increase / decrease  Vertical size of 3D-scene - config.param. <r>Kh</r>
<r>&lt;Shift + Left| Right| Up| Dn ></r> - shift 3D-scene in the window  - config.param. <r>sx, sy</r>
<a name='os'></a>
	<o>menu>  Map,  Axes,  smooth/ Blur</o>

<r>^D -"Map Down"</r>- Lower/Raise "Map" half the height of the OZ axis.
         Standard Map position is on the minimum value of the OZ axis.

<r>^M -"Map Only"</r>- ON/ OFF TOP view of the matrix/ frame, i.e. standard matrix view:
         rows to the Down, columns to the Right, value has color from "palette".

<r>^+Mouse CLick</r>-"Read Value" pointed by cursor and Write it to the editable window.
         Cursor must point to the "Map"(must be "Map Down" or "Map Only").
         Record contains:  <r>Frame number:  [ row, column ] = value</r>.
         To save text in the editable window: select text and click ^C (copy).
         Paste (^V) it in any convenient Text Editor.
         This functionality may be used to draw <a href="#lin">lines<a> on the "Map".

<r>^A -"Axis"</r>- ON/ OFF Axis display.
<a name='cob'></a>
<r>^O -"Z-axis: min/MAX"</r> - call dialog to define parameters of the vertical Z-axis.
     If the checkbox: "Automatic" is checked - min/MAX are found from the Stack data.
     Clear it by pressing checkbox or <r>&lt;Tab></r> - transfer focus to the next component.
     Sliders can be moved by Mouse or Keyboard: <r>&lt;Left>,&lt;Right>, &lt;Home>,&lt;End></r>.
     While changing value by slider image changes immediately. It gives opportunity
     to do fine adjustment of min/MAX and surface colors.
     value can be entered from the keyboard. To activate new value press &lt;Enter>.
     Image will be updated. If <r>&lt;Esc></r> is pressed, the dialog closes and the frame
     is returned to its original state.

<r>^B - Smoothing("Gaussian Blur")</r> - call Smoothing dialog.
     The parameter is <r>"RADIUS of Gaussian bell"= 2*sigma</r> - is the visual size and
     characteristic smoothing size( fragments > RADIUS remain after filtering ).
     Fine tuning can be done by holding down the key: <r>&lt;Left></r> or <r>&lt;Right></r>.
     At the end of the dialog, you need to click the button: <r>Save</r>. In case of <r>&lt;Esc></r>
     the dialog closes and the frame is returned to its original state.

     <r>DURING DIALOGUES: ^O and ^B  angles can be changed and ^A, ^D, ^M can be used</r>

<r>&lt;Ctrl+F2></r> -Save Stack after ^B,^O (data can be changed by min/MAX cutting and smoothing)
     Prompt to select Stack name. New Stack is saved in <a href='#bin'>binary ###-format F4 BE</a>.

  Example (contains useful tricks for working with <r>^O and ^B</r> ):
  Go to folder: pik3d\demo\bell2, start: _run.cmd, stop at frame 10-14 &lt;space>.
  Press the buttons in sequence:

  <r>^B</r> &lt;Tab> <r>2</r> &lt;Enter> &lt;Enter>
  <r>^O</r> &lt;Tab> &lt;Tab> <r>12</r> &lt;Tab> &lt;Tab> <r>-6</r> &lt;Enter> &lt;Enter>

  From the slider to slider in ^O dialog  you can navigate  using the arrows: UP/DOWN.

  <r>^B</r>
     <r>&lt;arrow RIGHT></r>  press and hold until the picture stops.
     <r>&lt;arrow LEFT> </r>  press and hold until the picture stops.
  <r>&lt;Esc></r>
<a name='cf'></a>
	<o>menu>  Configuration</o>

All parameters: window position, dimensions, angles, colors, enabled functions ...
are stored in structure "CONFIGURATION". In the process of working with s3d, the user
sets these parameters, to get the desired display. A successful configuration can be
temporarily saved to memory ^S and later restore - ^R. Restoring a saved configuration
or the configurationwhat was at the moment of last stack loading.

Viewing, editing and saving configuration in a file is possible after <r>^C</r> -"Config".
An editable text box is displayed with parameters  that differ  from  default values.
The window can be closed without saving changes: <r>&lt;Esc></r>.
When editing, you can change, remove or add  any  valid parameters.  After editing,
the configuration can be installed immediately or saved in a File. If some parameter is
removed from the config window, then  during  installation / loading  it will  receive
default value. It is usful  to set in config.editor  angles  of  view/ lighting.

The new configuration can be :
   button:  <r>Set</r>          - set immediately;
   button:  <r>Save in File</r> - save for later loading.

Config.file can be uploaded in 3 ways:
- <r>at the start of s3d</r> specify the name of the config.file after the stack name;
- <r>^L</r> - loading config file during operation (file selection dialog);
- <r>^N</r> - loading the next stack and config.file ( config.parameter: <r>Next: Stk Cfg</r> );
       It is useful when viewing multiple stacks sequentially  or  one stack in several
       configurations( palettes, angles, blur ... ).

List of config. parameters [default values] - <r>how to set/ call</r> :

  max: [from Stack]  - maximum value of the vertical axis - <r>^O</r> ;
  min: [from Stack]  - minimum value of the vertical axis - <r>^O</r> ;

  x:       [ 612]  - screen x-coordinate of the upper left corner of s3d-window in pix.;
  y:       [ 222]  - screen y-coordinate of the upper left corner of s3d-window in pix.;
  w:       [ 640]  - window width  in pixels ;
  h:       [ 520]  - window height in pixels ;
  sx:      [  0 ]  - horizontal shift of the scene in the window - <r>&lt;Shift + Left/Right></r>;
  sy:      [  0 ]  - vertical   shift of the scene in the window - <r>&lt;Shift + Up/Dn></r> ;

  K:       [  1 ]  - scene  size   increase - <r>^+ / ^-</r> ( +/- ~10% );
  Kh:      [  1 ]  - vertical axis increase - <r>&lt;Shift + H / L></r> (Higher/Lower) ;

  a[deg]:  [ 20 ]  - rotate the scene around   a vertical   axis ("hour" angle );
  b[deg]:  [ 25 ]  - rotate the scene around the horizontal axis ("declination");

  aLight:  [-60 ]  - "hour"angle of the lighting( around   a vert. axis) - <r>^Left/^Right</r>;
  bLight:  [ 30 ]  - declination of the lighting( around the horiz.axis) - <r>^Up / ^Down </r>;

  blur:    [  0 ]  - blur/ smoothing   - <r>^B</r> ;
  Ksec:    [ 10 ]  - Frames per second - <r>^K</r> ;

  Dn:      [  0 ]  - mode: "Map Down"  - <r>^D</r> ;
  Axis:    [  1 ]  - mode: "show Axes" - <r>^A</r> ;
  Map:     [  0 ]  - mode: "Map Only"  - <r>^M</r> ;

  Fon:     R G B   - window background color: def.[ 242 242 242 ] - <r>^9</r> ;
  Text: h  R G B a - Details Font:  size,  Color(R G B),  Opacity(from 0 up to 1) - <r>^8</r> ;
                          default:   14     99  99  99     1 .

  Pal:  [null]     - file "Palette"    - <r>^P</r> - prompt  to select file ;
  Data: [null]     - file "Details"    - <r>^7</r> - prompt  to select file ;
  Line: [null] [0] - file "Lines", 0   - <r>^1</r> - prompt  to select file ;
                                       - <r>^2</r> - ON/ OFF display( default=0 );

  Next: [Stk=current(,)] [Cfg=current] - Next Stack and config. - <r>^N</r> (demo\lines\*.s3d).
<a name='pp'></a>
	<o>menu>   Stack,  Details,  Lines</o>

<r>^F</r> - Load Stack, prompt to select file. Current config. is saved as if <r>^S</r> was pressed.

<r>^N</r> - Load Next Stack/Config. in case current config. contains parameter: Next .

<r>^7</r> - Load <r>"Details"</r>, prompt to select file. Lines of this text file will be displayed
     in top right corner after frame number. The line number in the file corresponds
     to the frame number( see demo\warp\*.s3d, Text.txt ).

<a name='lin'></a>
<r>^1</r> - Load <r>"Lines"</r>, prompt to select file( extention: <r>.lin</r> ).
     The text file contains descriptions of 2D and 3D-lines( can be mixed in one file ).

     The 2D-Line is given by the coordinates of the points that lie on the "Map".
     Points allowed outside the "Map", but only fragments of lines that are on the "Map"
     will be displayed.

     Points 3D-lines contains 3 coordinates( X,Y,Z-Vertical). Only fragments of 3D-lines
     which are inside the axes box will be displayed.

     Line coordinates are specified in <a href='#dat'>text ###-format</a>.
     The number of columns = 2 or 3 corresponds to 2D or 3D-Line.
     The number of rows = the number of the Line points(may be =1 -sphere is displayed).
     Point coordinates are NOT required to be integer( may contain decimal point ).

     The header contains <r>2 additional parameters</r>:
         <r>c=RRGGBB</r> - color  in  hexadecimal  format, default: c=0 - BLACK;
         <r>w=N_pix </r> - Line width/ diameter in pixels, default: w=1 .

Examples:<f>
  ### 3D-Rect.Arc[ 4, 3 ] w=<r>17.5</r> c=99ffcc
    40 100 180
    40 20  500
    20 20  500
    20 100 180

  ### 3D-Sphere[ <r>1,</r> 3 ] C=ff9999 w=60
    27 57 430

  ### 2D-Rectangle[ 5, <r>2</r> ]  ! <r>by default: c=0 w=1</r>
    50   90
    50  107
    12  107
    12   90
    50   90
</f>
<r>^2</r> - ON/ OFF all( 2D,3D ) Lines Display in all frames.

With 2D-lines, you can make additional markup of the "Map", for example:
trajectories, coordinate grids, defining boundaries, zoning ...
3D-lines allow you to display: 3D-markers(e.g. balls), 3D-paths, 3D-trajectories ...
Examples can be viewed in demo\lines\*.lin .
<a name='ss'></a>
	<o>menu>  Cross Sections </o>

View as 2D-graphs all values of i-row, j-column and value[i,j] through all Stack.
<r>^V</r> -ON/ OFF sections, cursor must point ij-element on the "Map".
    Two lines: <r>i-row</r>, <n>j-column</n> will show on the "Map"  and  three new 2D-windows.
    Pressing <r>^V</r> again turns OFF Sections.

Moving Sections by arrow keys :
<r>&lt;Alt + Dn></r>    - go to  <r>Next      row</r>
<r>&lt;Alt + Up></r>    - go to  <r>Previous  row</r>
<n>&lt;Alt + Right></n> - go to  <n>Next     column</n>
<n>&lt;Alt + Left> </n> - go to  <n>Previous column</n>
<a name='pal'></a>
	<o>menu>  Colors</o>

<r>^P -Load Palette"</r>, prompt to select a Palette file( default extantion <r>.pal</r> ).

"Palette"- a Set of Colors which define the color of the element,depending on the value.
Specified by a file in the <a href='#dat'> ###-format </a> and  consists of strings that
associate  a value  and  a color. The minimum corresponds to 0, the maximum --> 1.
Can have any number of intermediate values.

Color of the element is calculated as a linear interpolation between neighboring
table values. Points below the minimum have the color of the minimum.
              Points above the maximum have the color of the maximum.

The color in the palette can be set in 2 ways::
  - <r>Red</r>  <g>Green</g>  <n>Blue</n>  ! three values:  0 <= <r>Red</r>, <g>Green</g>, <n>Blue</n> <=255;
  - <r>RR</r><g>GG</g><n>BB</n>            ! hexadecimal color representation.

Example:  Standard Palette   (definitions are equivalent):
<f>
  ### Stand.Palet [ 6, <r>4</r> ]  !   ### Stand.Pal16 [ 6, <r>2</r> ]
  !Value   R     G     B    !   !Value  RRGGBB
    0     255   255   255   !     0     ffffff
    .2    166   255    77   !     .2    a6ff4d
    .35     0   255   255   !     .35   00ffff
    .57    79   134   236   !     .57   4f86ec
    .8    255     0     0   !     .8    ff0000
    1     255   217   102   !     1     ffd966
</f>
The user can create any number of palettes for different cases.
To get RGB colors, you can use the dialogs: <r>^8 or ^9</r> ( Custom Color.../ RGB| WEB ).

<r>^0 = &lt;Ctrl + Zero ></r> - Load "Standard Palette"

<r>^9 -"Background Color"</r>- opens the dialog to select the color of the 3D-scene.
   The Opacity of the Background is always = 1 ( 100 % ).
   The Background Color can be associated with a specific stack type.
   Default: [ <r>242</r> <g>242</g> <n>242</n> ] = f2f2f2 .

<r>^8 -"Details Color"></r> - calls the dialog to select: Font size, Color, Opacity.
   Default: [ 14  <r>99</r> <g>99</g> <n>99</n>  1 ].

The Palette file  and  selected colors  can be seen/ edited in CONFIGURATION: <r>^C</r> .
They can be saved/ restored:  <r>^S/ ^R</r> .

Examples can be viewed in  demo\lines\*.pal .
Good reviews of the Colors & Palettes :
<a href="https://eos.org/features/visualizing-science-how-color-determines-what-we-see">
   By S. Zeller and D. Rogers, 21 May 2020
   https://eos.org/features/visualizing-science-how-color-determines-what-we-see</a>
<a href="https://www.kennethmoreland.com/color-maps/ColorMapsExpanded.pdf">
   https://www.kennethmoreland.com/color-maps/ColorMapsExpanded.pdf </a>
________________________________________________________________________________________
<a name='fwk'></a>
<o>   PROCESSING AND 3D DISPLAY OF MATRIXES/FRAMES AND THEIR SEQUENCES
</o>
When examining the properties of a time-varying surface, it is convenient to store,
process and display a set of images/ frames/ matrices as a whole.
Such an image sequence is often referred to as a STACK of images.
Displaying of the stack in the "frame by frame" mode is perceived as a video clip.

Framework <o>pik3d</o> offers a data storage/sharing standard and a basic set of commands for
processing and displaying stacks.The methods for reading and writing files in <a href="#dat">###-format</a>
implemented in JAVA are stored in the library: lib\pik.jar and described: <a href="#pik">pik.io methods</a>
Package: kadr.py is implemented for PYTHON language ( stored: ext\###_PYTHON.zip ).
To use the ###-format in the <r>ImageJ</r> graphical editor, a plugin is implemented
( ext\###_Reader_ImageJ.jar, copy to ImageJ\plugins\3D ).

Framework commands are executable(.exe) modules and their set is not fixed.
The launcher technology is used ("launch" - to launch, start). Launcher encapsulates
the starting configuration of the Virtual JAVA Machine (JVM).

The framework contains simple tools for creating <a href="#jc">new command on JAVA</a>.
Additional commands can be implemented in any convenient algorithmic language.

In a simple case, the processing program is a batch script.
From command to command, Stacks are transferred in the form of the <a href="#dat">###-format</a> files
or by means of <r>"pipe"</r>( it can reduce disk usage and increase performance ).

Most of the commands  output the result  to the standard output stream. If commands
chained in to the pipe-line the next command can get data from the standard stream.
To denote standard stream symbol <r>'-'</r> id used. In case of several Stacks in the output:
<r>-(2), -(3)</r> ... Stacks are delimited by: <r>### &lt;eos></r> -"End Of Stack". It looks like:

  cmd1 a b <r>|</r> cmd2 c <r>-</r> <r>|</r> cmd3 d <r>-</r> d(3) <r>-(2)</r> ... <r>|</r> cmdN <r>-</r> p <r>></r> File

The framework can be installed on Windows 7, 10, Linux (tested in Mint 21.1).
Version 19.5.7 is compiled with JAVA-21 using javaFX.
________________________________________________________________________________________
<a name='ins'></a>
				<o>INSTALL pik3d
</o>
    <x> Linux specific steps will appear like this.</x>

 1. Download <r>Open JDK+FX( Full ) v.21</r> installation zip-archive for Windows( x86 64bit ).
    Recommended builds (follow one of the links):

       <a href="https://www.azul.com/downloads/?version=java-21-sts&os=windows&architecture=x86-64-bit&package=jdk-fx#zulu"
>Azul:          JDK  FX  </a>   ! Java <r>21</r>, x86 64-bit, <r>JDK FX !</r>
       <a href="https://axiomjdk.ru/pages/downloads/#/java-21-current"
>BellSoft(RU):  Full JDK </a>

    Since the framework does not require a full JAVA installation ( <r>only unzip</r> ),
    builds can be easily changed. If another version of JAVA is installed on the system,
    the framework with JAVA-21 will not affect it in any way.

 2. Expand JAVA archive, for example to: D:\jdk <x> ~/jdk </x>. There should be a folder:
    D:\jdk\bin  <x> ~/jdk/bin </x>  with  <r>java.exe</r>.  It will be pointed in Launchers config.

 3. Expand the archive: <r>pik3d.zip</r> <x> pik3d_Linux.zip </x> in a folder, for example:
    E:\pik3d &nbsp;&nbsp; <x> ~/pik3d &nbsp; </x>

 4. Create Launchers:
    a. Go to the <r>pik3d\exe</r> <x> ~/pik3d/exe </x> folder ;
    b. Edit config <r>_Launch.cfg</r> :
       - set parameter: <r>jdk/bin:</r>,  in our example:  D:\jdk\bin     <x> ~/jdk/bin  </x>
       - set parameter: <r>lib/jar:</r>,  --:--:--:--:--:  E:\pik3d\lib\* <x> ~/pik3d/lib/* </x>

    c. run <r>_Launch.exe</r> <x> <b>./_Launch</b>  # ALL Launchers are copied to ~/bin !!!</x>

	               <x> in Linux  skip steps  5., 6.  and  go to 7. </x>

 5. If need to "introduce" all Launchers to the antivirus, use  pik3d\exe\<r>_antivir.bat</r>.

 6. Add  path to Launchers  to the <r>Path environment variable</r>
    in our example:  ...;E:\pik3d\exe

 7. Check if the installation is correct:  console> <r>gauss| s3d -</r>
    The "Gauss Bell" should be displayed.
    In case of error:  check  <r>pik3d\exe\_Launch.cfg</r>,  check <r>Path</r>: > echo %Path%
    Possibly, you may need to restart Windows.
    Also, the cause may be a conflict with the antivirus (it will pass after a while).

 8. Several demos are collected in the folder: <r>pik3d\demo</r>,  run:  > _run.cmd <x> ./run  </x>
    If stop viewing by &lt;space>, you can change view angles by moving the pressed Mouse.
    The lighting angles can be changed by: <r>&lt;Ctrl + arrows</r>: Left, Right, Up, Down >.
    It is recommended to press in different sequences:
    <r>&lt;F1></r>, <r>^D</r> -Map Down, <r>^A</r> -Axes, <r>^M</r> -Map</r>, <r>^2</r> -Lines ( <r>^</r> - means pressed &lt;Ctrl> key )
________________________________________________________________________________________
<a name='dat'></a>
		<o>###-format of the data: FRAME, STACK
</o>
The file may contain one or more frames and stacks in text and/or in binary format.
Frame = Matrix in the mathematical sense: rows are counted down, columns - to the right.
Stack - a sequence of frames. Stack ends with the end of file or a line: <r>### &lt;eos></r> -
"End Of Stack". If file A.dat contains several stacks, then A.dat(2) - access to the 2nd
stack, A.dat(3) - to the 3rd, access to the 1st: A.dat or A.dat(1) .

The frame data is preceded by a header: <r>### frame_name [ Row_number, Column_number ]</r>.
The frame name can be any text( may be with spaces or even empty ).
<r>Space</r> after <r>"###"</r> is important !  Matrix size is specified in parentheses: [ ] or ( ).
If the number of columns = 1, it can be omitted.

If need to consider data as <r>Double Presion (8-byte)</r>, parameter <r>T8</r> must be used after <r>[]</r>.
If <r>T8</r> is absent, data are considered as "FLoating Point single precision".

Text or binary data files may contain <r>comments</r>.
Comments start with <r>!</r>  or  a single <r>#</r>  and  continues to the end of the line.
An empty line is also considered a comment.

<r>Any text</r> (even without leading symbols: !|# ) <r>before 1st. ###-header is comment</r> too.
It is good practice to include data description in to the important files.
This can be done by means of text editor.

To see header with commemts  use commad: <a href="#hhh">hhh Stk</a> .

In  <r>Text Format</r>, the header line is followed by data lines. The data is considered as
real numbers, even if they do not contain a decimal point.
<r>+-.0123456789eE</r>  are considered as Data Symbols. The rest can serve as delimiters.

A string can be divided into any number of substrings  with comments between them.
The only limitation is that you cannot break a numeric value.  Example( correct frame ):

 ### test [ 3, 5 ]    ! 3-rows, 5-columns

   11.123, 12.34, 13  # comment
                        -14, 15.56     ! integers can be used:

   21.32 22.54 -23.33 24.765 -.25E+8   # real: with  decimal point
   31 32 3.3e1 340e-7    9e9           !             and/or exponent

<r>Text format</r> may contain <r>repeaters and cycles</r>:
  - repeater: <r>n*v</r> ="n times repeat v", e.g. 99*-.01 -means 99 times repeat value=-.01;
  - cycle:  <r>( b, e [, s])</r> -values: b, b+s, b+2*s ... until b+k*s <=e or e <= b+ks if s<0
    if s is omitted  s=+1 if b&lt;e  or  s=-1 if b>e .
  Examples: (-4,4,2) = {-4,-2,0,2,4};  (4,1) = {4,3,2,1};  (4,-4,-2) = {4,2,0,-2,-4}

> <n>echo</n> ### V[200]: <r>101*99 (98,0)</r> <n>></n> Vect  <n>&</n>  fmt Vect    !create V[200] and print it
                                 ! Used the opportunity <r>to create a stack in one line</r>.
<a name='bin'></a>
<r>Binary Format</r> has an extended header. The matrix size is followed by the binary
data type: <r>I2 | F4 | D8</r> and possibly  a "Byte Order Indicator": <r> LE </r> .

    <r>I2</r> - 2-byte integers, value range from <r>-32768</r> to <r>+32767</r>

    <r>F4</r> - 4-byte real("Floating Point") single precision, <r>~ 7</r> significant digits:
                            <r>1.4e-45</r> < absolute value < <r>3.4e+38</r>

    <r>D8</r> - 8-byte real double precision, <r>~ 15</r> significant digits:
                            <r>4.9e-324</r> < absolute value < <r>1.8e+308</r>

    <r>LE</r> - "Little-Endian" - "LOW bytes first" like in memory.
          Default byte order is <r> "Big-Endian"</r> - this is JAVA Standard !

The binary block starts after byte=0x10=#0A("Line Feed") and does not contain comments!
Comments can be placed only before the header or after the binary block !

The data is output to the binary block sequentially by lines without separators !

Stack may contain both text and binary frames( even with different "Byte Order").

	<r>The amount of Stack Data should not exceed 2 GB !</r>

In files with binary frames, you can add/ change comments and headers using editors
that support binary format ( Notepad++, SlickEdit ... )

The command:<a href="#fmt"> fmt </a>- "format" converts a file to the specified format.
To quickly view stacks in the "pipe", it is convenient to use the command: <a href="#tt">...| tt</a>

JAVA methods to work with data in  ###-format  are given in  <a href="#pik">pik.io methods</a> .
________________________________________________________________________________________
<a name='cmd'></a>
				<o>COMMANDS:
</o>
The command consists of two parts:
 - functional part, implemented and compiled with JAVA, are stored: pik3d\lib\*.jar;
 - launcher - exe module stored in pik3d\exe, that starts JVM and passes parameters.

Launcher actions:
 - starts the JVM in the required configuration:  paths, keys, options ...
 - passes to JVM a link to compiled code;
 - passes arguments to the command;
 - exits after starting the JVM and passing parameters.

All launchers have the same code. The difference is in the start parameters and the link
to the command class. How create new command and prepare launcher:  <a href="#jc">jj, jc, new command</a>.
<r>
   At the first call of the command, a conflict with the antivirus may occur.
   After checking the launcher with the antivirus, this passes.
   You can "introduce" all launchers to antivirus by executing: pik3d\exe\antivir.bat
</r>
Command name = launcher name and is not fixed. You can rename any launcher as you like.

The launcher receives information about the JAVA machine and the path to the libraries
at the time of creation, parameters: <r>jdk/bin, lib/jar</r> of the <r>_Launch.cfg</r> file.
This technology allows you to have several JVM and libraries in the system.

When called without parameters or with the key: <r>/?</r> most commands show their short
description. If the command does not show anything, it must be run with the key: <r>/dbg</r>
- debug mode. Also, some diagnostic messages are visible only in debug mode.

Most commands (with the exception of visual commands) send the result to the standard
input/ output stream. If you do not specify  <r>> File</r>  at the end of the command,
the output will be performed to the console/ screen.

The standard stream allows the use of the <r>"pipe-line"</r> technology.
If the intermediate data is not important, it can be passed from one command to the next
command directly, bypassing the disk file. The "pipe-line" provides this capability.
It may improve disk usage and performance.

If you need to save intermediate data for further processing, any command can save its
output to file. To do this, it is necessary that the command ends with:  <r>@file</r>

   <r>Experience shows that a pipe should not be used when processing large Stacks > 1GB.</r>

To use the pipe-line, the commands are written on one line and separated by <r>'|'</r>.

If the command receives a stack from the pipeline, then this parameter is replaced by <r>-</r>.
A pipe as a file may contain several stacks. N-th stack will be called: <r>-:N</r> .

   stk 70 90 <r>|</r> noise <r>- @F.dat |</r> bell <r>-</r> "20 30 .3 10" <r>|</r> wave <r>-</r> "50 60 .2 15 45" <r>></r> Land

<r>   None of the input files must have a result name (in the example: Land )
   Commands: <o>s3d, hist, lss /vis, vi.., ee, hhh, tif</o>  STOP pipe-line
</r>
It makes sense to save the worked out command sequences as batch scripts.
Stack names and parameters can be considered as call arguments ( %1, %2 ...).

If you need to provide  loops  or  branch points  during batch file execution, use
command: <r>setvar</r>. It allows to read value from Stack elent or keyboard and put this
value to the system environment variable.

   <r>setvar kbd</r>  prompt [ default value ]   !print prompt and read value from Kayboard
   <r>setvar stk</r>  Stack  [i=1 [j=1 [k=1]]]   !get Stack[ i,j,k ] element

Usage differs in Linux and Windows. Scripts with the same functionality are given:

<div style='background:#333333; color:#00FF00;'># Linux example(~/bin/stkelm): $ stkelm Stk&nbsp;
  s=$1
  if [ -z "$1" ];then
    s=`<r>setvar kbd</r> "input Stk.name" q`
  fi

  while [ true ];do
    i=`<r>setvar kbd</r> "input i" 3`
    j=`<r>setvar kbd</r> "input j" 7`
    k=`<r>setvar kbd</r> "input k(999=exit)" 999`

    if [ $k = 999 ];then
      exit; fi

    v=`<r>setvar stk</r> $s $i $j $k`
    echo $s[ $i, $j, $k ] = $v; echo
  done
</div>
Windows: <r>setvar</r> is used in .cmd-scripts to set <r>VAR</r>iable :

  <r>call varkbd VAR</r> prompt [default]       !get value from the keyboard
  <r>call varstk VAR</r> Stk [i=1 [j=1[ k=1]]]  !get value of the Stk[ i,j,k ] element

> <r>call varkbd VVV</r> "input value" -999     !input var: <r>VVV</r> from the keyboard
> echo %VVV%                             !print var: <r>VVV</r>
> <r>call varstk VVV</r>  Stk  5 4              !read value from Stack: <r>VVV</r> = Stk[5,4]
> echo %VVV%

Example( pik3d\exe\stkelm.cmd - get element: Stk[i,j,k] ):<f>
@echo OFF
::          get Stk Element, %1 = Stack Name
IF [%1]==[] goto end

:cycle
call varkbd <r>i</r> "input i" 3
call varkbd <r>j</r> "input j" 7
call varkbd <r>k</r> "input k(999=exit)" 999

<r>IF</r> %<r>k</r>% equ 999 goto end

call varstk <r>elm</r> %1 %<r>i</r>% %<r>j</r>% %<r>k</r>%
echo %1[ %<r>i</r>%, %<r>j</r>%, %<r>k</r>%] = %<r>elm</r>%
echo.
goto cycle

:end</f>
> stk 5 9 3| noise - 100 > dat  & fmt dat 9*6.0f   !prepare  Stack: dat  for the test
> stkelm dat                                       !run script
This script can be used for any Stack in text or binary format.
________________________________________________________________________________________

<a name='40'></a>
	<o>stk ii [jj=1 [kk=1]] [v=&lt;value>] [D8]  > File
</o>
Create a new STACK in <a href='#dat'>###-format</a>, where:
    <r>ii</r> - number of rows;
    <r>jj</r> - number of columns;
    <r>kk</r> - number of frames;
    <r>v=&lt;value></r> - value to fill all stack elements (default 0), text: <r>"v="</r> is mandatory;
    <r>D8</r> - optional parameter if need a Stack of Double Precision, default: F4.

Examples:
> stk 22 33        > b2233     !1 frame: 22 rows 33 columns  , F4, filled with 0
> stk 25 46  v=-1  > b2233_1   !1 frame: 25 rows 46 columns  , F4, filled -1
> stk 22 33 50 d8  > d50       !stack of 50 frames: [ 22,33 ], D8, filled 0
> stk 42 65  v=.2  > s99_02    !stack of 99 frames: [ 42,65 ], F4, filled 0.2
> stk 999 v=-1 d8  > column    !column[999,1] = column[999]  , D8, filled with -1
________________________________________________________________________________________
<a name='fmt'></a>
	<o>fmt  Stk  [ I2 | F4 | D8 | n*w.pS ]  [LE]  > File
</o>
Convert Stack to another format: I2|F4|D8  or  custom text format: n*w.pS
A Stack can be a folder( arranging files alphabetically ).

Accepted formats:
    <r>I2</r> - binary:  short integer    2 bytes
    <r>F4</r> - binary:  floating point   4 bytes
    <r>D8</r> - binary:  double precision 8 bytes
    <r>n*w.pS</r> - custom text format, where:
             <r>n</r>  -"number" of values in row
             '*'- mandatory symbol
             <r>w</r>  -"width" of one value
             '.'- mandatory symbol
             <r>p</r>  - number of decimal places, maybe 0
             <r>S  = f | e | g</r> - "Symbol" of format
                  <r>f</r> - floating point without exponent( if p=0 - integer )
                  <r>e</r> - exponent is present( scientific notation )
                  <r>g</r> - if possible - floating, if not - scientific
e.g.
    20*4.0f  - 20 integers, each has width=4
    10*10.5f - 10 floating, width=10, 5 decimal places
    5*20.11g - 5 values, width=20, 11 decimal places, e or f format

    <r>LE</r> - "Little-Endian"="Low Bytes First" - byte order for binary formats.

         <r>! Standard for JAVA  and  default is "Big-Endian" !</r>

If format is not specified, the standard text format is assumed.
If text format of double precision has more then 7 significant digits,
it must be marked 'T8' after [] -matrix size. This is done automatically by fmt .

Lower case may be used in the format specification:  <r>i2 | f4 | d8, le</r> .

  e.g.
> fmt stk                     #output  Stk to the screen in standard text format
> fmt q d8           > qd8    #convert Stk: q  to  qd8: D8
> fmt IntVal i2 le   > qi2le  #convert Stk: IntVal  to  qi2le I2 LE
> ...| fmt - 10*11.5g         #"pipe" to console in custom form == ...| tt 10*11.5g

If "pipe" is printed to the screen, it is recommeded  to use  <r>...|tt</r>  (see below)
________________________________________________________________________________________
<a name='tt'></a>
  <o>...| tt   [ n*w.pS ]      # Print Stacks from "pipe" - quick view
</o>
  ...| tt                         # print ALL "pipe" stacks in standard text format
  ...| tt        custom_format    # ---:---:---:---  custom_format, see help: > fmt
  ...| tt  -:n                    # print n-stack in the "pipe"( std. text format )
  ...| tt  -:n   custom_format    # ---:---:---:---  custom_format

This is especially convenient if "pipe" contains several stacks - they ALL will be
displayed.  While the  command: fmt  shows  ONLY ONE Stack  from "pipe".
Formats  are described  in the <a href="#fmt"> fmt </a> command.
  e.g.
> ...| tt                         # ALL Stacks from "pipe" in standard Text format
> stk 7 9| noise -| tt 10*10.4g   # shows random matrix [7,9] in useful format
> ...| tt  11*11.4g  > F11        # save ALL Stack as Text to the file: F11
> ...| tt -:2  10*11.5g           # print only second stack from "pipe"

> stk 8 8| noise -| eig -| tt 8*11.4g  # Eigen Values & Vectors of random matrix 8x8
________________________________________________________________________________________
<a name='ren'></a><o>
	renam  Stk  name  [ N=1 ]  > File   ! Rename Frames
</o>
Create new Stack which has old data Frames with new consecutive names:
name_&lt;N>, name_&lt;N+1>, name_&lt;N+2> ...

	<r>!!! INPUT STACK CANNOT BE A FOLDER !!!</r>

> renam  q  data    > qDAT    !in qDAT frames: data_1 , data_2   ...
> renam  q  neg -2  > q_50    !in q_50 frames: neg_-2 , neg_-1 , neg_0 , neg_1 ...
________________________________________________________________________________________
<a name='hhh'></a><o>
	hhh  Stk    # print to std.ERR Stk-Header & comments
</o>
Fast look at the Stack parameters( 1st. Frame header ):  name, size, format, byte order.
On the std.ERR (usually console) print 1st. header of the Stack and  comments before it.
All text, even without leading symbols: #|! , are comments( since no header yet ).

	<r>  It is useful to describe the data before the 1st. header</r>
Examples:
  1. > gauss | hhh -    !print description of Gauss Blur Filter & header
  2. In folder:  pik3d\demo\bell2  run command:> <f>gen3d bell2.gen > bell2</f>
  3. gen3d  creates 3d-Stack  with comments before data( inserts generation config ).
  4. Look at the header and comments:> hhh bell2

Result looks like:<f>
  gen3d: 2023.08.04 03:06:33         </f>// generation time<f>

  base: 80 120 40                    </f>// gen.config: bell2.gen<f>
  noise: 120
  blur:  8

  movi:
  gnoise: 8
    bell:
          h: 130
          r: 12
          x: (1 9)(20 55)(40 71 )
          y: (1 9)(20 60)(40 111)
    bell:
          h: 130
          r: 12
          x: (1 71 )(20 25)(40 9)
          y: (1 111)(20 60)(40 9)

  ### bell2.gen_1 [ 80, 120 ] F4 BE  </f>// 1st. Frame header
________________________________________________________________________________________
<a name='eeh'></a><o>
     command:  ee  [text]   # print to std.ERR current time & text
</o>
Ñan be used to mark execution steps and timing of a script or pipe-line.
Since this command stop pipe-line, it is recommended to use it as 1st. or the last when
joining commands to a pipe-line. And use symbol <r>'&'</r> after and before it !
  e.g.
> ee _______start <r>&</r> get Stk[#3,#5] <r>|</r> tt <r>&</r> ee _______ End.    !looks like:
<f>  02:44:12.715  _______start

  ### p1 [ 3, 5 ]
   337           326           310           294           283
   339           334           318           295           273
   336           321           328           312           292
  02:44:13.330  _______ End.</f>
________________________________________________________________________________________
<a name='60'></a>
	<o>gauss  [ R=8 [ width=3 ]]  > File
</o>
Create the normalized Gaussian filter of the given  Radius  and  aperture( width ).
It can be considered as  example of a filter  for the command:<a href="#190"> filtr</a>,  but use of
the command:<a href="#180"> blur</a> is more convenient. This is the shortest way to create <a href="#dat">###-file</a>.

This filter performs <r>"BLUR / SMOOTHING"</r> image without displacement - "Gauss Blur".
Normalized means:  the sum of all filter values = 1.

For the Gaussian distribution, it is convenient to assume <r>Radius = 2*sigma</r>.
This is the visually perceived radius of the "Gaussian Bell" and  the characteristic
size of "SMOOTHING".

	<r>After smoothing, only details that exceed the Radius remain</r>

Filter aperture or width (2nd parameter) measured in Radii, default = 3*R = 6*sigma .
On "Center Point Demand" width rounds UP to nearest odd number: 3*8=24 --> 25 .

> gauss 3.5 2.8 > filtr    !3.5*2.8 = 9.8 --> 11,   size:  11 x 11 points.
________________________________________________________________________________________
<a name='bel'></a>
    <o>bell  S  "x y h r"  ["x1 y1 h1 r1"  ["x2 y2 h2 r2"]...]  > File
</o>
The command only affects the first frame of the stack and ouputs stack with one frame.
Add to specified location: <r>x, y</r> "Gaussian Bell" of given height and radius:  <r>h, r</r>
The x,y parameters can be &lt;=0, i.e. the central point is outside the frame.
If h&lt;0 - "hole", r>0 is always !

"Bells" parameters <r>specified in quotes!</r> No default values!
You can set <r>several</r> "Bells" in one command.
The radius of the "Bell" = 2*sigma ( in terms of the Gaussian function ).

> stk 17 33 | <r>bell - "9 11 9 9" "9 22 -9 9"</r> | s3d -
________________________________________________________________________________________
<a name='wav'></a>
    <o>wave  S  "x y h r a" ["x1 y1 h1 r1 a1" ["x2 y2 h2 r2 a2"]...]  > File
</o>
The command only affects the first frame of the stack and ouputs stack with one frame.
Add a straight "Wave" of Gauss to the frame:  width = 2*r = 4*sigma,  height = h.
Position of the "Wave": x,y - coordinates of the point through which the "Wave" passes.
a - the angle is measured in degrees from the vertical axis ANTI-CLOCKWISE, i.e.
if we look at the frame as a matrix, then the direction down ("at 6 o'clock")=0 degrees,
to the right ("at 3 o'clock")=90 degrees, to the right up ("at 1 o'clock")= 90+66 = 156.

The x,y parameters can be &lt;=0, i.e. the point is outside the frame,
h&lt;0 - "hole",  r>0 is always!  "Waves" parameters  <r>set in quotes!</r>  No default values!
You can specify <r>several</r> "Waves" in one command.

> stk 23 33 | <r>wave - "12 17 -9 7 60" "12 17 11 9 -45"</r> | s3d -
________________________________________________________________________________________
<a name='gel'></a>
    <o>gen3d  config  > File   !"<r>GEN</r>nerator <r>3D</r>-stack"
</o>
Often, for debugging and demonstration purposes, it is necessary to create test stacks.
This task is solved by the command:  <r>gen3d</r> - creat a stack with fixed and moving
figures. The <r>config</r> file defines stack parameters, shapes  and  their movement,
noise and smoothing.

Config file may contain:
  - empty lines and comments( line starts with # or ! );
  - section names;
  - names of figures and their parameters.

Each section, figure, parameter starts with a name that ends with <r>:</r>.

Config file Consists of 2 sections:  <r>base:</r> and <r>movi:</r>.

<r>base:</r> frame is generated once and is used in all <r>movi</r> frames as a base.
Can be empty, can contain  any number of fixed figures, noise, blur, offset

The <r>base:</r> section defines:
  - stack sizes: <r>ii jj [kk=1]</r>,  where: ii,jj,kk - number of lines/ columns/ frames.
      or
  - <r>@File</r> - reference to the existing stack.

If the base stack( <r>@File</r>) is specified, then for each frame of this stack
the <r>base:</r>  and  the <r>movi:</r>  frames  will be added.

Parameter value is a real number ( possibly &lt; 0 ).
If the parameter is not set, the default value is used.

		<o>Optional sections parameters:</o>

  <r>add: V</r>      ! V - offset is added to all matrix/frame elements;
  <r>noise: A</r>    ! A - amplitude of UNIFORM noise: [-A, A ];
  <r>gnoise: R</r>   ! Gaussian noise, R=2*sigma ;
  <r>blur: R</r>     ! Gaussian blur(smoothing): R=2*sigma .

The default value of this parameters = 0, this means: parameter is inactive.

Base frame  and  movie frame  can have different  noise and blur  parameters.
Movi parameters are applied  at the end  of the frame construction !


The section with <r>changing</r> parameters and shapes starts with the line: <r>movi:</r>
The value of  <r>any parameter</r> ( including: add, noise, blur ) can:

- <r>be a constant</r> ;
- <r>depend on time</r>( frame number k ). There are two ways to set this dependency:

  - Polynom <r>Pn(k)</r> of degree <r>n&lt;=3</r>, passes through the set of points:
    <r>param:  (k1,v1) (k2,v2) ...</r>,  where: <r>vi</r> - param.value in frame <r>ki, i=1,2...n+1</r>;

  - Parameter value for each frame from the file:  <r>param:  @File</r>
    If the number of lines &lt; kk, missing values = last available.
    Exception:  <r>dxy:</r> - there is a loop (repetition from the first values).

Examples:
  r:  7                                             ! Constant
  y:  (1,2)          (25,76)          (50,10)       ! dependence on t as P2(k)
! y in 1-frame =2, in 25-frame =76, in 50-frame =10

  x: (1 26) (17,6) (35 40) (50,34)                  ! change of x(k):    P3(k)

  h: @Heights.dat                                   ! values in file: Heights.dat
!     ### hhh[ N ]                                  ! header
!       1  .95  .8  .6  ...                         ! N values

In current version, 3 types/ names of figures are possible:

  - <r>bell:</r> - Bell / hill;
  - <r>poly:</r> - Closed Polygon( the last point connects to the first one);
  - <r>wave:</r> - Wave.

The figure is specified by the name and subsequent lines with parameters.
The order of the parameters is not fixed.

		<o>Standard Figure Paramaters:</o>

The position of the figures is set by the coordinates of the <r>"Figure CENTER"</r>( FC ): X, Y
  <r>x: X</r> - coordinate along the 0X-axis - "down the rows of matrix";
  <r>y: Y</r> - coordinate along the 0Y-axis - "to the right along the columns".

You can set the movement of the figure around the point (X,Y). Real coordinates:
x = X + <r>dxy[k,0]</r>
y = Y + <r>dxy[k,1]</r>  where: increments for k-frame are taken from the k-line of the File:

  <r>dxy: @File [Mx=1 [My=Mx]]</r> - <a href="#dat">###-format</a> File contains dx, dy for the frames
                              ### dxy[ N, 2 ] ! preferably N=kk - the number of frames
                                dx1 dy1
                                dx2 dy2 ...

If the movement is cyclic, it is enough to specify only one cycle.
If parameters <r>Mx, My -"Multipliers"</r> are given, then real  dx = Mx*dx, dy = My*dy.
If <r>only Mx</r> is given, then <r>My = Mx</r> .

Example:
  dxy: @cirñ1 <r>7</r>  ! if file circ1 defines circle R=1, then movement will be with <r>R=7</r>

More complicated movement may be defined by time dependent  <r>X(k), Y(k)</r>  with  <r>dxy:</r>

The FC for the <r>"bell"</r> is the maximum/ minimum point - the center of symmetry.
For the <r>"poly:"</r>-closed polygon  and  the<r> "wave:"</r> - FC is the point, relative to which
polygon/ wave coordinates are set. It is convenient to set the line relative to the
point (0,0), which will have coordinates <r>x:X, y:Y</r> when displayed.
The coordinates of the FC  and  real figure coordinates  can go beyond the frame.

  <r>h: H</r> - the height of the shape.

  <r>r: R</r> - "apparent Radius/half-width" of figure, for Gaussian exponent R = 2*sigma.

  <r>form: exp</r> or <r>cos</r> - sets the shape in vertical section of the figure:
  - <r>exp</r> - H(r) = exp( -2*(r/R)^2 )     - calculated from 0 to R*2;
  - <r>cos</r> - H(r) = .5*( 1+cos( pi*r/R))  - calculated from 0 to R .
          The default: <r>form: exp</r> .
          If you set   <r>form: cos</r>  and  R = 1.25*Rexp, then the forms are pretty close.

  <r>a: A</r>  -"Angle"- rotation angle in degrees around the vertical axis through the FC
          A > 0 - counterclockwise, A &lt; 0 - clockwise.

  <r>m: M</r>  -"Multiplier", if set, then all <r>polygon/wave</r> coordinates are multiplied by <r>M</r> .
          The FC does not change. There is an increase / decrease of the figure.

  <r>k01: (k1,k2) ...</r> - "turn ON/ OFF" the figure. If parameter: k01 is not set -
                     figure is always visible.
Example:
  k01: (4,9) (12,19) (21,39)   ! figure is visible on the frames:  4..9, 12..19, 21..39
                               ! on the rest frames it is absent.

		<o>Nonstandard Figure Paramaters:</o>
<r>bell:</r>
  <r>ry: Ry</r> - radius in the Y direction. If specified, then the section is an ELLIPSE.
           When calculating  H(r) = H(x,y),  where: r = sqrt( (x/R)^2 + (y/Ry)^2 )
           If we specify  r != ry , we get a "flattened" Bell.

<r>poly:</r> - closed polygon, all points inside have height <r>h: H</r>
  <r>p[]: (x1,y1) (x2,y2)...</r> - array of polygon coordinates relative to FC,
                            possibly multiple text lines
        or
  <r>p[]: @File</r> - coordinates are stored in File <a href="#dat">###-format</a>:
               ### polygon[ N, <r>2</r> ]  ! N-point polygon
                   x1 y1 x2 y2 ... xN yN

<r>wave:</r> - wave, if <r>xyh:</r> is not set - the wave line is straight along the OX axis.
        The section shape is given by: <r>h: H</r>, <r>r: R</r> and <r>form: exp/cos</r>.
        <r>a: A</r> - rotates the wave.

  <r>xyh: @File</r> - line and height coordinates in File <a href="#dat">###-format</a>:
               ### wave[ N, <r>3</r> ]  ! N-point line with <r>HEIGHTS !!!</r>
                   x1 y1 <r>h1</r> x2 y2 <r>h2</r> ... xN yN <r>hN</r>
               Wave section height = H * <r>hi</r> (possibly: <r>hi&lt;0</r> ).

The stack is generated in the format: <a href="#dat">F4 BE</a> .
Date and config.file  are placed  at the beginning of the stack as a comment.

Config.file example:  <r>spiral2.cfg</r>  "Two rotating spirals":
<f>
base: 160 160,20       # it is enough 10 frames
movi:
blur: 5

  wave:
    x: 79.5
    y: 79.5
    xyh: @<r>spiral</r>
    a: (1 0)(2 18)     # turning speed 18 degrees/ frame
    r: 5
    h: 2
    form: cos

  wave:
    x: 79.5
    y: 79.5
    xyh: @<r>spiral</r>
    a: (1 180)(2 198)  # the second spiral is rotated 180 degrees
    r: 5
    h: 2
    form: cos
</f>
File:  <r>spiral</r>  is received by the program:  pik3d\usr\Spiral.java
it can be run(<a href='#jj'> jj File.java</a>)> jj Spiral.java > <r>spiral</r>
<f>
package usr;
public class Spiral {
  static public void main( String[] a ) {
    int i, n=20, nn=n*3;
    double f=0, df=-2*Math.PI/n, r=10, dr=2, h=1, dh=-.015;

    System.out.println("### xyh [ "+nn+", 3 ]");
    for(i=0; i&lt;nn; i++) {
      System.out.println( r*Math.cos( f )+" \t"+r*Math.sin( f )+" \t"+h );
      r+=dr; f+=df; h+=dh;
    }
  }
}</f>
To see result >  <r>gen3d spiral2.cfg | s3d -</r>   !do not forget to press &lt;space>
________________________________________________________________________________________
<a name='140'></a>
	<o>noise  Stk  [A=.1]  > File
</o>
Adds to Stack elements "Uniform Noise", it has a uniform distribution
function on the interval: [ -A, A ],  default A = 0.1
  e.g.
> stk 1000000 | noise - | hist -    !get UNIFORM on [-.1,.1 ] NOISE histogram
________________________________________________________________________________________
<a name='145'></a>
	<o>gnoise  Stk  [R=.1]  > File
</o>
Adds to Stack elements "Gaussian Noise":  mean=0,  R=2*sigma .
  e.g.
> stk 1000000| gnoise - 2| hist -   !get G.noise histogram( R=2, sigma=1 )
________________________________________________________________________________________
<a name='his'></a>
  <o>hist Stk [Fr=1 [Nint=100]] [/add=File]   ! Histogram of the frame data
</o>
where:  <r>Nint</r> - the Number of Intervals in the range [min,max], default: 100.
	Don't make it too big - the spread of the histogram values increases.
	Valid range for Nint is from 4 to 2000 .

if key <r>/add=File</r> is present, Additional Graphics from File[.add] is added
to the chart( see <a href='#gra'>Use of 2D-graphics</a> ).

In the opened Histogram window, you can change the Number of Intervals:
in the upper right corner <r>enter a new value and press &lt;Enter></r>.

<r>&lt;F3>    </r> - Save the Histogram to a file.
<r>&lt;Ctrl+G></r> - ON/ OFF an estimate of the Normal/ Gaussian distribution:

  1. Find min, max values in the frame.
  2. The width of the interval = ( max-min )/Nint .
  3. All frame values are sorted by intervals.
     The number of values that fell into the interval = the value of the Histogram.
  4. "Coordinate descent" is used to find an estimate of the Gaussian distribution.
  5. Display: estimation, Number of intervals, mean, +/-sigma, 3*sigma .

Narrow distribution peaks can be conveniently examined using<a href="#gra"> ZOOM </a>.

Example: get histogram of the GAUSSIAN NOISE [R=2*sigma=2, sigma=1]
> stk 1000000 | gnoise - 2 | hist -    ! do not forget to press <r>^G</r>
________________________________________________________________________________________
<a name='djk'></a>
	<o>STACK PART:  Stk[ di, dj, dk ]  - "Slice",  index subsets
</o>
	<r>ATTENTION:  pik3d Slice  is different from  PYTHON Slice !!!</r>

Stack part description = description of subsets of indexes: di, dj, dk

Subset descriptions are separated by commas.
If the description contains a comma, it must be enclosed in parentheses.
If subset is <r>omitted</r> (examples: Stk[,dj,dk], Stk[di,,dk], Stk[,,dk] ) - <r>index = 1</r>.
Parentheses and spaces can be used to improve readability.

	<o>Rules for describing a subset of indices:</o>

Ñonsider the rules on the example of columns(1,2,3...N), where: N-the last column.
Positive number p is used in description, i.e.  p=1,2,3...N   and  -p=-1,-2,-3 ...

1. Index counting <r>starts from 1</r> !!!  i.e. real indices are 1,2,3 ... N.

2. Index <r>0</r> denotes <r>Last index</r> ( in our case N ).

3. Index <r>-p</r> denotes <r>N-p</r> index.

4. Index subset can contain lists and cycles in any quantity (separated by commas).
   - <r>list</r> = sequence of indices: <r>(j1,j2 ...)</r>,  possibly one.
   - <r>cycle</r>  contains symbol <r>':'</r> or <r>'#'='q'</r> - in <r>q</r>uantity.

5. Cycle (general case):  <r>b: e: s</r>
   <r>b, e</r> - the beginning and the end of the cycle  <r>INCLUSIVE !!!</r>
   <r>s</r>    -"Step" - sequence and order of sampling.

   b &lt; e and s= p -->  for( j=b; j&lt;=e; j+=p )   !from smallest to largest: <r>s>0</r>
   b > e and s= p -->  for( j=e; j&lt;=b; j+=p )   ! ---:---:---:---:---:---:---
   b &lt; e and s=-p -->  for( j=e; j>=b; j-=p )   !from largest to smallest: <r>s&lt;0</r>
   b > e and s=-p -->  for( j=b; j>=e; j-=p )   ! ---:---:---:---:---:---:---

6. Cycle:  omitted/ default  values :

   b - value <r>to the left  of the first  ':'</r>  default = <r>1</r>
   e - value <r>to the right of the first  ':'</r>  ---:--- = <r>0 --> N !!!</r>
   s - value <r>to the right of the second ':'</r>  ---:--- = <r>1</r>, examples:

   :e - all columns from 1 to e inclusive;
   :e:s - from 1 to e , sequence and order are determined by step: s

   : =:: =1:N:1  --> for( j=1; j&lt;=N; j++ ) - ALL
   ::-1 = 1:N:-1 --> for( j=N; j>=1; j-- ) - ALL in reverse order

7. To describe the quantity of rows| columns| frames, the symbol <r>#</r> is used, which can be
   replaced with the symbol <r>q -"quantity"</r>.

   <r>b # p = b#p</r> = b: b+p-1,  i.e. <r>#p = the quantity</r> of elements starting from b, p>0 !!!
   If b is omited,  <r>b=1</r>,    e.g. #5 = 1#5 = 1<r>q</r>5 = <r>q</r>5 = 1:5

8. <r>b =-p</r> - means: b = N-p,  e.g. -2: =( N-2, N-1, N ),  <r>b=0</r>  e.g. <r>0: = 0# = 0  = N</r>
   <r>e =-p</r> - means: e = N-p,  e.g. :-2 =( 1,2 ... N-2 ),  <r>e=0</r>  e.g. <r>:0 = :</r> =(1,2...N)

Examples:
> Stk[ :, :, <r>0</r> ]                        !<r>Last</r> frame of the stack
> Stk[ :, :, ::-1 ]                     !stack  with reverse frame order
> Stk[ ::-1, :, : ]                     !frames with reverse order of rows
> Stk[ :, <r>(2,3,(4:7:-1),9)</r>, : ]         !ALL rows and frames, columns: <r>2,3,7,6,5,4,9</r>
> Stk[ :, :, -3:  ]                     !frames: K-3, K-2, K-1, K  !K=number of frames
> Stk[ :, :, 0:-3:-1 ]                  !frames: K, K-1, K-2, K-3  =  [:,:,-3::-1]
> Stk[ 2#3,4#3,#3] = Stk[2:4,4:6,1:3]   !cube: 3x3x3 = Stk[ 2<r>q</r>3,4<r>q</r>3,<r>q</r>3 ]
________________________________________________________________________________________
<a name='get'></a>
	<o>get  Stk[ di,dj,dk ]  > File
</o>
Get the Stk part according to <a href="#djk">index subsets</a>.
Examples:
> get Stk[:,<r>2#3</r>, 7]     !matrix consisting of 3 columns( <r>2,3,4</r> ) of the 7-frame
> get Stk[:,:,::-1]     !frames in reverse order
> get Stk[:,:,:: 3]     !every 3rd frame

obtaining sections:
> get Stk[2#9, 7, #5]   !9x5 section on 7-column
> get Stk  [3, :, : ]   !full section on 3-line = sec Stk i=3 (see below: <a href="#sec">sec</a>)

In case of sections: Stk[ i, dj,dk], Stk[di, j, dk] - <a href="#dim">dim32</a> command is useful to convert
several frames( dk ) to 2d-matrix( [dj,dk], [di,dk] ).
________________________________________________________________________________________
<a name='put'></a>
<o>    put  Stk[ di,dj,dk ]  Part  [<r>s</r>=0 [<r>p</r>=1]]  > File  !put Part of Stack
</o>
This is a group of commands to change part: Stk[di,dj,dk] and output the whole changed
Stack.  Action  depends  on  the  <r>s, p    !       S[] = s*S[] + p*P</r>
  default:  s=0, p=1  > put S[] P         ! put:  S[] =           P
            s=1, p=1  > put S[] P 1       ! add:  S[] =   S[] +   P
            s=1, p=-1 > put S[] P 1 -1    ! sub:  S[] =   S[] -1* P
                                           ...
Command:  <r>put S[] P</r>  is reverse to command:  <r>get S[] > P</r>, check this:

> stk 6 9 3 | noise - 1000 <r>@A</r>| tt 9*5.0f  ! creat stack A[6,9,3] with random numbers
> get  A[::2, 2#7, 2:]     <r>@P</r>| tt 9*5.0f  ! get  part A[::2, 2#7, 2:] --> P[3,7,2]
> stk  3 7 2| put A[::2,2#7,2:] - > A0    ! fill part A[::2, 2#7, 2:] with 0 from pipe
> fmt  A0  9*5.0f                         ! view A0
> put  A0[::2, 2#7, 2:]   P  | dif - A    ! put saved "Part" P to A0  --> dif: 0,0,0
________________________________________________________________________________________
<a name='dim'></a>
	<o>dim32  Stk  > File   !"<r>DIM</r>ension: <r>3d -> 2d</r>"
</o>
If one of the 3D-Stack sizes = <r>1</r>, the stack is converted to a 2d-matrix.
This situation occurs when getting a section of the stack with the command <a href="#get">get </a>:

  section along <r>i-row   </r>:   > get Stk [ <r>i</r>, dj, dk ]
  section along <r>j-column</r>:   > get Stk [ di, <r>j</r>, dk ],  e.g.

> stk 8 9 7 | noise - > A   # prepare stack: A
> get A[ <r>3</r>,  :, : ] | tt    # section consists of <r>7</r> frames[ <r>1</r>, 9 ]
> get A[ :,  <r>5</r>, : ] | tt    # section consists of <r>7</r> frames[ 8, <r>1</r> ]
> get A[ #5, <r>3</r>, #4] | tt    # section consists of <r>4</r> frames[ 5, <r>1</r> ]

The same using <r>dim32</r>:
> get A[ 3,  :, : ] | dim32 - | tt    # <r>1</r> frame [ 9, 7 ]
> get A[ :,  5, : ] | dim32 - | tt    # <r>1</r> frame [ 8, 7 ]
> get A[ #5, 3, #4] | dim32 - | tt    # <r>1</r> frame [ 5, 4 ]
________________________________________________________________________________________
<a name='csv'></a>
      <o>csv  CSV-file  [di,dj]  [D8]  > ###-file
</o>
Read  <r>"Comma-Separated Values"-file</r>  and  convert to the  <a href="#dat">binary ###-file</a>

  [di,dj] - <a href="#djk">index subsets</a>  of Lines and Columns
            if absent, it means the entire CVS-file

  D8      - output file as Double(D8), default: Float(F4)

  <r>ATTENTION:  ONLY INCREASING  index sequences  are  ALLOWED
              Literal and Error Values are replaced with <n>4e-44</n> !!!</r>
Examples:
  csv  float.csv        >  flodat       !float.csv --> flodat  (entire file)
  csv  data.csv  D8     >  dat8         !data.csv  --> dat8( Double,8-bytes real)
  csv  big.csv [3:,:]   >  big4         !big.csv from 3-line to the end, all col.
  csv  big.csv [500#200, (2,3,5,7)] d8 > d501   !lin.: 500-699, col.: 2,3,5,7

  csv  graph.csv [:,:4] | vic - 1 2 3 4 !read and display col.: 2,3,4 as function of 1

Input file can be taken <r>from the WEB</r>:
  csv https://perso.telecom-paristech.fr/eagan/class/igr204/data/cereal.csv [3:,4:] |tt

It is also possible to read a <r>compressed(.zip ) CSV-file</r> (locally, not WEB):
  csv cereal.zip [3:,4:] |tt
________________________________________________________________________________________
<a name='mul'></a>
    <o>mul  A B [ C D ...]  > File   ! Matrix <r>Mul</r>tiplication
</o>
    <r>!!!  Only 1st frames of the Stacks are used  !!!</r>

The number of columns A must be equal to the number of rows B,
the number of columns B must be equal to the number of rows C ...
Result dimensions: <Number of Rows A> x <Columns Number of the Last Matrix>

It is possible to use Part of Matrix according to <a href="#djk">index subsets</a>, e.g.
> mul  A[#5,2:9]  B[3:#8,4#6]  C[2:7,#3]   ! result 5x3.

In addition, transposition of Matrix or Part may be done directly in the command.
To do this, the <r>#</r> sign must be put after the Matrix or Part,
  e.g.
> stk  33 33 | noise - 10       > A            ! prepare matrix A with random values
> mul  <r>A#</r>  A                    > AtA          ! <r>At</r> * A - used in decomposition
> mul  A[#5,2:9]  <r>A[4q6,3:q8]#</r>  A[2:7,q3] |tt  ! transpose part, print result 5x3
________________________________________________________________________________________
<a name='dif'></a>
    <o>dif  A 0 |  A 1 |  A B    !"<r>dif</r>ference" of the Stacks
</o>
Two stacks are compared: maximum, average and root_mean_square deviations are searched.
There are three options for comparison:

   - <r>dif A</r> or <r>dif A 0</r>   - compare with zero matrix/ stack ;
   - <r>dif A 1</r>            - compare with the Identity matrix( all 0, diagonal 1 );
   - <r>dif A B</r>            - difference between A and B .

> stk 99 99| noise - > A           ! create A[99,99] and fill by random values
> inv A| mul A - | dif - 1         ! A * invA = I, difference from Identity
<f>! Max          Average       Root_Mean_Square
### dif[ 3 ]
 1.998401e-14  1.944781e-15  2.900034e-15</f>
________________________________________________________________________________________
<a name='inv'></a>
    <o>inv  A  >  File        ! <r>Inv</r>ert Matrix
</o>
Matrix A must be square( number of rows = number of columns ).
The result, when multiplied by A, gives the Identity Matrix.

> stk 400 400 | noise - > A      ! create and fill by random values
> inv A | mul - A | dif - 1      ! invert, multiply by original, difference from I
  <f>### dif[ 3 ] !Max   Average   Root_Mean_Square
  3.752553e-14   2.902646e-15   4.163867e-15</f>
________________________________________________________________________________________
<a name='sys'></a>
    <o>sys  A  b  > File    ! Solve a System of Linear Equations: [A]*x = b
</o>
Matrix A must be square( number of rows = number of columns ).
The result( x ), when multiplied from the left by A, gives the b vector.

> stk 400 400 | noise - > A         ! create A and fill by random values
> stk 400     | noise - 5     > b   ! create and fill vector b[400]
> sys A b     | mul A - | dif - b   ! solve, [A]*x, difference from b
  <f>### dif[ 3 ] !Max   Average   Root_Mean_Square
  4.423128e-13   1.251711e-13   1.549051e-13</f>
________________________________________________________________________________________
<a name='eig'></a>
    <o>eig  A  > V   !"<r>Eig</r>en Values and Vectors  of  Square Matrix"
</o>
	Based on "The Apache Commons Mathematics Library"
	<a href='https://commons.apache.org/proper/commons-math'>https://commons.apache.org/proper/commons-math</a>

If you plan to use <o>eig</o> or <o>svd</o> commands, you need to download the library:
<r>commons-math3-3.6.1.jar</r> or later  and place jar-files in  <r>pik3d/lib</r>  folder.
Without sources and java-doc it takes ~2.3 MB.

Result: 2 stacks separated by "<f>### &lt;eos></f>":
 - Diagonal Matrix of Eigen Values - V:1 or V ;
 - Matrix of normalized( length=1 ) Eigen Vectors - V:2 .

Matrix A must be square( number of rows = number of columns ).
if A is symmetric, then  Eigen Vectors are Orthogonal, i.e.
V * V# = I,  where: V# - transp.V --> V# - inverse of V .

> stk 77 9| noise - | mul -# - > A  ! M# * M = A - symmetric 9x9
> eig A  > V                        ! V - Eig.Values & Vectors
> fmt V    10*11.5g                 ! view Eigen Values
> fmt V:2  10*11.5g                 ! view Eigen Vectors(columns)

> mul V:2  V:2# | dif - 1           ! V:2 * V:2# = I<f>
  ### dif[ 3 ] !Max   Average   Root_Mean_Square
  5.828671e-16   2.111598e-16   2.491707e-16</f>

> mul V:2  V  V:2# | dif - A        ! V:2 * V * V:2#  =  A<f>
  ### dif[ 3 ] !Max   Average   Root_Mean_Square
  1.94289e-16    6.120254e-17   7.585892e-17</f>

> diag V | vic -   ! plot Eigen Values as function of number.
________________________________________________________________________________________
<a name='svd'></a>
    <o>svd  A  > D   !"<r>S</r>ingular <r>V</r>alues <r>D</r>ecomposition  of  Matrix"
</o>
	Based on "The Apache Commons Mathematics Library"
	<a href='https://commons.apache.org/proper/commons-math'>https://commons.apache.org/proper/commons-math</a>

Result: 3 stacks separated by "<f>### &lt;eos></f>":
 - Diagonal Matrix of Singular Values  - D   , below S ;
 - Matrix of  <r>"Left"</r>  Singular Vectors - D:2 , --:-- L ;
 - Matrix of  <r>"Right"</r> Singular Vectors - D:3 , --:-- R ;
	 ___n___                    ___n___
	|       |                  |       |    ___n___     ___n___
	|       |                  |       |   |       |   |       |
	m       |                  m       |   n       |   n       |
	|   A   |  = L * S * Rt =  |   L   | * |   S   | * |   Rt  |
	|       |                  |       |   |_______|   |_______| ,  where:
	|_______|                  |_______|

  A [m,n] - matrix to be decomposed
  L [m,n] - Orthogonal matrix of "Left" Singular Vectors of A
  S [n,n] - Diagonal matrix of Singular Values of A, sorted in descend order
  Rt[n,n] - TRANSPOSED Orthogonal matrix of "Right" Singular Vectors of A

Useful info: Rj-column is Eigen Vector with Eig.Value Ej of At*A, Sj=sqrt(Ej)
             Lj = A*Rj/Sj ,  where:  Lj-Left,  Rj-Right,  Sj-Singular Value
             SVD works even if m < n !

We can neglect small and zeros Singular Values/Vectors and use r < n :
	 ___n___                     __r__
	|       |                   |     |      __r__      ___n___
	|       |                   |     |     |     |    |       |
	m       |                   m     |     r  S' |    r  R't  |
	|   A   | ~ L' * S' * R't = |  L' |  *  |_____|  * |_______| ,  where:
	|       |                   |     |
	|_______|                   |_____|

  L' [m,r] - reduced Orthogonal matrix of "Left" Singular Vectors A
  S' [r,r] - reduced Diagonal matrix of Singular Values of A
  R't[r,n] - reduced Transposed Orthogonal matrix of "Right" Singular Vectors

> stk 99 7 | noise -  >  A     ! A-random matrix 99x7
> svd A <r>@D</r> | tt 10*11.4g       ! <r>Save</r> and print Singular Values and Vectors
> mul D:2 D D:3# | dif A -     ! Difference A from L*S*Rt
  <f>### dif[ 3 ] !Max   Average   Root_Mean_Square
  1.665334e-16   4.135816e-17   5.1797643e-17</f>

> mul D:2# D:2 | dif - 1       ! L# * L = I
  <f>### dif[ 3 ] !Max   Average   Root_Mean_Square
  1.776356e-15   2.970216e-16   4.27931803e-16</f>

> mul D:3# D:3 | dif - 1       ! R# * R = I
  <f>### dif[ 3 ] !Max   Average   Root_Mean_Square
  5.551115e-16   1.525140e-16   1.937281e-16</f>

> mul A# A > AtA  &  <r>mul D:3  D D  D:3#</r> | dif - AtA    ! <r>R * S*S * Rt</r> = AtA
  <f>### dif[ 3 ] !Max   Average   Root_Mean_Square
  5.551115e-16   1.159963e-16   1.481203e-16</f>

> diag D | vic -   ! plot Singular Values as function of number.
________________________________________________________________________________________
<a name='dia'></a>
    <o>diag  A  [Vector]  > D   ! get/set <r>DIAG</r>onal values of Matrix
</o>
If Vector is absent , vector D will contain diagonal of the matrix A.

If Vector is present, it will be set as diagonal in to the A matrix and output.
The number of inserted values = min( A_Diagonal.Length, Vector.Length )
  e.g.
> diag  A      > d      ! get:  d is vector and contains Diagonal of A
> diag  A  dd  > Anew   ! set:  Anew == A with new diagonal = dd
________________________________________________________________________________________
<a name='tra'></a>
    <o>tra    Stk  > File
</o>
<r>TRA</r>nsposing ALL FRAMES OF THE STACK. The frame columns become the rows in the new Stack.
It can be considered as frame  <r>turn over the diagonal</r>:  upper left - lower right.

    <o>rot90  Stk  > File
</o>
Rotation STACK FRAME 90 degrees can be considered as a <r>rotation about the center</r> of the
frame at 90 degrees COUNTERCLOCK-WISE.
Example for frame[ m, n ] - m-rows, n-columns:

	    frame[ m, n ]   result[ n, m ]
		 ( 1, 1 )   --->  ( n, 1 )
		 ( m, 1 )   --->  ( n, m )
		 ( m, n )   --->  ( 1, m )
		 ( 1, n )   --->  ( 1, 1 )
________________________________________________________________________________________
<a name='reg'></a>
    <o>linreg  VF  >  K    ! <r>Lin</r>ear Least Squares <r>Reg</r>ression
</o>
In many cases, the problem of finding Linear Regression is formulated as follows:

  - there is V - scalar value dependent on vector X ;
  - X = ( x, y, z ... ) - vector of independent variables ;
  - the set of measurements: <r>[V]</r> ={ V1,V2...Vm } and correspondent <r>[X]</r> ={ X1,X2...Xm }.

Need to find the analytical expression: <r>V = F(X) -"Regression"</r> as a <r>linear</r> combination
of  a  given  set of functions  <r>{f} = { f1, f2 ... fn }</r>  defined by  the subject area.
For example we can use  {f} = { 1, x, y, x*x, y*y, x*y ... pow( x+y, 3/2.) }.

    <r>Linear Regression</r> assumes form:  <r>F(X) = k1*f1(X) + k2*f2(X) ... + kn*fn(X)</r>

To find regression means to find the set  <r>{k} = { k1, k2 ... kn }</r>  on the given  <r>{f}</r>.
It often sought in the sense of <r>"Least Squares"</r> - minimum sum  of squared deviations
of measured  Vi  and  calculated F( Xi ).

In terms of matrices we have:
	 ____             ____     ____________
	|    |           |    |   |            |                    ____
	| V1 |           | X1 |   | x1, y1 ... |                   |    |
	| V2 |           | X2 |   | x2, y2 ... |                   | k1 |
	| V3 |           | X3 |   | x3, y3 ... |                   | k2 |
  <r>[V]</r> = |  . | ,   <r>[X]</r> = |  . | = |  .         |   to find:  <r>[K]</r> = |  . |
	|  . |           |  . |   |  .         |                   |  . |
	|  . |           |  . |   |  .         |                   |  . |
	| Vm |           | Xm |   | xm, ym ... |                   | kn |
	|____|           |____|   |____________|                   |____|

To find solution we must create  <r>[F]</r>-matrix  of <r>"Function Values"</r> based on our {f} :
	 ___________________________
	|                           |
	| f1(X1), f2(X1) ... fn(X1) |
	| f1(X2), f2(X2) ... fn(X2) |
	| f1(X3), f2(X3) ... fn(X3) |
  <r>[F]</r> = |          .                | ,    <r>[F] * [K]  ~  [V]</r>
	|          .                |
	|          .                |
	| f1(Xm), f1(am) ... fn(Xm) |
	|___________________________|

Solution: "Least Squares" assumes equality:  F*K = V -->  Ft*F*K = Ft*V,  Ft - transp.F
K - solution of the system of linear equations:  [A]*K = b,  where: [A] = Ft*F, b= Ft*V

Command: <r>linreg</r>  uses [V] and [F]  joined to one matrix  <r>[VF]</r> :
	 _______________________________
	|                               |
	| <r>V1</r>, f1(X1), f2(X1) ... fn(X1) |
	| <r>V2</r>, f1(X2), f2(X2) ... fn(X2) |
 <r>[VF]</r> = |                    ...        |
	|                               |
	| <r>Vm</r>, f1(Xm), f2(Xm) ... fn(Xm) |
	|_______________________________|

Framework pik3d  offers to use  <a href='#jj'>jj-technology</a>  to create <r>[VF]</r> matrix.
Program:  pik3d/usr/<r>prereg.jj</r> creates it from [V] and [X].  Advice: copy <r>prereg.jj</r> to
working folder  and  modify it in accordance with  required regression( <r>lines: 17,20</r> ):
<n>...
17:   <r>double x=X[0], y=X[1];</r>    //! z=X[i][2], mx=X[i][3], my=X[i][4], mz=X[i][5]
...
20:   <r>1, x,y, x*x, y*y, x*y</r>     //! {f}  !!! x,y,z ... must be set in line 17 !!!
...</n>
Matrices must be in ###-format. Example m=33: V[33], X[33,2]={ x1,y1/ x2,y2/ ... xm,ym }
> <r>jj prereg</r> V X > VF     ! if prereg.jj was not modified, VF[33,7]

If [V] and [X] are in one joined matrix [D], <a href='#djk'>slice</a> technology may be used, e.g
   [D] = { x1,y1,<r>V1</r>/ x2,y2,<r>V2</r> ... xm,ym,<r>Vm</r> } :
> <r>jj prereg</r>  D[:,3]  D[:,#2]  > VF   ! VF[m,7], see pik3d_DOC.html/ STACK PART.

Often the data is divided randomly into two parts. The first part is used to build the
model( regression ), the second is for verification. To use this technique, the  pik3d
framework offers a Use-Vector.  Matrices:  V, X, VF  with a number of rows  m  are
associated with a vector of length m.  The elements of  Use-Vector {C}  are  integers
indicating that the i-row belongs to "use case C".  See <a href='#uve'>command: usevec</a>.

Program  <r>prereg.jj</r>  has 2 optional parameters: <r>U c</r> - Use-Vector and "case",e.g. m=1000:
> <a href='#uve'>usevec</a>  1000  1  80      > U80            ! 80%( 800 rows ) belong to case 1
> <r>jj prereg</r> D[:,3] D[:,#2]   <r>U80 1</r> > VF1    ! VF1[800,7] - "use case 1"
> <r>jj prereg</r> D[:,3] D[:,#2]   <r>U80 0</r> > VF0    ! VF0[200,7] - "use case 0" - the rest
> <r>jj prereg</r> D[:,3] D[:,#2]   <r>U80 1</r> | <r>linreg</r> - > K1       ! "use case 1" from pipe

see commands:
  <a href='#uve'>usevec</a>  - create use-vector
  <a href='#uca'>usecase</a> - get use case from matrix
  <a href='#uou'>useout</a>  - remove outliers( dropped points )
  <a href='#tst'>tstreg</a>  - test/verify regression on another use case

Usually no need to store VF-matrix. We can directly pass it to processing using "pipe":
> <r>jj prereg</r>  V  X           | <r>linreg</r> - > K
> <r>jj prereg</r>  D[:,3] D[:,#2] | <r>linreg</r> - > Kd
> <r>jj prereg</r>  V  X  U80  1   | <r>linreg</r> - > K1

Result file K contains 3 stacks  delimited by "<f>### &lt;eos></f>":
 - 1st  ### K    [ n ]      ! {k}
 - 2nd  ### Delta[ m ]      ! {d} = { Vi-F(Xi) }
 - 3rd  ### dif[ 3 ]        ! Max, mean, r.m.s.(root mean square) of {d}

You can directly view results( all 3 stacks ) without saving to file:
> <r>jj prereg</r> V X | <r>linreg</r> -  | tt 10*10.5g   #change format( 10*10.5g ) as you like

Or each stack/matrix  separately  after saving to file( e.g. K ):
> fmt   K     10*11.5g      ! {k}
> fmt   K:2   10*11.5g      ! Delta
> fmt   K:3   10*11.5g      ! dif
________________________________________________________________________________________
<a name='tst'></a>
  <o>tstreg  VF  K  > dif   !<r>T</r>e<r>st</r>/Verify <r>Reg</r>ression( K ) on another data
</o>
where:
    VF - matrix must be prepared by:  jj prereg V X [U c_tst]
    K  - result of the command:  linreg  (see: > linreg )

Result:  ### dif[ 3 ]     ! Max, mean, root_mean_square of deviations:
                          ! experimental and calculated values: <r>V-F*K</r>
  e.g.( #rows = 500 ):
> stk 500 3| noise - 100  > D                    !create VF matrix
> usevec 500 1 80         > u80                  !400 rows(c=1) and 100 for test(c=0)
> jj prereg  D[:,3] D[:,q2] u80 <r>1</r>| linreg - > K  !obtain {k} -Regression coefficients
> jj prereg  D[:,3] D[:,q2] u80 <r>0</r>| tstreg -   K  !print difference: <r>V-F*K</r>

  <f>### dif[ 3 ] !Max    Average    Root_Mean_Square
        106.1928      46.84697      55.43736</f>
________________________________________________________________________________________
<a name='uve'></a>
  <o>usevec  m  c1 p1 [c2 p2 [c3 p3]]  > Use  !Create "<r>Use</r>-<r>Vec</r>tor"
</o>
<r>"Use-Vector"</r> controls the creation of random samples-<r>"cases"</r> from the data array.
m - the Length of whole data array( the number of rows of the data Matrix ).

Integer numbers c1,c2... are sample numbers, p1,p2... - corresponding sample
lengths  in % of the whole data array( m ).  p1+p2+ ... +pk <= 100 (%).
If p1+p2+...pk < 100 (%), then remaining positions will be set to 0 (0-case) !

Create ### use[ m ]  and set value c1 in p1% of positions in random order.
Repeat settings for  c2 p2  ...  if present.
It is suggested to use ci < 0 to mark  the outliers ( -9 for c=0 ).

> usevec 999                 > u0            !value  0 in 100% positions(999)
> usevec 888  1              > u1            !value  1 in 100% positions(888)
> usevec 500  2 20           > u2_20         !2 20%, 0 80%
> usevec 1000 1 40  9 20  2 5<r>| tt 40*2.0f</r>    !1 40%, 9 20%, 5 5%, 0 35%, <r>view</r>
________________________________________________________________________________________
<a name='sta'></a>
  <o>usestat   UseVector  [case]   !<r>Stat</r>istics of Use-Vector or case
</o>
Analyzes the vector and displays Statistics:  case, number, outliers

> usevec  100  1 11  2 22  3 33  4 19 @U |tt 20*3.0f & usestat U  !create and init.Stat.
> jj "var u=inVect2(arg[0]); for(int i=0;i<100;i+=2)u[i]*=-1; ttVect2(u)" U >U_
> fmt U_ 20*3.0f  &  usestat U_      !after even elements "drop" display and Statistics
<f>! case   number  dropped
### Use_Statistics [ 5, 3 ]
     0       15        0
     1        5        6
     2        8       14
     3       20       13
     4        8       11</f>
________________________________________________________________________________________
<a name='uca'></a>
  <o>usecase  M  U  c  > Mc   ! get <r>"Use Case"</r> from  Matrix
</o>
Select from the matrix M the rows for which Use-Vector U has value c.
See commands:  linreg  and  usevec.
All parameters are mandatory !
e.g.
> usecase  Data  Data_use  2  > D2     !D2   contains "case 2" of Data
> usecase  Mes   useMes    0  > Mes0   !Mes0 contains "case 0" of Mes
> usecase  M     U         1  > M1     !M1   contains "case 1" of M
________________________________________________________________________________________
<a name='uou'></a>
  <o>useout  K  s=dS | v=dV  > U_c  ! Remove outliers( dropped points )
                                 ! in Use-Vector: c is replaced by -c</o>
where:
    K    - result of the command: linreg ;
    s=dS - permissible deviation in "Sigma" ~ Root Mean Square deviation( K:3[3] );
    v=dV - permissible deviation dV as "subject Value";
    U_c  - modified Use-Vector (K:4), rows where deviation(K:2) > permissible
           ( removed rows are marked by -c <0 (-9 for c=0), c=K:5 ).
e.g.
> stk 100 3| noise - 100 > XY                     !prepare random data 100x3
> usevec 100 1 80        > U80                    !prepare Use-Vector
> jj prereg XY[:,3] XY[:,#2] U80 1| linreg - > K  !K contains Regression
> useout  K  s=1.7    <r>@u80_s1.7</r>   | tt 20*3.0f    !<r>save</r> and view new Use-Vector
> useout  K  v=90     <r>@u80_v90</r>    | tt 20*3.0f    !<r>save</r> and view with dV parameter
________________________________________________________________________________________
<a name='mnk'></a>
  <o>lss XY [N=3] [/vis] [/add=File] > SPL  !<r>L</r>east <r>S</r>quares <r>S</r>pline of N parts
</o>
XY [N=3] [/vis] [/add=File.add] > SPL  !Least Squares Spline of N parts

The XY stack must contain at least 2 columns: arguments and function values.
It may use slice description, like: XY[:,(2,5)], see: pik3d_DOC.html.
only the first two columns of XY or slice are used!  The data can be not ordered.
The command will order them in ascending of the argument( 1st column ) if necessary.

If the key: <r>/vis</r> is present,  XY points,  Spline  and  intervals  are displayed.
If <r>/add=File</r>[.add] is present, Additional Graphics is displayed, see: pik3d_DOC.html

If the  <n>command: lss</n>  does not output data,  run it with the key: <r>/dbg</r> !
Result File contains 3 Stacks/matrices delimited by "### <eos>":

The 1st Stack:  SPL:1 contains the Spline Coefficients [ N, 5 ], N rows of 5 values:
  - 1st value: xi - the beginning of the interval of i-part;
  - s0, s1, s2, s3 :  S(x) = s0 + s1*t + s2*t*t + s3*t*t*t,   where: t = x-xi .
Spline coefficients SPL can be used in the  command: spl  to calculate spline values
for a given set of arguments.

The 2nd Stack:  SPL:2  contains matrix of 3 columns:  X[], Y[], Spline[] .
It may be viewed in simple way: > vics  SPL:2 1  2,-1  3,0

The 3rd stack:  SPL:3 -"difference" ### dif[3] : Max, mean, Root_Mean_Square( r.m.s.)
R.m.s. is indicated on the title of the chart  if key /vis is used.  Examples:
jj-program to generate data: pik3d\usr\TestLSS.jj :
<f>{
  int i, n=30, nn=n*3;
  double dx=2*pi/n, x=.6, Fun;
  tt("### XYF [ "+nn+", 3 ]");  // XY + Function
  for(i=0; i&lt;nn; i++) {
    Fun = 3*sin( x )*exp( -x/7 );
    tt( x, (Fun+(rnd()-.5)), Fun);
    x+=dx;
  }
}</f>
- see: pik3d/demo/2d-graph/_run.cmd (line:13)

> jj TestLSS @XYF | lss - 7 /vis @SPL | spl - XYF > XYFS       !XYFS[90,4]=XYF[90,3]+Spl
> vics XYFS 1 "2,-1 Data" "3,0 Function" "4 8 0 Spline" /y=400 !plot:  Data, Fun, Spline
________________________________________________________________________________________
<a name='spl'></a>
    <o>spl  SPL  X  > File   ! Getting Spline Values
</o>
Arranges X rows if necessary, computes spline values( with SPL from <a href='#mnk'>command: lss </a>),
<r>appends!</r> to X a new column with them  and  outputs to the File.

> jj  TestLSS @XYF  |  lss - 7 /vis  > SPL               !XYF[90,3] & save Spline => SPL
> spl   SPL    XYF  >  XYFS                              !XYF[90,3]+Spl => XYFS[90,4]
> vics XYFS 1 "2,-1 Data" "3,0 Function" "4 8 0 Spline"  !plot: Data, Fun, Spline
________________________________________________________________________________________
<a name='180'></a>
	<o>blur  Stk  [R=2]   > File
</o>
Apply <r>"Gaussian Blur"</r> smooth filter of given Radius R=2*sigma to all frames.
Radius - characteristic blur size (smaller elements will disappear after blur ).
By default R=2, but can be for example: 1.2, 1.75, 3.5 ...
Filter width (aperture) = 3*R = 6*sigma, i.e. at R=2 summation for each point
will be done on a 7x7 square( 3*R=3*2, +1 - "Center Point Requirement").
________________________________________________________________________________________
<a name='190'></a>
	<o>filtr  Stk  Fltr   > File
</o>
Apply <r>Digital Filter</r> to all Stk frames. Fltr - <a href="#dat">###-matrix</a> with filter coefficients.
For example, the filter can be obtained like this: > <a href="#60">gauss</a> 3.5 2.8 > Fltr ! size: 11x11
The filter may be NOT normalized( the sum of the coefficients != 1 ).
Filter normalization is done automatically by the command.
________________________________________________________________________________________
<a name='160'></a>
	<o>top  Stk  level   > File   !2 required parameters!
</o>
<r>"Cut TOP"</r> - replace with level  all <r>values > level</r>.
________________________________________________________________________________________
<a name='170'></a>
	<o>bot  Stk  [level=0]  > File
</o>
<r>"Cut Bottom"</r>  - replace with level  all <r>values &lt; level</r>.
________________________________________________________________________________________
<a name='210'></a><f>Simple time smoothing (through the frames):</f>

	<o>ma  Stk  [ N=5 ]   > File   !"<r>M</r>oving <r>A</r>verage"- over N frames</o>

<r>WARNING!</r> Usually, a moving average means the SUM of N-1 previous values and the current
one divided by N. This leads to  lag = N/2  of filtered values.
In <o>ma, sma :</o> commands

  <r>&lt;MOVING AVERAGE> = ( &lt;sum of PREV N/2> + current + &lt;sum of NEXT N/2> ) / N</r>
  If N=2*k is given - commands use the value 2*k+1 !!!
  At the beginning and the end of the stack, the division is made by the real number
  of summed values.

The MOVING AVERAGE is calculated for each frame point.
________________________________________________________________________________________
<a name='220'></a><f>Removing Slowly Changing Variations - "Detrending":</f>

	<o>sma  Stk  [ N=5 [ level=0 ]]  > File
</o>
"<r>S</r>ubtract the <r>M</r>oving <r>A</r>verage" - over N frames.
level specifies the "cutoff" in output stack ( values below are replaced by level ).
________________________________________________________________________________________
<a name='120'></a>
    <o>sv  Stk  [+-x/p|exp|ln|db]  Value  > File   !"<r>S</r>tack-<r>V</r>alue" operations
</o>
One of the operations[] is applied to <r>each stack element</r> and <r>value</r>.

  Arithmetic operations:
    +, -, <r>x-multiply(Latin:x)</r>, /-divide, <r>p-raise to a Power</r>

  Functions &lt;Stack element> / value:
    exp = exp  ( stk / value ) - "e" to the power ratio: &lt;Stack element>/value
    ln  = ln   ( stk / value ) - natural logarithm( base "e" )
    db  = 10*lg( stk / value ) - power decibel( decibel log.)

    sv  Stk  + 200   >  F    !add 200 to all elements
    sv  Stk  - 100   >  F    !
    sv  Stk  x -1    >  F    !x - multiply by -1 == change the sign of all elements
    sv  Stk  / 4     >  F    !
    sv  Stk  p 2     >  F    !square all elements
    sv  Stk  p .5    >  F    !take the square root of all elements (power of 1/2)

*you can omit the space before value:
    sv Stk +1; sv Stk /2; sv Stk ^.5;
    sv Stk - -3 == sv Stk --3 == sv Stk +3 !!!

*function name can be abbreviated to ONE letter( e, l, d ):
    sv Stk e -2 == sv Stk exp -2   ! exp( -stk/2 )
________________________________________________________________________________________
<a name='130'></a>
    <o>ss  A  [+-x/^]  B  > File   !"<r>S</r>tack-<r>S</r>tack" operations
</o>
One of the operations[] is applied to the correspondent elements of stacks;
Element-by-element stack operations:

  ss A + B > F   ! element-wise ADDITION:          Fij = Aij + Bij
  ss A - B > F   ! --:--:--:--  SUBTRACT:          Fij = Aij - Bij
  ss A x B > F   ! --:--:--:--  MULTIPLY(<r>Latin x</r>): Fij = Aij x Bij
  ss A / B > F   ! --:--:--:--  DIVISION:          Fij = Aij / Bij
  ss A p B > F   ! --:--:--:--  RAISE TO A POWER:  Fij = Aij p Bij

* STACKS MUST HAVE FRAMES OF THE SAME SIZE !
* Number of result frames = number of <r>shorter</r> stack.
* Raise to a power - single quote.
________________________________________________________________________________________
<a name='vis'></a>
  <o>vic[s] - <r><u>VI</u></r>sualize <r><u>C</u></r>olumn [with <r> <u>S</u></r>pline]
</o>
  <r>!!! IT IS NOT RECOMMENDED TO DISPLAY COLUMNS LONGER > 100,000 elements !!!</r>

The parameters for the <o>vic</o> and <o>vics</o> commands are the same.
Sign <r>,</r> in the command means default value.

<r>Only the columns of the first frame are displayed</r>
To display columns of the 7-frame:  <a href="#sec">sec</a> Stk k=7 | <o>vic - ...</o>
In case of lines   of the 9-frame:  <a href="#sec">sec</a> Stk k=9 | <a href="#tra">tra</a> - | <o>vic - ...</o>
If you need to display Stk[3,5,:]:  <a href="#sec">sec</a> Stk i=3 | <a href="#tra">tra</a> - | <o>vic - , 5 ...</o>

<r>vic Stk  jX  j1 j2 ...  [keys]</r> , where:
     Stk - stack name, ONLY 1-frame is always used
          jX - column X[] -"argument values":
                  0: X[] = 1, 2, 3, 4 ... - default, "scan by numbers";
                  N: X[] = N-column values;
             (V dV): X[] = V, V+dV, V+2*dV, V+3*dV ... ;

              j1 j2 j3... - columns( no more than 12 ) will be shown as functions of X[]
                            default j1=1, if jK<0 - only markers without a line
keys:
     <r>/lgx, /lgy, /lgxy</r> - Logarithmic Scale of the correspondent axis
     <r>/x=px, /y=py</r> - position in pixels of the up left window corner, defaults: 0,0
     <r>/w=pw, /h=ph</r> - width and height in pixels of the window, defaults: 640, 400
     <r>/add=file[.add]</r> - add to chart previously saved <Alt+A> Add.graphics: Texts,Lines,Figs
     <r>/dbg</r> - allows you to see error messages

     <r>/blank</r> - mode to prepare chart without data-curves and axes.
     Only  Figures, Texts, Lines  will be saved by ^S in WMF-file.
     This mode can be used to create illustrations, flowcharts, additional graphics.
     Aspect ratio of the chart  <r>is fixed</r>.  For the convenience  of  drawing,
     an additional grid is displayed. It can be considered as a centimeter markup.
     The final drawing  can be limited by  <a href="#pad">OFFSET from the window border</a>.

examples:
  vic                            !get HELP or > vic /?
  vic q                          !stack q: "by numbers" 1-column == q,, == q,1 == q 1 1
  vic q,4                        !---:---:---:---:---   4-column
  vic q (2 .5) 6 7 /w=999 /h=555 !---:---: X=2,2.5,3... 6,7-columns, window[0,0,999,555]
  vic q 1 2 /lgy                 !chart with Log.scale y-axis
  vic /blank /add=AddGraph.add   !blank with add.graphics( it can be loaded later ^A ).

default <r>"Legend"</r> contains:  colored line with marker,  stack name  and  column number.
"Legend" can be dragged. Before saving, you can add Texts(^T), Lines(^L), Figures(^F).
&lt;F1> -"Help": Add.graphics, options: ^T, ^L, ^F, ZOOM ...  <a href="#gra">more abour 2D-graphics</a>.

         c = Colors[ 11 ]:     m = Markers[ 10 ]:
         <b>0 - black             </b>0 - LINE WITHOUT MARKER
         <font color=0000d8><b>1 - blue</font>              </b>1 - small filled square
         <font color=228b22><b>2 - green</font>             </b>2 - diamond
         <font color=ff8c00><b>3 - orange</font>            </b>3 - triangle
         <font color=04b4ff><b>4 - cyan</font>              </b>4 - square
         <font color=d500d5><b>5 - lilac</font>             </b>5 - pentagon
         <font color=00de00><b>6 - light green</font>       </b>6 - inverted triangle
         <font color=777777><b>7 - gray</font>              </b>7 - "butterfly"
         <font color=eb0000><b>8 - red</font>               </b>8 - +
         <font color=005c81><b>9 - gray-green</font>        </b>9 - x
        <font color=753838><b>10 - brown</font>            </b>10 - O or circle

	     special markers: 11 - marker[1] + line down to X-Axis
	                      12 - marker[1] + line left to Y-Axis

With a large number of graphs, colors repeat in a cycle: 0-10 (from 1), markers: <r><u>1</u></r>-10

<r>"DETAILS"</r> is required to set color, line without marker and/or text in <r>"Legend"</r>:
<r>"j c [ m [ text ]]"</r> !!! QUOTATION MARKS ARE OBLIGATORY if there is a SPACE in <r>"DETAILS"</r>
 <r>j</r> - column number if j &lt; 0 - only markers without a line
   <r>c</r> - color or ',' or hexadecimal value( <u>6 digits:</u> <r>RR</r><g>GG</g><n>BB </n>, example: <font color=4b0082>4b0082 - Indigo</font> )
       <r>m</r> - marker or ',' - if m &lt; 0 - only markers without a line
           <r>text</r> - if set - "Legend" will contain this text
examples:
  vic q,,2 -3 5,0 7,-1      !col.: 1,2,3,5,7: 3-markers only, 5-line only, 7-squares
  vic q (2 .1) 2,0 3,0 4,0  !X[]: 2, 2.1, 2.2, 2.3... columns: 2,3,4 - lines only

  vic q,  3,,Blue  5,,Green  7,,Orange   !"by numbers", columns: 3, 5, 7

  vic q,,2 8,,dt,ms -7 "4 4b0082, Delay" 15.0 "9 7, Limit [ms]"
      q-stack( 1st frame ), "scan by numbers"(1st comma) of the following columns:
        1: (2nd comma - default) blue line, square, no text;
         2: green line, diamond, no text;
           8: (details without spaces) orange line, triangle, text="dt,ms";
                     7: blue square, no line, no text;
                        4: Indigo( 4b0082 ) line, 5-gon, text="Delay";
                                         15: purple line, no markers, no text;
                                               9: gray line, inv.triangle,"Limit [ms]"
________________________________________________________________________________________
<a name='vip'></a>
  <o>vimp  config  [keys]  - "<r><u>VI</u></r>sualize <r><u>M</u></r>ultiple stacks <r><u>P</u></r>lots" in one chart
</o>
where: <r>config</r> is a text file, may contain empty lines and comments(start with # or ! ).
       <r>keys</r>   are the same as <a href="#vis">vic-command</a>.

Column display parameters :  <r>vic Stk ...  and  vics Stk ...</r>
exactly match the commands:  <a href="#vis">vic Stk ...  and  vics Stk ...</a>   Example config file:
<f>
# this is a comment
  <r>vic </r> p5
  <r>vic </r> q,,2 3
  <r>vics</r> q25, -3 "4 4b0082, Delay" "9 7, Limit [ms]"
! config END.</f>

We can create the config dynamically on the fly while executing the batch file, e.g.
<m>rem  cretae config  &  execute it  with Spline data:</m><n>
  jj   TestLSS  @XYF  | lss  XYF  7  > SPL
  spl  SPL       XYF  >      XYFS
  echo vics XYFS 1 "2,-1 Data" "3,0 Function" "4 8 0 Spline" > <r>config</r>
  echo vic  SPL  1 "2 9 -11 begin interval"                 >> <r>config</r>
  <r>vimp config</r></n>
________________________________________________________________________________________
<a name='gra'></a>
	<o> Use of 2D-graphics</o>

  &lt;F1>      - quick help.
  &lt;^S>      - save image in .WMF format
  &lt;^+/ ^->  - quick increase/ decrease of the window by ~10%.
              Size of the window can be changed using standard Windows tools.

Subject coordinates( SC ) of the cursor are displayed in the window title.
<r>When CLICKING with any mouse button, SC are copied to the CLIPBOARD.</r>
This allows you to build a table of measurements: after clicking go to the text editor
and <r>"Paste"</r> the values from the clipboard( <r>&lt;Ctrl+V> or &lt;Shift+Ins></r> ).

You can select and enlarge a fragment of the chart - <r>ZOOM</r>:
1. Press Left Mouse button and <r>"Drag"</r>.
2. Without releasing the mouse button, select the size of the rectangle.
3. Release the mouse and <r>click inside the rectangle</r> - a new ZOOM window will open.
4. Select the size and aspect ratio of the new ZOOM window.
5. Select the position of ZOOM in the main window - <r>"Drag" rectangle</r>.
6. The size of the rectangle can be changed: <r>"Drag" any corner of the rectangle</r>.
7. The rectangle in the main window exists as long as ZOOM window is not closed.

You can add <r>TEXT, LINE or FIGURE( box, oval, romb )</r> anywhere in the window:

  - <r>&lt;Ctrl+T></r> - add  <r>TEXT</r> :
      - in the dialog that appears, select Color, Size, enter text;
      - <r>&#8593;/&#8595;</r>  - increase/ decrease  FONT Size;
      - <r>drag</r> text to the desired location, press OK or &lt;Enter>.

  - <r>&lt;Ctrl+L></r> - add  <r>LINE</r>
        A line can consist of several fragments: Bezier curves and/or straight lines.
        Form is controled by Hotspots( HS ). <r>YELLOW HS</r> are used in Bezier curves,
        which provide a continuous second derivative. YELLOW HS can only be dragged.
        If they are turned off(X-function), you can get fragment of straight line.

        The <r>RED HS</r> define the start and end of the fragment.
        When the cursor is hovered over a HS, RED HS is activated - the cursor changes
        shape to a "hand". When RED HS is activated, you can execute the functions by
        pressing the keyboard: <r>A/D, X, &#8592;/&#8594;</r>.
        If no one HS is active - the function is applied to the Last Line Fragment.

      - <r>A/D</r>  -"Add" new RED HS after this/ "Delete" HS or Last Fragment;
      - <r> X</r>   - ON/ OFF  YELLOW HS for this HS  - Shape Controls for Besier curve;
      - <r>&#8592;/&#8594;</r>  - ON/ OFF  <r>ARROW</r>  at the Hotspot or at the start/end of the Last Fragment.

      - <r>+/-</r>  - increase/ decrease  the <r>Line Width</r>
      - <r>&#8593;/&#8595;</r>  - increase/ decrease  <r>ARROW Size</r>.
      - <r>Right Mouse Drag  any  Red Hotspot  moves  the whole  LINE !</r>

  - <r>&lt;Ctrl+F></r> - add standard  <r>FIGURE </r>: Rectangle, Oval, Romb - select by Radio Button.
        The size and position are adjusted by Red Hotspots. You can Fill the Figure
        by selecting check box and color. To redefine Fill Color click color once more.
      - <r>+/-</r>  - increase/ decrease Line Width/ thickness of the Figure Border;
      - <r>Right Mouse Drag  any  Red Hotspot  moves  the whole  FIGURE !</r>

  - <r>&lt;Alt +A></r> - Save to File <r>Additonal Graphics</r>: Texts,Lines,Figures, previous Add.Graph.
               Add.Graphics is not tied to the subject coordinates. It exists in the
               window coordinates !  One Graph  can be used  in  different charts.
  - <r>&lt;Ctrl+A></r> - Add to chart Add.Graphics from File[.add]( saved by &lt;Alt+A>).
               May be done several times  with  different addons.

  - <r>&lt;Ctrl+Z></r> - Delete Last Added: Text, Line, Add.Graphics. May be done several times.

  - <r>&lt;Ctrl+B></r> - ON/ OFF  <r>Background</r> Color  of the chart.

  - <r>&lt;Ctrl+S></r> - Save chart in <r>"Windows Meta File"</r> - vector graphics, that scales well
               and is supported by MS Word, ACDSee, Total Commander &lt;F3> ...
               If the chart uses characters  of a code page  other  than cp1252,
               this code page  must be specified  after  the file name  with comma,
               for example (Cyrillic):  chart.wmf<r>, cp1251</r>

<a name='pad'></a>
             <r>Setting graphics indents( PADDING )</r> from window borders:

  - <r>&lt;Ctrl></r> + move the cursor to the window border.  The cursor should change shape.
  While holding down  <r>&lt;Ctrl> and &lt;Left Mouse Button></r>  drag  the window border  to
  a new position.  You can add  lines and text  to the freed space.
  It is convenient  to adjust the corners  of the window  standing  diagonally.
  If <r>Set Padding mode</r> is in effect after release buttons - press <r>&lt;Ctrl></r> once more.

<o>
       Graphics Features:
</o>
- THE SIZE OF THE AXIS SIGNATURES IS FIXED ( does not increase with an increase of the
  window).If the document needs large axis labels, select a small window size before ^S.

- When resizing the window, the position( in subject coordinates ) of the lower left
  corner of the texts remains unchanged. "Legend" base point - its upper right corner.

- The aspect ratio of the image can only be changed until is saved: ^S  .

- <r>WMF</r> is a vector format( LINES, NO pixels ), so it scales well.
  In the  MS Word document  you can stretch the image  to the desired size.

- When manipulating a <r>WMF</r> image, the font will resize according to the image size.
________________________________________________________________________________________
<a name='tif'></a><o>
     command:  tif  File.tif  [Npro=99999]   !Show   one    tif file
               tif  Config    [Npro=99999]   !Show multiple tif files
</o>
You can save a clip as a multi-pages tif-file by the command <a href="#s3F2"> s3d: &lt;F2> </a>.
You can use multi-pages tif-files created in other programs ( ImageJ ...)

All pages are displayed sequentially. The cycle is repeated Npro times.
This parameter should not be specified unless required fixed number of views.

To display multiple tif files synchronously, <r>Config file is required:
       ___________Config__________
      |                           |
      | dt[ms] = &lt;frame interval> |
      |                           |
      | File1.tif, x1, y1, w1, h1 |
      | File2.tif, x2, y2, w2, h2 |
      |       ...                 |
      | FileN.tif, xN, yN, wN, hN |
      |___________________________|
</r>
where:  dt[ms] - time interval in milliseconds between frames, default=200 ;
        xk, yk - coordinates of the upper left corner of the k-image ;
        wk, hk - width, height of the k-image,  k=1,2,3...N .

Show can be:
  - stop/continue: <r>&lt;Mouse Right click>  or  &lt;space></r>;
  - speed up/ slow down: <r>&lt;Ctrl+Right>/ &lt;Ctrl+Left></r>,  default: 5 frames/sec.

Frames can be scrolled by rotating the <r>Mouse Wheel</r> or keys: <r>&lt;Left>/&lt;Right>, &lt;Home>/&lt;End></r>
________________________________________________________________________________________
<a name='jj'></a><f>jj = "java-JAVA" or simple JAVA Technology</f><o>

     command: jj  ...   !execute "single source-file":  .java or .jj

 jj  File<n>.java</n>  [arg0 arg1 ...]      [/c]  !Execute "single source-file"
 jj  File[.jj]  [arg0 arg1 ...] [/s] [/c]  !---:--- .jj = "simple" JAVA

 jj "jcmd1; jcmd2; jcmd3;  ..." [/s] [/c]  !---:---  several JAVA cmds.
<div style='background:#333333; color:#00FF00;'> jj <r>'</r>jcmd1; jcmd2; jcmd3;  ...<r>'</r> [/s] [/c] ! ---:---  Linux </div></o>
<r>       ATTENTION: if file contains NON-ENGLISH characters, ENCODING must be UTF-8 !!!
</r>
Modern JAVA supports direct execution of "single source-file". In general case, you need
to specify JVM parameters and class-path. Since  these parameters are already set in the
framework, no need to point them in command <o>jj</o>.  Small programs may be used to generate
data in the <a href="#dat">###-format</a>  or  for simple data processing.

Example 1, <n>minMAJ.java</n>: "<n>minor</n> <r>MAJOR</r>":
  Chords  =  additions of three harmonics with frequencies:
    <n>minor</n> chord:  1, <n>6/5</n>, 3/2  - tonic, <n>minor</n> third, quint
    <r>MAJOR</r> chord:  1, <r>5/4</r>, 3/2  - tonic, <r>MAJOR</r> third, quint
<f>
package usr;
public class minMAJ {
  static public void main( String[] a )
  <r>{</r>
    System.out.println("### minMAJ [ 201, 3 ]");                 // ### Header
    for(int i=0; i&lt;=200; i++) {
       var t = i*( 2*Math.PI/10 );                               // 10 points/period
       var k = Math.sin( t ) + Math.sin( t*3/2 );                // tonic + quint
       System.out.println( i/10.+"\t"+( k + Math.sin( t*6/5 ))   // minor
                                +"\t"+( k + Math.sin( t*5/4 ))); // MAJOR
    }
  <r>}</r>
}</f>
> <o>jj</o> minMAJ<n>.java</n>                                               !output to the console
> <o>jj</o> minMAJ<n>.java</n> /c                                            !only compile
> <o>jj</o> minMAJ<n>.java</n> | vics - 1 2 3,8                              !simple display
> <o>jj</o> minMAJ<n>.java</n> | vics - 1 "2 1 0 minor_: 1, 6/5, 3/2" "3 8 0 MAJOR: 1, 5/4, 3/2"
<f>By the way, pay attention to the failure of the frequency for the minor on 5th
and 15th periods - this is the reason why the minor sounds sad.</f>


If you need to input and process <a href="#dat">###-files</a>, program must inherit the I/O library <r>pik.io</r>.
Example 2, <n>Reverse.java: "Stack with Frames in Reverse order"</n>:
<f>package usr;
import java.util.*;
import pik.*;

public class Reverse extends io {
  public static void main( String[] arg ){
    try{ new Reverse(arg); clott();}
    catch( Exception e ){ e.printStackTrace();}
  }
  Reverse(String[] arg) throws Exception
  <r>{</r>
    er1("Reverse", arg, "Stk > ktS");                // check input arg[]
    var stk = inStk( arg[0] );                       // stk[ kk ][ii][jj]
    int k = stk.length;
    while(k-->0) ttFrame( stk[k], arg[0]+"_"+(k+1)); // output in reverse
  <r>}</r>
}</f>
> <o>jj</o> Reverse<n>.java</n> Stk > ktS                           // save result
> <o>jj</o> Reverse<n>.java</n> Stk | s3d -                         // display

To create a stack for experiments( pik3d must be installed ):
  1. go to folder:  pik3d\demo\bell2
  2. in console  >  gen3d bell2.gen > Stk
  3. to see it   >  s3d Stk


A more advanced way to use "single source-file" in the <o>pik3d</o> is to use <o>jj-technology</o>
File<o>.jj</o> contains only <r>subject part</r> of the program( marked with red curly braces ).
Example 3, pik3d\usr\Reverse<o>.jj</o> (functionality is the same as previous example):<f>
<r>{</r>
    er1("Reverse", arg, "Stk > ktS");                // check input arg[]
    var stk = inStk( arg[0] );                       // stk[ kk ][ii][jj]
    int k = stk.length;
    while(k-->0) ttFrame( stk[k], arg[0]+"_"+(k+1)); // output in reverse
<r>}</r></f>
> <o>jj</o> Reverse Stk > ktS                                // save result
> <o>jj</o> Reverse Stk | s3d -                              // display

<o>jj - Technology provides</o> :
  - import most of the required libraries ;
  - correct program header from the beginning to the open <r>{</r> ;
  - it creates correct java file( in our case: Reverse.java ), which can be saved( <r>/s</r> );
  - run JAVA to execute "single source-file";
  - if you need .class files (result of compilation), use key: <r>/c</r> - only compilation.

<o>jj supports short names</o>. Function arguments can be of 3 types:  double, float, int.
   Fun(...) denotes use of <r>'varargs'</r>, i.e. possible: Fun(a), Fun(a,b), Fun(a,b,c)...

   tt(String), tt(...) - output arguments  to std.OUT
   ee(String), ee(...) - output arguments  to std.ERR
   hh(i), hh(i,j)      - output ###-header to std.OUT, i-number of rows, j-columns

   min(...) , max(...) - minimum, maximum value
   pow( a, p ) - a^p,  e.g. pow(5,2)=25; pow(8,1/3.)=2
   sqr( a )    - square root of a = pow( a,.5 )
   abs( a )    - absolute value
   erf( a )    - "Error Function", sigmoid: -1 < erf() < 1
   rnd()       - random value: 0 <= rnd() <= 1

   sin(a), cos(a), tg(a),   asin(a), acos(a) ,atg(a),   exp(a), ln(a), lg(a)
   constants:  pi=3.1415..., rad=180/pi

Folder: <o>pik3d/usr</o> is default repository for <o>.jj</o> and <n>.java</n> files.
If path to the file is omitted, the search sequence: current folder, <o>pik3d/usr</o>.
By default, the file extension is assumed to be <o>.jj</o> ( can be omitted ).

The general form of <o>code.jj</o> is :   (more examples: pik3d\usr\*.jj)
<f>
  [ import pkg;  // NON-STANDARD  JAVA, pik  packages ]
  [ comments:  /* text ... */  or  // text ... ]
  <r>{</r>
      JAVA :  body of <r>code</r>( String arg[] )
  <r>}</r>
  [ methods,  classes(not public),  static ... ]</f>
<a name='jc'></a>
Example 1(above) in <o>jj-form</o>, file: minMAJ<o>.jj</o>
<r>{</r><f>
   hh( 201, 3 );                                   // ### Header
   for(int i=0; i&lt;=200; i++) {
      var t = i*( 2*pi/10 );                       // 10 points/period
      var k = sin( t ) + sin( t*3/2 );             // tonic + quint
      tt( i/10., k+sin( t*6/5 ), k+sin( t*5/4 ));  // t  minor  MAJOR
   }
<r>}</r></f>

There is often a need to describe processing features as a commentary to the data.
For example, a type of regression( see  <n>pik3d\usr\prereg.jj:  lines: 17, 20 </n>).
If a jj-program line contains a comment like:  <r>//!</r>,  then this <r>line of JAVA code</r>
will be printed <r>as a comment</r> before the <n>Stack</n> output.  Example:<r>
!
! double x=X[0], y=X[1];
! 1, x,y, x*x, y*y, x*y
!</r><n>
### prereg_VF [ 7, 7 ] D8
    . . .</n>
This is some kind of <r>self-documenting</r> of the jj-program.

An additional very handy feature of <o>jj-Technology</o> is to execute the sequence of JAVA
commands directly from the command line. In this case  file: <n>Noname.java</n>  is produced
and executed( you can save it: <o>/s</o> ).  It takes less than 1 second.
	 ________________________________________________________________
	|                                                                |
	|                  !!! ATTENTION in WINDOWS !!!                  |
	|                                                                |
	|  Since JAVA <r>double quote character "</r> cannot be used correctly  |
	|  on the command line, it must be replaced  by  <r>\" </r>or<r> ^</r>,  e.g.  |
	|    > jj "tt(<r>^</r>Hello World<r>^</r>)"                                    |
	|  Before compilation <r>^</r> will be replaced back with <r>"</r> .           |
	|________________________________________________________________|

JAVA commands are delimited by <r>';'</r> (last before closed <r>"</r> may be omitted ).
Examples( ^C/^V  to test jj, pik3d ):
<f>
> <o>jj</o> "tt( max(.9, pi/2, pi-1), 4*pi, sin(-pi/4))"   !use of <r>'varargs'</r>
> <o>jj</o> "for(int i=0;i&lt;9;i++) tt(<r>^</r> i=<r>^</r>+i)"             !print: i=0\n i=1\n i=2...\n i=8
> <o>jj</o> "hh(101,2); for(var x=0.;x<=20;x+=.2) tt(x,exp(-x/7)*sin(x))"| vic - 1 2,11
</f>
<div style='background:#333333; color:#00FF00;'>  Linux:
$ jj <r>'</r>tt( max(.9, pi/2, pi-1), 4*pi, sin(-pi/4))<r>'</r>   !use of <r>'varargs'</r>
$ jj <r>'</r>for(int i=0;i&lt;9;i++) tt(<r>"</r> i=<r>"</r>+i)<r>'</r>             !print: i=0 i=1 ... i=8
$ jj <r>'</r>hh(101,2); for(var x=0.;x&lt;=20;x+=.2) tt(x,exp(-x/7)*sin(x))<r>'</r>| vic - 1 2,11</div>
<r>JAVA options</r> can be used with <o>jj-command</o>. It is useful to test new features of Java.
Example( Vector API: pik3d/usr/jep438.jj ):

<f>> <o>jj</o>  <r>--enable-preview  --source=21  --add-modules=jdk.incubator.vector</r>  jep438 </f>
________________________________________________________________________________________
<a name='pik'></a><o>
		Most used pik.io methods

Read/Write to standard streams: <r>System.in/ System.out</r>, <u>static methods:</u></o>
<f>
  void cmd( String cmd, String[] arg, String help ) </f>//checking arg[] parameters
	// If arg is empty or arg[0]=<r>"/?"</r>, then help is displayed and program stop
	// supports <r>@file</r> service - duplicating pipe-output to file
<f>
  double getdbl( String s ) </f>//get double value from String,if need int: <f>(int)getdbl(s)</f>
	// e.g.> <f>jj "tt( (int)getdbl(^-3^) )"</f>

  <f>void tt( String s )  </f> //output string to stream: System.out
  <f>void <r>ee</r>( String s )  </f> //output string to stream: <r>System.err</r>
  <f>void tt( double... x)</f> //output to System.out double[](may be float): tt(1,.2f,9e9,-1)
  <f>void <r>ee</r>( double... x)</f> //output to <r>System.err</r> ---:---:---:---:---:---

  <f>float [][][] inStack ( String file ) </f>//read stack into <r>float [][][]</r>
  <f>double[][][] inStack8( String file ) </f>//read stack into <r>double[][][]</r>

  <f>float [][] inFrame ( String file ) </f>//read the <r>1st frame</r> of the stack into <r>float [][]</r>
  <f>double[][] inFrame8( String file ) </f>//read the <r>1st frame</r> of the stack into <r>double[][]</r>

  <f>void ttFrame( Object <r>F</r> ) </f>//<r>F</r>rame out: <r>float[][]   or double[][]</r>,   <a href="#bin">bin.format F4|D8</a>
  <f>void ttFrame( Object <r>F</r>, String name ) </f>//the same as previous with <f>Frame_Name</f>
  <f>void ttStack( Object <r>S</r> )</f> //<r>S</r>tack out: <r>float[][][] or double[][][]</r>, <a href="#bin">bin.format F4|D8</a>
	// output format( F4 or D8 ) depends on Object: float[]... or double[]...

  <f>void clott()</f> // close/clean up pik.io resources, should <r>ALWAYS</r> be called at the end !
  If you use <a href="#jj">jj-Technology</a>, this call is already present !

Frame is 2-dimensional array <r>frame    [ ii ][ jj ]</r>, e.g. 3-row  : <f>var s3 = frame[ 2 ];</f>
Stack is 3-dimensional array <r>stk[ <u>kk</u> ][ ii ][ jj ]</r>, e.g. 5-frame: <f>var k5 = stk  [ 4 ];</f>
You can use file names with stack number (see below): "A.dat:3", "-:4"

If the stacks are small and there is enough memory to accommodate them entirely,
it is recommended to use these  <o><u>static methods</u></o>.

<o>Read Frame, <u>instance methods:</u></o>

  <f>io reader = new io( String file )</f> // constructor: create a reader of the File,
                                     // if <r>file ="-","-:N"</r>, then reading from <r>System.in</r>
If the file/stream contains multiple stacks separated by lines <r>### &lt;eos></r> (<r>E</r>nd <r>O</r>f <r>S</r>tack),
then the filename might look like this: <r>Stk:3, -:4</r>. Last means: 4th stack in  <r>System.in</r>

  <f>float [][]   reader.inFrame () </f>   // read frame into <r>float [][]</r>    - 2d-array ;
  <f>double[][]   reader.inFrame8() </f>   // read frame into <r>double[][]</r>    - 2d-array ;
                                     // Frame can be in any format:<a href="#dat"> Text,I2,F4,D8<a>
  <f>float [][][] reader.inStack () </f>   // read stack into <r>float [][][]</r> - 3d-array ;
  <f>double[][][] reader.inStack8() </f>   // read stack into <r>double[][][]</r> - 3d-array ;

The reader reads frame by frame sequentially. If it encounters end of file or
<r>### &lt;eos></r> (End Of Stack), then the methods <f>inFrame(), inFrame8()</f> return null
and <f>inStack(), inStack8()</f> ends reading and returns a 3d array. In the case of several
stacks in the file/stream, the reader is ready to read the next stack.

  <f>void reader.skipStk( int n ) </f>     // Skip n stacks.
  <f>void reader.reset()          </f>     //"rewind" file/ input stream to the beginning.

reader does not need to be closed, readers are closed at the end by the method: <f>clott()</f>.
A package to read/write  ###-files  in  <r>PYTHON</r>:  <r>kadr.py</r>  - pik3d\ext\###_PYTHON.zip .
<o>
Simple 2D-graphics ( can be used with <a href="#jj">jj-technology</a> ):</o>

Universal pik3d window <r>gra</r> is used. It supports all services <a href="#gra">"Use of 2D-graphics"</a>.
static methods:<f>
  <r>gra</r> simple( String title, double[] xx, double[] yy, int mark )  </f>// one plot: y(x)<f>
  <r>gra</r> simple( String title, double[] yy )                         </f>// xx[]={1,2,3...}<f>
  <r>gra</r> simple( String title, double[] xx, double[]... yy )         </f>// several plots

if you have <r>gra w</r> created by <f>simple()</f>, you can :<f>
  <r>w</r>.setLocation( xpix, ypix )         </f>// set window location on the screen<f>
  <r>w</r>.pen( n );  <r>w</r>.pen( rgb )           </f>// set color(<a href="#vis"> 0&lt= n &lt;=10 </a>or rgb ~ 0x04b4ff )<f>
  <r>w</r>.bold( npix )                      </f>// set line-width in pixels<f>
  <r>w</r>.fun    ( xx, yy, mark )           </f>// add plot:   y(x)  to <r>w</r><f>
  <r>w</r>.aspline( xx, yy, mark )           </f>// add spline: y(x), if <a href="#vis">mark</a>=0  - only line<f>
  <r>w</r>.font(size); <r>w</r>.txt( text, x, y )   </f>// in <r>w</r>-subject coord.: x,y add String text<f>
  <r>w</r>.repaint();                        </f>// is required! after manipulation with <r>gra</r>
________________________________________________________________________________________
<a name='jc'></a>
		<o>Create New pik3d Command, prepare Launcher
</o>
It is recommended to use <a href="#jj">jj-Technology</a> for complex commands: get  <n>JAVA file</n>  as a first
variant from  <n>jj ... /s</n>  and place it in to the  <n>JAVA IDE</n>  for comfortable development.

The description uses  <r>fun.jj</r>  and  <r>fun</r>  as the name of the  file  and  command.

1. Debug <r>fun.jj</r> and functionality with  ><a href="#jj"> jj fun</a>

2. COMPILE:  > <f>jj fun /c</f> .  If successful,  <r>fun.class</r>  should appear.

3. Copy  <r>fun.jj</r> and <r>fun.class</r>  to the library:  <r>pik3d\lib\usr.jar\usr\</r>
   The .jar files are ZIP archives, so any ZIP utility is suitable, e.g. Total Commander

4. Add new line  to the  pik3d\exe\<r>_Launch.cfg</r>:<f>  fun:  java  usr.fun </f>

5. Create all Launchers:  go to  pik3d\exe,  run > <r>_Launch.exe</r>

This is an easy way to create a new Launcher.
In fact, <r>pik3d Launcher technology</r> can be used  to create  Lancher for any runnable
class, which has function: main(),  for any JAVA version 8 or later.

Only  <r>_Launch.exe</r>  and  <r>pik3d\lib\run.jar</r>  are needed  (they are compiled with JAVA-8).
Let us assume <f><b>[cp]</b></f> is a list of archives for new Launcher( class-path ).
<f># test.cfg - Launcher config for class: <r>c:\workspace\project\pkg\test.java</r>:

  jdk/bin:   c:\java_11\bin                                    !use this JAVA
  lib/jar:   <b><r>c:\workspace\project</r>;[cp]</b>;<u>E:\pik3d\lib\run.jar</u>    !class-path
  test01:    java  <r>pkg.test</r>                                    !main-class
</f>
> _Launch test.cfg        !test01.exe is created, run.jar is needed to create exe-file
                          !it is not included to the class-path of the launcher.
________________________________________________________________________________________
<f>
                              author: K.A. Ilyashenko, e-mail: kilyashenko@gmail.com
                              Error messages, comments, suggestions  are  welcome .
</f></pre></h5></body></html>
